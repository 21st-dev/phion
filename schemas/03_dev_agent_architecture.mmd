sequenceDiagram
    participant USER as üë§ User
    participant EDITOR as üíª Editor (VSCode/Cursor)
    participant FS as üìÅ File System
    participant AGENT as üì° Dev Agent
    participant WATCHER as üëÅÔ∏è File Watcher
    participant WS_CLIENT as üîÑ WS Client
    participant GIT as üå≥ Git Local
    participant WS_SERVER as üîÑ WebSocket Server

    Note over USER,WS_SERVER: üì° DEV AGENT - –î–ï–¢–ê–õ–¨–ù–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

    %% === –°–¢–†–£–ö–¢–£–†–ê –ê–ì–ï–ù–¢–ê ===
    rect rgb(255, 250, 240)
        Note over AGENT: üìÅ –§–ê–ô–õ–û–í–ê–Ø –°–¢–†–£–ö–¢–£–†–ê –ê–ì–ï–ù–¢–ê
        
        Note left of AGENT: packages/dev-agent/
        Note left of AGENT: ‚îú‚îÄ‚îÄ src/
        Note left of AGENT: ‚îÇ   ‚îú‚îÄ‚îÄ index.ts (entry point)
        Note left of AGENT: ‚îÇ   ‚îú‚îÄ‚îÄ agent.ts (main class)
        Note left of AGENT: ‚îÇ   ‚îú‚îÄ‚îÄ watcher/
        Note left of AGENT: ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ file-watcher.ts
        Note left of AGENT: ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ignore-patterns.ts
        Note left of AGENT: ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ change-detector.ts
        Note left of AGENT: ‚îÇ   ‚îú‚îÄ‚îÄ websocket/
        Note left of AGENT: ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ client.ts
        Note left of AGENT: ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ events.ts
        Note left of AGENT: ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ reconnection.ts
        Note left of AGENT: ‚îÇ   ‚îú‚îÄ‚îÄ git/
        Note left of AGENT: ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ operations.ts
        Note left of AGENT: ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ status.ts
        Note left of AGENT: ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ sync.ts
        Note left of AGENT: ‚îÇ   ‚îú‚îÄ‚îÄ config/
        Note left of AGENT: ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ reader.ts
        Note left of AGENT: ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validator.ts
        Note left of AGENT: ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ defaults.ts
        Note left of AGENT: ‚îÇ   ‚îî‚îÄ‚îÄ utils/
        Note left of AGENT: ‚îÇ       ‚îú‚îÄ‚îÄ logger.ts
        Note left of AGENT: ‚îÇ       ‚îú‚îÄ‚îÄ debouncer.ts
        Note left of AGENT: ‚îÇ       ‚îî‚îÄ‚îÄ file-utils.ts
        Note left of AGENT: ‚îú‚îÄ‚îÄ bin/
        Note left of AGENT: ‚îÇ   ‚îî‚îÄ‚îÄ vybcel-sync.js
        Note left of AGENT: ‚îî‚îÄ‚îÄ package.json

        Note right of AGENT: –ó–ê–í–ò–°–ò–ú–û–°–¢–ò –ò –ë–ò–ë–õ–ò–û–¢–ï–ö–ò
        Note right of AGENT: ‚îú‚îÄ‚îÄ chokidar (—Ñ–∞–π–ª–æ–≤—ã–π watcher)
        Note right of AGENT: ‚îú‚îÄ‚îÄ socket.io-client (WebSocket)
        Note right of AGENT: ‚îú‚îÄ‚îÄ simple-git (Git –æ–ø–µ—Ä–∞—Ü–∏–∏)
        Note right of AGENT: ‚îú‚îÄ‚îÄ minimatch (glob patterns)
        Note right of AGENT: ‚îú‚îÄ‚îÄ chalk (—Ü–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥)
        Note right of AGENT: ‚îú‚îÄ‚îÄ commander (CLI interface)
        Note right of AGENT: ‚îî‚îÄ‚îÄ dotenv (environment variables)
    end

    %% === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ===
    rect rgb(245, 255, 245)
        Note over AGENT: ‚öôÔ∏è –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
        
        Note left of AGENT: –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–û–ù–ù–´–ï –§–ê–ô–õ–´
        Note left of AGENT: ‚îú‚îÄ‚îÄ vybcel.config.json
        Note left of AGENT: ‚îÇ   ‚îú‚îÄ‚îÄ projectId (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID)
        Note left of AGENT: ‚îÇ   ‚îú‚îÄ‚îÄ serverUrl (WebSocket URL)
        Note left of AGENT: ‚îÇ   ‚îú‚îÄ‚îÄ watchPatterns (—Ñ–∞–π–ª—ã –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è)
        Note left of AGENT: ‚îÇ   ‚îú‚îÄ‚îÄ ignorePatterns (–∏—Å–∫–ª—é—á–µ–Ω–∏—è)
        Note left of AGENT: ‚îÇ   ‚îî‚îÄ‚îÄ options (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
        Note left of AGENT: ‚îú‚îÄ‚îÄ .env (–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è)
        Note left of AGENT: ‚îÇ   ‚îú‚îÄ‚îÄ VYBCEL_PROJECT_ID
        Note left of AGENT: ‚îÇ   ‚îú‚îÄ‚îÄ VYBCEL_SERVER_URL
        Note left of AGENT: ‚îÇ   ‚îî‚îÄ‚îÄ VYBCEL_DEBUG
        Note left of AGENT: ‚îî‚îÄ‚îÄ package.json
        Note left of AGENT:     ‚îú‚îÄ‚îÄ "sync": "vybcel-sync"
        Note left of AGENT:     ‚îî‚îÄ‚îÄ "start": "pnpm dev & pnpm sync"

        Note right of AGENT: –ü–ê–†–ê–ú–ï–¢–†–´ –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò
        Note right of AGENT: ‚îú‚îÄ‚îÄ watchPatterns: ["src/**/*", "public/**/*"]
        Note right of AGENT: ‚îú‚îÄ‚îÄ ignorePatterns: ["node_modules/**", ".git/**"]
        Note right of AGENT: ‚îú‚îÄ‚îÄ debounceMs: 300 (–∑–∞–¥–µ—Ä–∂–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏)
        Note right of AGENT: ‚îú‚îÄ‚îÄ reconnectAttempts: 10
        Note right of AGENT: ‚îú‚îÄ‚îÄ reconnectDelay: 1000
        Note right of AGENT: ‚îî‚îÄ‚îÄ maxFileSize: 1MB

        alt –ó–∞–ø—É—Å–∫ –∞–≥–µ–Ω—Ç–∞
            USER->>AGENT: pnpm sync
            AGENT->>AGENT: –ß—Ç–µ–Ω–∏–µ vybcel.config.json
            AGENT->>AGENT: –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
            AGENT->>AGENT: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
            AGENT-->>USER: "Agent initialized for project {projectId}"
        end
        
        alt –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
            AGENT->>FS: –ü–æ–∏—Å–∫ vybcel.config.json
            FS-->>AGENT: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª
            AGENT->>AGENT: –ü–∞—Ä—Å–∏–Ω–≥ PROJECT_ID
            AGENT->>AGENT: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
        end
    end

    %% === FILE WATCHER –ê–†–•–ò–¢–ï–ö–¢–£–†–ê ===
    rect rgb(240, 248, 255)
        Note over WATCHER: üëÅÔ∏è FILE WATCHER –°–ò–°–¢–ï–ú–ê
        
        Note left of WATCHER: CHOKIDAR –ù–ê–°–¢–†–û–ô–ö–ò
        Note left of WATCHER: ‚îú‚îÄ‚îÄ ignored: /node_modules|\.git|dist/
        Note left of WATCHER: ‚îú‚îÄ‚îÄ ignoreInitial: true
        Note left of WATCHER: ‚îú‚îÄ‚îÄ persistent: true
        Note left of WATCHER: ‚îú‚îÄ‚îÄ alwaysStat: true
        Note left of WATCHER: ‚îú‚îÄ‚îÄ depth: 10 (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–ª—É–±–∏–Ω–∞)
        Note left of WATCHER: ‚îî‚îÄ‚îÄ usePolling: false (inotify –Ω–∞ Linux)

        Note right of WATCHER: –°–û–ë–´–¢–ò–Ø –§–ê–ô–õ–û–í
        Note right of WATCHER: ‚îú‚îÄ‚îÄ add - –Ω–æ–≤—ã–π —Ñ–∞–π–ª
        Note right of WATCHER: ‚îú‚îÄ‚îÄ change - –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
        Note right of WATCHER: ‚îú‚îÄ‚îÄ unlink - —É–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
        Note right of WATCHER: ‚îú‚îÄ‚îÄ addDir - –Ω–æ–≤–∞—è –ø–∞–ø–∫–∞
        Note right of WATCHER: ‚îú‚îÄ‚îÄ unlinkDir - —É–¥–∞–ª–µ–Ω–∏–µ –ø–∞–ø–∫–∏
        Note right of WATCHER: ‚îî‚îÄ‚îÄ ready - watcher –≥–æ—Ç–æ–≤

        Note over WATCHER: –§–ò–õ–¨–¢–†–ê–¶–ò–Ø –ò DEBOUNCING
        Note over WATCHER: ‚îú‚îÄ‚îÄ –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (.tmp, .swp)
        Note over WATCHER: ‚îú‚îÄ‚îÄ Debouncing –∏–∑–º–µ–Ω–µ–Ω–∏–π (300ms)
        Note over WATCHER: ‚îú‚îÄ‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ (max 1MB)
        Note over WATCHER: ‚îî‚îÄ‚îÄ Content-based change detection

        alt –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è watcher
            AGENT->>WATCHER: chokidar.watch(patterns, options)
            WATCHER->>FS: –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
            WATCHER->>WATCHER: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ event listeners
            WATCHER-->>AGENT: 'ready' —Å–æ–±—ã—Ç–∏–µ
        end
        
        alt –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–∞
            EDITOR->>FS: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ (Ctrl+S)
            FS->>WATCHER: inotify/filesystem event
            WATCHER->>WATCHER: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ debouncing
            WATCHER->>AGENT: 'change' —Å–æ–±—ã—Ç–∏–µ —Å path –∏ stats
        end
    end

    %% === WEBSOCKET CLIENT ===
    rect rgb(255, 245, 255)
        Note over WS_CLIENT: üîÑ WEBSOCKET CLIENT
        
        Note left of WS_CLIENT: CONNECTION MANAGEMENT
        Note left of WS_CLIENT: ‚îú‚îÄ‚îÄ socket.io-client
        Note left of WS_CLIENT: ‚îú‚îÄ‚îÄ Auto-reconnection
        Note left of WS_CLIENT: ‚îú‚îÄ‚îÄ Exponential backoff
        Note left of WS_CLIENT: ‚îú‚îÄ‚îÄ Connection state tracking
        Note left of WS_CLIENT: ‚îî‚îÄ‚îÄ Heartbeat/ping mechanism

        Note right of WS_CLIENT: –°–û–ë–´–¢–ò–Ø –ò –ü–†–û–¢–û–ö–û–õ
        Note right of WS_CLIENT: –û–¢–ü–†–ê–í–õ–Ø–ï–ú–´–ï:
        Note right of WS_CLIENT: ‚îú‚îÄ‚îÄ authenticate {projectId, clientType: 'agent'}
        Note right of WS_CLIENT: ‚îú‚îÄ‚îÄ file_change {filePath, content, action, timestamp}
        Note right of WS_CLIENT: ‚îú‚îÄ‚îÄ ping (keepalive)
        Note right of WS_CLIENT: ‚îî‚îÄ‚îÄ agent_status {status, timestamp}
        Note right of WS_CLIENT: –ü–û–õ–£–ß–ê–ï–ú–´–ï:
        Note right of WS_CLIENT: ‚îú‚îÄ‚îÄ authenticated {success, message}
        Note right of WS_CLIENT: ‚îú‚îÄ‚îÄ discard_local_changes {projectId}
        Note right of WS_CLIENT: ‚îú‚îÄ‚îÄ pull_latest_changes {files}
        Note right of WS_CLIENT: ‚îî‚îÄ‚îÄ disconnect_agent {reason}

        alt –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
            AGENT->>WS_CLIENT: connect(serverUrl)
            WS_CLIENT->>WS_SERVER: WebSocket connection
            WS_CLIENT->>WS_SERVER: emit('authenticate', {projectId})
            WS_SERVER-->>WS_CLIENT: emit('authenticated', {success: true})
            WS_CLIENT-->>AGENT: Connection established
        end
        
        alt –û—Ç–ø—Ä–∞–≤–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–∞
            WATCHER->>AGENT: File changed event
            AGENT->>FS: fs.readFile(filePath)
            FS-->>AGENT: File content
            AGENT->>WS_CLIENT: emit('file_change', {filePath, content})
            WS_CLIENT->>WS_SERVER: WebSocket message
        end
        
        alt –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ —Å–±–æ–µ
            WS_CLIENT->>WS_CLIENT: Connection lost detected
            WS_CLIENT->>WS_CLIENT: Exponential backoff delay
            WS_CLIENT->>WS_SERVER: Reconnection attempt
            WS_CLIENT->>AGENT: Connection status update
        end
    end

    %% === GIT –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø ===
    rect rgb(250, 255, 250)
        Note over GIT: üå≥ GIT –õ–û–ö–ê–õ–¨–ù–ê–Ø –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø
        
        Note left of GIT: GIT –û–ü–ï–†–ê–¶–ò–ò
        Note left of GIT: ‚îú‚îÄ‚îÄ git init (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–ø–æ)
        Note left of GIT: ‚îú‚îÄ‚îÄ git remote add origin (–Ω–∞—Å—Ç—Ä–æ–π–∫–∞ remote)
        Note left of GIT: ‚îú‚îÄ‚îÄ git status (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞)
        Note left of GIT: ‚îú‚îÄ‚îÄ git reset --hard HEAD (–æ—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π)
        Note left of GIT: ‚îú‚îÄ‚îÄ git clean -fd (–æ—á–∏—Å—Ç–∫–∞ untracked)
        Note left of GIT: ‚îú‚îÄ‚îÄ git pull origin main (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è)
        Note left of GIT: ‚îî‚îÄ‚îÄ git log --oneline (–∏—Å—Ç–æ—Ä–∏—è –∫–æ–º–º–∏—Ç–æ–≤)

        Note right of GIT: –°–û–°–¢–û–Ø–ù–ò–ï –†–ï–ü–û–ó–ò–¢–û–†–ò–Ø
        Note right of GIT: ‚îú‚îÄ‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è .git/
        Note right of GIT: ‚îú‚îÄ‚îÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ remote URL
        Note right of GIT: ‚îú‚îÄ‚îÄ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
        Note right of GIT: ‚îú‚îÄ‚îÄ –°—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
        Note right of GIT: ‚îî‚îÄ‚îÄ –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏ —Ä–µ–∑–æ–ª—é—Ü–∏—è

        alt –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Git
            AGENT->>GIT: checkGitRepository()
            GIT->>FS: –ü—Ä–æ–≤–µ—Ä–∫–∞ .git –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
            alt .git –Ω–µ –Ω–∞–π–¥–µ–Ω
                GIT->>GIT: git init
                GIT->>GIT: git remote add origin {repoUrl}
                GIT->>GIT: git add . && git commit -m "Initial"
                GIT-->>AGENT: Repository initialized
            else .git —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
                GIT->>GIT: git remote -v
                GIT-->>AGENT: Repository already initialized
            end
        end
        
        alt –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π
            WS_SERVER->>WS_CLIENT: emit('discard_local_changes')
            WS_CLIENT->>AGENT: Discard command received
            AGENT->>GIT: git reset --hard HEAD
            GIT->>GIT: git clean -fd
            GIT-->>AGENT: Changes discarded
            AGENT->>WS_CLIENT: emit('discard_completed')
        end
        
        alt –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å remote
            WS_SERVER->>WS_CLIENT: emit('pull_latest_changes')
            WS_CLIENT->>AGENT: Pull command received
            AGENT->>GIT: git fetch origin main
            GIT->>GIT: git reset --hard FETCH_HEAD
            GIT-->>AGENT: Sync completed
            AGENT->>WS_CLIENT: emit('sync_completed')
        end
    end

    %% === –û–ë–†–ê–ë–û–¢–ö–ê –§–ê–ô–õ–û–í ===
    rect rgb(255, 250, 245)
        Note over AGENT: üìÑ –û–ë–†–ê–ë–û–¢–ö–ê –ò –§–ò–õ–¨–¢–†–ê–¶–ò–Ø –§–ê–ô–õ–û–í
        
        Note left of AGENT: –¢–ò–ü–´ –ò–ó–ú–ï–ù–ï–ù–ò–ô
        Note left of AGENT: ‚îú‚îÄ‚îÄ CREATED - –Ω–æ–≤—ã–π —Ñ–∞–π–ª
        Note left of AGENT: ‚îú‚îÄ‚îÄ MODIFIED - –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
        Note left of AGENT: ‚îú‚îÄ‚îÄ DELETED - —É–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
        Note left of AGENT: ‚îú‚îÄ‚îÄ MOVED - –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ/–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ
        Note left of AGENT: ‚îî‚îÄ‚îÄ CHMOD - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

        Note right of AGENT: –§–ò–õ–¨–¢–†–ê–¶–ò–Ø –ò –í–ê–õ–ò–î–ê–¶–ò–Ø
        Note right of AGENT: ‚îú‚îÄ‚îÄ –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (max 1MB)
        Note right of AGENT: ‚îú‚îÄ‚îÄ –¢–∏–ø—ã —Ñ–∞–π–ª–æ–≤ (text vs binary)
        Note right of AGENT: ‚îú‚îÄ‚îÄ Ignore patterns (.gitignore style)
        Note right of AGENT: ‚îú‚îÄ‚îÄ Content encoding (UTF-8)
        Note right of AGENT: ‚îî‚îÄ‚îÄ Checksum validation

        Note over AGENT: DEBOUNCING –ò –ë–ê–¢–ß–ò–ù–ì
        Note over AGENT: ‚îú‚îÄ‚îÄ 300ms debounce –¥–ª—è rapid changes
        Note over AGENT: ‚îú‚îÄ‚îÄ Batch multiple changes –≤ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å
        Note over AGENT: ‚îú‚îÄ‚îÄ Priority –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
        Note over AGENT: ‚îî‚îÄ‚îÄ Queue –¥–ª—è offline changes

        alt –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–∞
            WATCHER->>AGENT: change event {filePath, stats}
            AGENT->>AGENT: –ü—Ä–æ–≤–µ—Ä–∫–∞ ignore patterns
            AGENT->>AGENT: –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ –∏ —Ç–∏–ø–∞
            AGENT->>FS: fs.readFile(filePath, 'utf8')
            FS-->>AGENT: File content
            AGENT->>AGENT: Content encoding validation
            AGENT->>WS_CLIENT: –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        end
        
        alt Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
            WATCHER->>AGENT: Multiple rapid changes
            AGENT->>AGENT: Debounce timer (300ms)
            AGENT->>AGENT: –°–±–æ—Ä –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ batch
            AGENT->>AGENT: –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
            AGENT->>WS_CLIENT: –û—Ç–ø—Ä–∞–≤–∫–∞ batch –∑–∞–ø—Ä–æ—Å–∞
        end
    end

    %% === CLI –ò–ù–¢–ï–†–§–ï–ô–° ===
    rect rgb(245, 250, 255)
        Note over AGENT: üíª CLI –ò–ù–¢–ï–†–§–ï–ô–° –ò –ö–û–ú–ê–ù–î–´
        
        Note left of AGENT: –ö–û–ú–ê–ù–î–´ CLI
        Note left of AGENT: ‚îú‚îÄ‚îÄ vybcel-sync (–æ—Å–Ω–æ–≤–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞)
        Note left of AGENT: ‚îú‚îÄ‚îÄ vybcel-sync --init (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è)
        Note left of AGENT: ‚îú‚îÄ‚îÄ vybcel-sync --status (—Å—Ç–∞—Ç—É—Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è)
        Note left of AGENT: ‚îú‚îÄ‚îÄ vybcel-sync --debug (–æ—Ç–ª–∞–¥–æ—á–Ω—ã–π —Ä–µ–∂–∏–º)
        Note left of AGENT: ‚îú‚îÄ‚îÄ vybcel-sync --help (—Å–ø—Ä–∞–≤–∫–∞)
        Note left of AGENT: ‚îî‚îÄ‚îÄ vybcel-sync --version (–≤–µ—Ä—Å–∏—è)

        Note right of AGENT: –í–´–í–û–î –ò –õ–û–ì–ò–†–û–í–ê–ù–ò–ï
        Note right of AGENT: ‚îú‚îÄ‚îÄ –¶–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥ (chalk)
        Note right of AGENT: ‚îú‚îÄ‚îÄ Progress indicators
        Note right of AGENT: ‚îú‚îÄ‚îÄ Error messages
        Note right of AGENT: ‚îú‚îÄ‚îÄ Debug –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
        Note right of AGENT: ‚îî‚îÄ‚îÄ Status updates

        Note over AGENT: –ò–ù–¢–ï–†–ê–ö–¢–ò–í–ù–´–ï –≠–õ–ï–ú–ï–ù–¢–´
        Note over AGENT: ‚îú‚îÄ‚îÄ Spinner –¥–ª—è connection
        Note over AGENT: ‚îú‚îÄ‚îÄ Progress bar –¥–ª—è sync
        Note over AGENT: ‚îú‚îÄ‚îÄ Live status indicator
        Note over AGENT: ‚îî‚îÄ‚îÄ Ctrl+C graceful shutdown

        alt –ó–∞–ø—É—Å–∫ –∫–æ–º–∞–Ω–¥—ã
            USER->>AGENT: vybcel-sync
            AGENT->>AGENT: –ü–∞—Ä—Å–∏–Ω–≥ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
            AGENT->>AGENT: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
            AGENT->>USER: "üöÄ Vybcel Agent starting..."
            AGENT->>WS_CLIENT: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
            AGENT->>USER: "‚úÖ Connected to project {projectId}"
        end
        
        alt –°—Ç–∞—Ç—É—Å –∫–æ–º–∞–Ω–¥–∞
            USER->>AGENT: vybcel-sync --status
            AGENT->>AGENT: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
            AGENT->>USER: Connection: ‚úÖ Connected
            AGENT->>USER: Project: {projectId}
            AGENT->>USER: Watching: {fileCount} files
        end
        
        alt Graceful shutdown
            USER->>AGENT: Ctrl+C (SIGINT)
            AGENT->>WATCHER: –û—Å—Ç–∞–Ω–æ–≤–∫–∞ file watcher
            AGENT->>WS_CLIENT: –ó–∞–∫—Ä—ã—Ç–∏–µ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
            AGENT->>GIT: –û—á–∏—Å—Ç–∫–∞ git locks
            AGENT->>USER: "üëã Agent stopped gracefully"
        end
    end

    %% === –ú–û–ù–ò–¢–û–†–ò–ù–ì –ò –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê ===
    rect rgb(255, 255, 245)
        Note over AGENT: üìä –ú–û–ù–ò–¢–û–†–ò–ù–ì –ò –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê
        
        Note left of AGENT: –ú–ï–¢–†–ò–ö–ò –ò –°–¢–ê–¢–ò–°–¢–ò–ö–ê
        Note left of AGENT: ‚îú‚îÄ‚îÄ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤
        Note left of AGENT: ‚îú‚îÄ‚îÄ –ß–∞—Å—Ç–æ—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ñ–∞–π–ª–æ–≤
        Note left of AGENT: ‚îú‚îÄ‚îÄ –°—Ç–∞—Ç—É—Å WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        Note left of AGENT: ‚îú‚îÄ‚îÄ –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
        Note left of AGENT: ‚îú‚îÄ‚îÄ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç–æ–≤
        Note left of AGENT: ‚îî‚îÄ‚îÄ Memory usage –∞–≥–µ–Ω—Ç–∞

        Note right of AGENT: –õ–û–ì–ò–†–û–í–ê–ù–ò–ï –°–û–ë–´–¢–ò–ô
        Note right of AGENT: ‚îú‚îÄ‚îÄ File change events
        Note right of AGENT: ‚îú‚îÄ‚îÄ WebSocket events
        Note right of AGENT: ‚îú‚îÄ‚îÄ Git operations
        Note right of AGENT: ‚îú‚îÄ‚îÄ Error conditions
        Note right of AGENT: ‚îî‚îÄ‚îÄ Performance metrics

        Note over AGENT: HEALTH CHECK
        Note over AGENT: ‚îú‚îÄ‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ file watcher —Å–æ—Å—Ç–æ—è–Ω–∏—è
        Note over AGENT: ‚îú‚îÄ‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        Note over AGENT: ‚îú‚îÄ‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ git repository
        Note over AGENT: ‚îî‚îÄ‚îÄ –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

        alt Debug —Ä–µ–∂–∏–º
            USER->>AGENT: vybcel-sync --debug
            AGENT->>AGENT: –í–∫–ª—é—á–µ–Ω–∏–µ verbose logging
            AGENT->>USER: –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö
            AGENT->>USER: WebSocket events –≤ real-time
            AGENT->>USER: File system events –¥–µ—Ç–∞–ª–∏
        end
        
        alt –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
            AGENT->>AGENT: performance.now() –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π
            AGENT->>AGENT: –ü–æ–¥—Å—á–µ—Ç memory usage
            AGENT->>AGENT: Tracking connection latency
            AGENT->>USER: Performance report –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
        end
    end

    %% === ERROR HANDLING ===
    rect rgb(255, 245, 245)
        Note over AGENT: ‚ùå –û–ë–†–ê–ë–û–¢–ö–ê –û–®–ò–ë–û–ö –ò RECOVERY
        
        Note left of AGENT: –¢–ò–ü–´ –û–®–ò–ë–û–ö
        Note left of AGENT: ‚îú‚îÄ‚îÄ Network errors (—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ)
        Note left of AGENT: ‚îú‚îÄ‚îÄ File system errors (–¥–æ—Å—Ç—É–ø)
        Note left of AGENT: ‚îú‚îÄ‚îÄ Git errors (—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π)
        Note left of AGENT: ‚îú‚îÄ‚îÄ Configuration errors (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
        Note left of AGENT: ‚îî‚îÄ‚îÄ Server errors (WebSocket —Å–µ—Ä–≤–µ—Ä)

        Note right of AGENT: –°–¢–†–ê–¢–ï–ì–ò–ò RECOVERY
        Note right of AGENT: ‚îú‚îÄ‚îÄ Exponential backoff –¥–ª—è reconnect
        Note right of AGENT: ‚îú‚îÄ‚îÄ Retry –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è file operations
        Note right of AGENT: ‚îú‚îÄ‚îÄ Fallback to polling –ø—Ä–∏ inotify —Å–±–æ—è—Ö
        Note right of AGENT: ‚îú‚îÄ‚îÄ Graceful degradation –ø—Ä–∏ partial failures
        Note right of AGENT: ‚îî‚îÄ‚îÄ User notification –ø—Ä–∏ critical errors

        alt –û–±—Ä–∞–±–æ—Ç–∫–∞ network –æ—à–∏–±–∫–∏
            WS_CLIENT->>AGENT: Connection error
            AGENT->>AGENT: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏
            AGENT->>AGENT: Exponential backoff delay
            AGENT->>WS_CLIENT: Retry connection
            AGENT->>USER: "‚ö†Ô∏è Connection lost, retrying..."
        end
        
        alt File system –æ—à–∏–±–∫–∞
            WATCHER->>AGENT: File read error
            AGENT->>AGENT: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏
            AGENT->>AGENT: Skip —Ñ–∞–π–ª –∏ continue
            AGENT->>USER: "‚ö†Ô∏è Cannot read file: {filePath}"
        end
    end