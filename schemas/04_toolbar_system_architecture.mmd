sequenceDiagram
    participant USER as ðŸ‘¤ User
    participant BROWSER as ðŸŒ Browser
    participant TOOLBAR as ðŸ› ï¸ Toolbar UI
    participant UPDATER as ðŸ”„ Update Manager
    participant VITE_PLUGIN as âš¡ Vite Plugin
    participant WS_CLIENT as ðŸ”„ WS Client
    participant WS_SERVER as ðŸ”„ WebSocket Server
    participant R2 as â˜ï¸ R2 Storage
    participant ADMIN as ðŸ‘¨â€ðŸ’¼ Admin Interface

    Note over USER,ADMIN: ðŸ› ï¸ TOOLBAR SYSTEM - Ð”Ð•Ð¢ÐÐ›Ð¬ÐÐÐ¯ ÐÐ Ð¥Ð˜Ð¢Ð•ÐšÐ¢Ð£Ð Ð

    %% === Ð¡Ð¢Ð Ð£ÐšÐ¢Ð£Ð Ð TOOLBAR Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐ« ===
    rect rgb(245, 245, 255)
        Note over TOOLBAR: ðŸ“ Ð¡Ð¢Ð Ð£ÐšÐ¢Ð£Ð Ð TOOLBAR Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐ«
        
        Note left of TOOLBAR: packages/vite-plugin-vybcel/
        Note left of TOOLBAR: â”œâ”€â”€ src/
        Note left of TOOLBAR: â”‚   â”œâ”€â”€ index.ts (plugin entry)
        Note left of TOOLBAR: â”‚   â”œâ”€â”€ plugin.ts (vite plugin)
        Note left of TOOLBAR: â”‚   â”œâ”€â”€ toolbar/
        Note left of TOOLBAR: â”‚   â”‚   â”œâ”€â”€ ToolbarContainer.tsx
        Note left of TOOLBAR: â”‚   â”‚   â”œâ”€â”€ StatusIndicator.tsx
        Note left of TOOLBAR: â”‚   â”‚   â”œâ”€â”€ ActionButtons.tsx
        Note left of TOOLBAR: â”‚   â”‚   â”œâ”€â”€ NotificationToast.tsx
        Note left of TOOLBAR: â”‚   â”‚   â””â”€â”€ ProgressBar.tsx
        Note left of TOOLBAR: â”‚   â”œâ”€â”€ core/
        Note left of TOOLBAR: â”‚   â”‚   â”œâ”€â”€ UpdateManager.ts
        Note left of TOOLBAR: â”‚   â”‚   â”œâ”€â”€ WebSocketClient.ts
        Note left of TOOLBAR: â”‚   â”‚   â”œâ”€â”€ StateManager.ts
        Note left of TOOLBAR: â”‚   â”‚   â””â”€â”€ HotReloader.ts
        Note left of TOOLBAR: â”‚   â”œâ”€â”€ utils/
        Note left of TOOLBAR: â”‚   â”‚   â”œâ”€â”€ checksum.ts
        Note left of TOOLBAR: â”‚   â”‚   â”œâ”€â”€ download.ts
        Note left of TOOLBAR: â”‚   â”‚   â””â”€â”€ logger.ts
        Note left of TOOLBAR: â”‚   â””â”€â”€ types/
        Note left of TOOLBAR: â”‚       â”œâ”€â”€ toolbar.ts
        Note left of TOOLBAR: â”‚       â””â”€â”€ update.ts
        Note left of TOOLBAR: â””â”€â”€ package.json

        Note right of TOOLBAR: ÐšÐžÐœÐŸÐžÐÐ•ÐÐ¢Ð« Ð˜ Ð—ÐÐ’Ð˜Ð¡Ð˜ÐœÐžÐ¡Ð¢Ð˜
        Note right of TOOLBAR: â”œâ”€â”€ React 18 (UI ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ñ‹)
        Note right of TOOLBAR: â”œâ”€â”€ Tailwind CSS (ÑÑ‚Ð¸Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ)
        Note right of TOOLBAR: â”œâ”€â”€ Framer Motion (Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸Ð¸)
        Note right of TOOLBAR: â”œâ”€â”€ Socket.IO Client (WebSocket)
        Note right of TOOLBAR: â”œâ”€â”€ Vite Plugin API (Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ)
        Note right of TOOLBAR: â”œâ”€â”€ Crypto-js (checksum validation)
        Note right of TOOLBAR: â””â”€â”€ LocalStorage API (Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸)
    end

    %% === VITE PLUGIN Ð˜ÐÐ¢Ð•Ð“Ð ÐÐ¦Ð˜Ð¯ ===
    rect rgb(240, 248, 255)
        Note over VITE_PLUGIN: âš¡ VITE PLUGIN Ð˜ÐÐ¢Ð•Ð“Ð ÐÐ¦Ð˜Ð¯
        
        Note left of VITE_PLUGIN: PLUGIN Ð¥Ð£ÐšÐ˜ Ð˜ ÐœÐ•Ð¢ÐžÐ”Ð«
        Note left of VITE_PLUGIN: â”œâ”€â”€ configResolved() - Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ ÐºÐ¾Ð½Ñ„Ð¸Ð³Ð°
        Note left of VITE_PLUGIN: â”œâ”€â”€ configureServer() - dev server setup
        Note left of VITE_PLUGIN: â”œâ”€â”€ transformIndexHtml() - HTML injection
        Note left of VITE_PLUGIN: â”œâ”€â”€ generateBundle() - build-time injection
        Note left of VITE_PLUGIN: â””â”€â”€ closeBundle() - cleanup

        Note right of VITE_PLUGIN: ÐÐ’Ð¢ÐžÐœÐÐ¢Ð˜Ð§Ð•Ð¡ÐšÐžÐ• Ð’ÐÐ•Ð”Ð Ð•ÐÐ˜Ð•
        Note right of VITE_PLUGIN: â”œâ”€â”€ Ð§Ñ‚ÐµÐ½Ð¸Ðµ vybcel.config.json
        Note right of VITE_PLUGIN: â”œâ”€â”€ Injection toolbar script Ð² HTML
        Note right of VITE_PLUGIN: â”œâ”€â”€ HMR Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ð´Ð»Ñ hot updates
        Note right of VITE_PLUGIN: â”œâ”€â”€ CSS injection Ð´Ð»Ñ ÑÑ‚Ð¸Ð»ÐµÐ¹
        Note right of VITE_PLUGIN: â””â”€â”€ Environment variables injection

        alt Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ plugin
            VITE_PLUGIN->>VITE_PLUGIN: configResolved() hook
            VITE_PLUGIN->>VITE_PLUGIN: Ð§Ñ‚ÐµÐ½Ð¸Ðµ vybcel.config.json
            VITE_PLUGIN->>VITE_PLUGIN: ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ PROJECT_ID
            VITE_PLUGIN->>VITE_PLUGIN: ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° toolbar options
        end
        
        alt HTML injection
            VITE_PLUGIN->>VITE_PLUGIN: transformIndexHtml() hook
            VITE_PLUGIN->>VITE_PLUGIN: Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ toolbar script tag
            VITE_PLUGIN->>VITE_PLUGIN: Injection Ð² <head> Ð¸Ð»Ð¸ <body>
            VITE_PLUGIN->>BROWSER: HTML Ñ Ð²ÑÑ‚Ñ€Ð¾ÐµÐ½Ð½Ñ‹Ð¼ toolbar
        end
        
        alt Hot Module Replacement
            VITE_PLUGIN->>VITE_PLUGIN: HMR update event
            VITE_PLUGIN->>TOOLBAR: ÐŸÐµÑ€ÐµÐ·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° toolbar ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ð¾Ð²
            VITE_PLUGIN->>BROWSER: ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð±ÐµÐ· full reload
        end
    end

    %% === TOOLBAR UI ÐšÐžÐœÐŸÐžÐÐ•ÐÐ¢Ð« ===
    rect rgb(255, 250, 245)
        Note over TOOLBAR: ðŸŽ¨ TOOLBAR UI ÐšÐžÐœÐŸÐžÐÐ•ÐÐ¢Ð«
        
        Note left of TOOLBAR: ÐžÐ¡ÐÐžÐ’ÐÐ«Ð• ÐšÐžÐœÐŸÐžÐÐ•ÐÐ¢Ð«
        Note left of TOOLBAR: â”œâ”€â”€ ToolbarContainer
        Note left of TOOLBAR: â”‚   â”œâ”€â”€ Ð“Ð»Ð°Ð²Ð½Ñ‹Ð¹ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€
        Note left of TOOLBAR: â”‚   â”œâ”€â”€ ÐŸÐ¾Ð·Ð¸Ñ†Ð¸Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ (fixed)
        Note left of TOOLBAR: â”‚   â”œâ”€â”€ z-index management
        Note left of TOOLBAR: â”‚   â””â”€â”€ Responsive design
        Note left of TOOLBAR: â”œâ”€â”€ StatusIndicator
        Note left of TOOLBAR: â”‚   â”œâ”€â”€ Connection status
        Note left of TOOLBAR: â”‚   â”œâ”€â”€ Pending changes count
        Note left of TOOLBAR: â”‚   â”œâ”€â”€ Deploy status
        Note left of TOOLBAR: â”‚   â””â”€â”€ Loading states
        Note left of TOOLBAR: â”œâ”€â”€ ActionButtons
        Note left of TOOLBAR: â”‚   â”œâ”€â”€ Save All Changes
        Note left of TOOLBAR: â”‚   â”œâ”€â”€ Discard All Changes
        Note left of TOOLBAR: â”‚   â”œâ”€â”€ Force Reload
        Note left of TOOLBAR: â”‚   â””â”€â”€ Settings Menu
        Note left of TOOLBAR: â””â”€â”€ NotificationToast
        Note left of TOOLBAR:     â”œâ”€â”€ Success messages
        Note left of TOOLBAR:     â”œâ”€â”€ Error messages
        Note left of TOOLBAR:     â”œâ”€â”€ Update notifications
        Note left of TOOLBAR:     â””â”€â”€ Auto-dismiss timers

        Note right of TOOLBAR: Ð¡Ð¢Ð˜Ð›Ð˜ Ð˜ ÐÐÐ˜ÐœÐÐ¦Ð˜Ð˜
        Note right of TOOLBAR: â”œâ”€â”€ Tailwind CSS utilities
        Note right of TOOLBAR: â”œâ”€â”€ Custom CSS variables
        Note right of TOOLBAR: â”œâ”€â”€ Framer Motion animations
        Note right of TOOLBAR: â”œâ”€â”€ Hover states
        Note right of TOOLBAR: â”œâ”€â”€ Loading spinners
        Note right of TOOLBAR: â””â”€â”€ Smooth transitions

        alt ÐžÑ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ toolbar
            BROWSER->>TOOLBAR: DOM load complete
            TOOLBAR->>TOOLBAR: ToolbarContainer render
            TOOLBAR->>TOOLBAR: Ð§Ñ‚ÐµÐ½Ð¸Ðµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ Ð¸Ð· localStorage
            TOOLBAR->>WS_CLIENT: Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ WebSocket
            TOOLBAR-->>BROWSER: Toolbar UI visible
        end
        
        alt ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÑÐºÐ¾Ðµ Ð²Ð·Ð°Ð¸Ð¼Ð¾Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ
            USER->>TOOLBAR: ÐšÐ»Ð¸Ðº Ð½Ð° Save All Changes
            TOOLBAR->>TOOLBAR: ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ UI ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ
            TOOLBAR->>WS_CLIENT: emit('save_all_changes')
            TOOLBAR->>TOOLBAR: ÐŸÐ¾ÐºÐ°Ð· loading spinner
        end
    end

    %% === UPDATE MANAGER ===
    rect rgb(250, 255, 245)
        Note over UPDATER: ðŸ”„ UPDATE MANAGER
        
        Note left of UPDATER: ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ ÐžÐ‘ÐÐžÐ’Ð›Ð•ÐÐ˜Ð™
        Note left of UPDATER: â”œâ”€â”€ ÐÐ²Ñ‚Ð¾Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° ÐºÐ°Ð¶Ð´Ñ‹Ðµ 5 Ð¼Ð¸Ð½ÑƒÑ‚
        Note left of UPDATER: â”œâ”€â”€ Manual check (Ctrl+Shift+U)
        Note left of UPDATER: â”œâ”€â”€ WebSocket push notifications
        Note left of UPDATER: â”œâ”€â”€ Version comparison (semver)
        Note left of UPDATER: â””â”€â”€ Channel management (stable/beta/dev)

        Note right of UPDATER: ÐŸÐ ÐžÐ¦Ð•Ð¡Ð¡ ÐžÐ‘ÐÐžÐ’Ð›Ð•ÐÐ˜Ð¯
        Note right of UPDATER: â”œâ”€â”€ Download Ð½Ð¾Ð²Ð¾Ð¹ Ð²ÐµÑ€ÑÐ¸Ð¸
        Note right of UPDATER: â”œâ”€â”€ Checksum validation
        Note right of UPDATER: â”œâ”€â”€ Backup Ñ‚ÐµÐºÑƒÑ‰ÐµÐ¹ Ð²ÐµÑ€ÑÐ¸Ð¸
        Note right of UPDATER: â”œâ”€â”€ Hot Module Replacement
        Note right of UPDATER: â”œâ”€â”€ State preservation
        Note right of UPDATER: â””â”€â”€ Rollback Ð¿Ñ€Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ°Ñ…

        alt ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ°
            UPDATER->>UPDATER: setInterval(5 Ð¼Ð¸Ð½ÑƒÑ‚)
            UPDATER->>R2: GET /api/toolbar/check
            R2-->>UPDATER: {hasUpdate: true, version: "0.2.1"}
            UPDATER->>UPDATER: Ð¡Ñ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ Ð²ÐµÑ€ÑÐ¸Ð¹
            UPDATER->>TOOLBAR: ÐŸÐ¾ÐºÐ°Ð· ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ Ð¾Ð± Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¸
        end
        
        alt Ð¡ÐºÐ°Ñ‡Ð¸Ð²Ð°Ð½Ð¸Ðµ Ð¸ Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ
            UPDATER->>R2: Download Ð½Ð¾Ð²Ð¾Ð¹ Ð²ÐµÑ€ÑÐ¸Ð¸ toolbar
            R2-->>UPDATER: ZIP Ñ„Ð°Ð¹Ð» Ñ Ð½Ð¾Ð²Ñ‹Ð¼ ÐºÐ¾Ð´Ð¾Ð¼
            UPDATER->>UPDATER: Checksum validation
            UPDATER->>UPDATER: Backup current version
            UPDATER->>VITE_PLUGIN: Hot Module Replacement
            UPDATER->>TOOLBAR: UI ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ðµ Ð¾ ÑƒÑÐ¿ÐµÑ…Ðµ
        end
        
        alt WebSocket push Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ
            WS_SERVER->>WS_CLIENT: emit('toolbar_update_available')
            WS_CLIENT->>UPDATER: ÐÐµÐ¼ÐµÐ´Ð»ÐµÐ½Ð½Ð°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ°
            UPDATER->>R2: Ð¡ÐºÐ°Ñ‡Ð¸Ð²Ð°Ð½Ð¸Ðµ ÐºÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð³Ð¾ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ
            UPDATER->>TOOLBAR: ÐŸÑ€Ð¸Ð½ÑƒÐ´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ
        end
    end

    %% === WEBSOCKET Ð˜ÐÐ¢Ð•Ð“Ð ÐÐ¦Ð˜Ð¯ ===
    rect rgb(255, 245, 250)
        Note over WS_CLIENT: ðŸ”„ WEBSOCKET CLIENT Ð˜ÐÐ¢Ð•Ð“Ð ÐÐ¦Ð˜Ð¯
        
        Note left of WS_CLIENT: ÐŸÐžÐ”ÐšÐ›Ð®Ð§Ð•ÐÐ˜Ð• Ð˜ Ð¡ÐžÐ‘Ð«Ð¢Ð˜Ð¯
        Note left of WS_CLIENT: â”œâ”€â”€ ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐµ
        Note left of WS_CLIENT: â”œâ”€â”€ ÐÑƒÑ‚ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ Ñ PROJECT_ID
        Note left of WS_CLIENT: â”œâ”€â”€ Heartbeat/keepalive
        Note left of WS_CLIENT: â”œâ”€â”€ Reconnection logic
        Note left of WS_CLIENT: â””â”€â”€ Error handling

        Note right of WS_CLIENT: TOOLBAR SPECIFIC Ð¡ÐžÐ‘Ð«Ð¢Ð˜Ð¯
        Note right of WS_CLIENT: ÐžÐ¢ÐŸÐ ÐÐ’Ð›Ð¯Ð•ÐœÐ«Ð•:
        Note right of WS_CLIENT: â”œâ”€â”€ toolbar_connected
        Note right of WS_CLIENT: â”œâ”€â”€ save_all_changes
        Note right of WS_CLIENT: â”œâ”€â”€ discard_all_changes
        Note right of WS_CLIENT: â””â”€â”€ toolbar_status_update
        Note right of WS_CLIENT: ÐŸÐžÐ›Ð£Ð§ÐÐ•ÐœÐ«Ð•:
        Note right of WS_CLIENT: â”œâ”€â”€ toolbar_update_available
        Note right of WS_CLIENT: â”œâ”€â”€ pending_changes_updated
        Note right of WS_CLIENT: â”œâ”€â”€ deploy_status_update
        Note right of WS_CLIENT: â””â”€â”€ commit_created

        alt ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ toolbar Ðº ÑÐµÑ€Ð²ÐµÑ€Ñƒ
            TOOLBAR->>WS_CLIENT: Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ
            WS_CLIENT->>WS_SERVER: WebSocket connection
            WS_CLIENT->>WS_SERVER: emit('toolbar_connected', {projectId})
            WS_SERVER-->>WS_CLIENT: emit('authenticated')
            WS_CLIENT->>TOOLBAR: Connection established
        end
        
        alt Real-time ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ
            WS_SERVER->>WS_CLIENT: emit('pending_changes_updated', {count: 3})
            WS_CLIENT->>TOOLBAR: ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ counter Ð² UI
            TOOLBAR->>TOOLBAR: ÐÐ½Ð¸Ð¼Ð°Ñ†Ð¸Ñ counter Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ
        end
    end

    %% === R2 STORAGE Ð˜ÐÐ¢Ð•Ð“Ð ÐÐ¦Ð˜Ð¯ ===
    rect rgb(250, 245, 255)
        Note over R2: â˜ï¸ R2 STORAGE Ð”Ð›Ð¯ TOOLBAR Ð’Ð•Ð Ð¡Ð˜Ð™
        
        Note left of R2: Ð¡Ð¢Ð Ð£ÐšÐ¢Ð£Ð Ð Ð¥Ð ÐÐÐ˜Ð›Ð˜Ð©Ð
        Note left of R2: â”œâ”€â”€ toolbar-versions/
        Note left of R2: â”‚   â”œâ”€â”€ 0.1.0/
        Note left of R2: â”‚   â”‚   â”œâ”€â”€ stable/toolbar.zip
        Note left of R2: â”‚   â”‚   â”œâ”€â”€ beta/toolbar.zip
        Note left of R2: â”‚   â”‚   â””â”€â”€ dev/toolbar.zip
        Note left of R2: â”‚   â”œâ”€â”€ 0.2.0/
        Note left of R2: â”‚   â””â”€â”€ latest/
        Note left of R2: â”‚       â””â”€â”€ metadata.json
        Note left of R2: â””â”€â”€ checksums/
        Note left of R2:     â””â”€â”€ {version}-{channel}.sha256

        Note right of R2: ÐžÐŸÐ•Ð ÐÐ¦Ð˜Ð˜ Ð¡ Ð’Ð•Ð Ð¡Ð˜Ð¯ÐœÐ˜
        Note right of R2: â”œâ”€â”€ Upload Ð½Ð¾Ð²Ñ‹Ñ… Ð²ÐµÑ€ÑÐ¸Ð¹
        Note right of R2: â”œâ”€â”€ Download Ð¿Ð¾ Ð²ÐµÑ€ÑÐ¸Ð¸/ÐºÐ°Ð½Ð°Ð»Ñƒ
        Note right of R2: â”œâ”€â”€ Metadata management
        Note right of R2: â”œâ”€â”€ Checksum validation
        Note right of R2: â””â”€â”€ Cleanup ÑÑ‚Ð°Ñ€Ñ‹Ñ… Ð²ÐµÑ€ÑÐ¸Ð¹

        Note over R2: METADATA Ð¡Ð¢Ð Ð£ÐšÐ¢Ð£Ð Ð
        Note over R2: {
        Note over R2:   "latestVersion": "0.2.1",
        Note over R2:   "channels": {
        Note over R2:     "stable": "0.2.0",
        Note over R2:     "beta": "0.2.1",
        Note over R2:     "dev": "0.3.0-alpha"
        Note over R2:   },
        Note over R2:   "forceUpdate": false,
        Note over R2:   "releaseNotes": "Bug fixes..."
        Note over R2: }

        alt ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¹
            UPDATER->>R2: GET /toolbar-versions/latest/metadata.json
            R2-->>UPDATER: Metadata Ñ Ð²ÐµÑ€ÑÐ¸ÑÐ¼Ð¸ ÐºÐ°Ð½Ð°Ð»Ð¾Ð²
            UPDATER->>UPDATER: Ð¡Ñ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ Ñ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ¹ Ð²ÐµÑ€ÑÐ¸ÐµÐ¹
            UPDATER->>UPDATER: ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ
        end
        
        alt Ð¡ÐºÐ°Ñ‡Ð¸Ð²Ð°Ð½Ð¸Ðµ Ð½Ð¾Ð²Ð¾Ð¹ Ð²ÐµÑ€ÑÐ¸Ð¸
            UPDATER->>R2: GET /toolbar-versions/0.2.1/stable/toolbar.zip
            R2-->>UPDATER: ZIP Ð°Ñ€Ñ…Ð¸Ð² Ñ Ð½Ð¾Ð²Ñ‹Ð¼ ÐºÐ¾Ð´Ð¾Ð¼
            UPDATER->>R2: GET /checksums/0.2.1-stable.sha256
            R2-->>UPDATER: Checksum Ð´Ð»Ñ Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸
            UPDATER->>UPDATER: Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ñ†ÐµÐ»Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚Ð¸
        end
    end

    %% === ADMIN INTERFACE ===
    rect rgb(255, 255, 240)
        Note over ADMIN: ðŸ‘¨â€ðŸ’¼ ADMIN INTERFACE
        
        Note left of ADMIN: WEB ADMIN ÐŸÐÐÐ•Ð›Ð¬
        Note left of ADMIN: â”œâ”€â”€ /admin/toolbar ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ð°
        Note left of ADMIN: â”œâ”€â”€ Upload Ð½Ð¾Ð²Ñ‹Ñ… Ð²ÐµÑ€ÑÐ¸Ð¹
        Note left of ADMIN: â”œâ”€â”€ Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ ÐºÐ°Ð½Ð°Ð»Ð°Ð¼Ð¸
        Note left of ADMIN: â”œâ”€â”€ Push notifications
        Note left of ADMIN: â”œâ”€â”€ Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¹
        Note left of ADMIN: â””â”€â”€ Rollback Ð¼ÐµÑ…Ð°Ð½Ð¸Ð·Ð¼

        Note right of ADMIN: Ð¤Ð£ÐÐšÐ¦Ð˜Ð˜ Ð£ÐŸÐ ÐÐ’Ð›Ð•ÐÐ˜Ð¯
        Note right of ADMIN: â”œâ”€â”€ Drag & Drop file upload
        Note right of ADMIN: â”œâ”€â”€ Version numbering (semver)
        Note right of ADMIN: â”œâ”€â”€ Release notes editor
        Note right of ADMIN: â”œâ”€â”€ Channel assignment
        Note right of ADMIN: â”œâ”€â”€ Force update flags
        Note right of ADMIN: â””â”€â”€ Broadcast to active users

        alt Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð½Ð¾Ð²Ð¾Ð¹ Ð²ÐµÑ€ÑÐ¸Ð¸
            USER->>ADMIN: Drag & drop ZIP Ñ„Ð°Ð¹Ð»Ð°
            ADMIN->>ADMIN: Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ñ„Ð°Ð¹Ð»Ð°
            ADMIN->>R2: Upload Ð² R2 storage
            ADMIN->>ADMIN: Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ checksum
            ADMIN->>R2: ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ metadata.json
        end
        
        alt Ð Ð°ÑÑÑ‹Ð»ÐºÐ° Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ
            USER->>ADMIN: ÐšÐ»Ð¸Ðº "Broadcast Update"
            ADMIN->>WS_SERVER: POST /api/toolbar/broadcast
            WS_SERVER->>WS_CLIENT: emit('toolbar_update_available')
            WS_CLIENT->>UPDATER: ÐŸÑ€Ð¸Ð½ÑƒÐ´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ°
            UPDATER->>TOOLBAR: ÐÐ²Ñ‚Ð¾Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ
        end
    end

    %% === HOT MODULE REPLACEMENT ===
    rect rgb(245, 255, 245)
        Note over TOOLBAR: ðŸ”¥ HOT MODULE REPLACEMENT
        
        Note left of TOOLBAR: HMR ÐœÐ•Ð¥ÐÐÐ˜Ð—Ðœ
        Note left of TOOLBAR: â”œâ”€â”€ Vite HMR API integration
        Note left of TOOLBAR: â”œâ”€â”€ Module replacement Ð±ÐµÐ· reload
        Note left of TOOLBAR: â”œâ”€â”€ State preservation
        Note left of TOOLBAR: â”œâ”€â”€ Component tree update
        Note left of TOOLBAR: â””â”€â”€ CSS hot reload

        Note right of TOOLBAR: ÐŸÐ ÐžÐ¦Ð•Ð¡Ð¡ ÐžÐ‘ÐÐžÐ’Ð›Ð•ÐÐ˜Ð¯
        Note right of TOOLBAR: â”œâ”€â”€ ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð½Ð¾Ð²Ñ‹Ñ… Ð¼Ð¾Ð´ÑƒÐ»ÐµÐ¹
        Note right of TOOLBAR: â”œâ”€â”€ Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ
        Note right of TOOLBAR: â”œâ”€â”€ Ð—Ð°Ð¼ÐµÐ½Ð° Ð¼Ð¾Ð´ÑƒÐ»ÐµÐ¹ Ð² runtime
        Note right of TOOLBAR: â”œâ”€â”€ Ð’Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ
        Note right of TOOLBAR: â””â”€â”€ Re-render ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ð¾Ð²

        alt HMR Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ
            UPDATER->>VITE_PLUGIN: ÐÐ¾Ð²Ñ‹Ðµ Ð¼Ð¾Ð´ÑƒÐ»Ð¸ Ð³Ð¾Ñ‚Ð¾Ð²Ñ‹
            VITE_PLUGIN->>TOOLBAR: HMR update event
            TOOLBAR->>TOOLBAR: Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ
            TOOLBAR->>TOOLBAR: Ð—Ð°Ð¼ÐµÐ½Ð° ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ð¾Ð²
            TOOLBAR->>TOOLBAR: Ð’Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ
            TOOLBAR-->>USER: Seamless update Ð±ÐµÐ· reload
        end
    end

    %% === ÐšÐžÐÐ¤Ð˜Ð“Ð£Ð ÐÐ¦Ð˜Ð¯ Ð˜ ÐÐÐ¡Ð¢Ð ÐžÐ™ÐšÐ˜ ===
    rect rgb(255, 250, 240)
        Note over TOOLBAR: âš™ï¸ ÐšÐžÐÐ¤Ð˜Ð“Ð£Ð ÐÐ¦Ð˜Ð¯ Ð˜ ÐÐÐ¡Ð¢Ð ÐžÐ™ÐšÐ˜
        
        Note left of TOOLBAR: ÐŸÐžÐ›Ð¬Ð—ÐžÐ’ÐÐ¢Ð•Ð›Ð¬Ð¡ÐšÐ˜Ð• ÐÐÐ¡Ð¢Ð ÐžÐ™ÐšÐ˜
        Note left of TOOLBAR: â”œâ”€â”€ ÐŸÐ¾Ð·Ð¸Ñ†Ð¸Ñ toolbar (corners)
        Note left of TOOLBAR: â”œâ”€â”€ Ð¢ÐµÐ¼Ð° Ð¾Ñ„Ð¾Ñ€Ð¼Ð»ÐµÐ½Ð¸Ñ (light/dark)
        Note left of TOOLBAR: â”œâ”€â”€ ÐÐ²Ñ‚Ð¾Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ (on/off)
        Note left of TOOLBAR: â”œâ”€â”€ Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ (types)
        Note left of TOOLBAR: â”œâ”€â”€ Ð“Ð¾Ñ€ÑÑ‡Ð¸Ðµ ÐºÐ»Ð°Ð²Ð¸ÑˆÐ¸
        Note left of TOOLBAR: â””â”€â”€ Channel preference

        Note right of TOOLBAR: ÐŸÐ ÐžÐ•ÐšÐ¢ÐÐ«Ð• ÐÐÐ¡Ð¢Ð ÐžÐ™ÐšÐ˜
        Note right of TOOLBAR: â”œâ”€â”€ vybcel.config.json
        Note right of TOOLBAR: â”‚   â”œâ”€â”€ projectId
        Note right of TOOLBAR: â”‚   â”œâ”€â”€ serverUrl
        Note right of TOOLBAR: â”‚   â”œâ”€â”€ updateChannel
        Note right of TOOLBAR: â”‚   â””â”€â”€ toolbarOptions
        Note right of TOOLBAR: â”œâ”€â”€ LocalStorage preferences
        Note right of TOOLBAR: â””â”€â”€ Environment variables

        alt Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐº
            USER->>TOOLBAR: ÐžÑ‚ÐºÑ€Ñ‹Ñ‚Ð¸Ðµ settings menu
            TOOLBAR->>TOOLBAR: ÐžÑ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐº
            USER->>TOOLBAR: Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ position/theme
            TOOLBAR->>TOOLBAR: Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð² localStorage
            TOOLBAR->>TOOLBAR: ÐŸÑ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹
        end
    end

    %% === ÐŸÐ ÐžÐ˜Ð—Ð’ÐžÐ”Ð˜Ð¢Ð•Ð›Ð¬ÐÐžÐ¡Ð¢Ð¬ Ð˜ ÐžÐŸÐ¢Ð˜ÐœÐ˜Ð—ÐÐ¦Ð˜Ð¯ ===
    rect rgb(250, 250, 255)
        Note over TOOLBAR: âš¡ ÐŸÐ ÐžÐ˜Ð—Ð’ÐžÐ”Ð˜Ð¢Ð•Ð›Ð¬ÐÐžÐ¡Ð¢Ð¬ Ð˜ ÐžÐŸÐ¢Ð˜ÐœÐ˜Ð—ÐÐ¦Ð˜Ð¯
        
        Note left of TOOLBAR: ÐžÐŸÐ¢Ð˜ÐœÐ˜Ð—ÐÐ¦Ð˜Ð˜
        Note left of TOOLBAR: â”œâ”€â”€ Lazy loading ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ð¾Ð²
        Note left of TOOLBAR: â”œâ”€â”€ Debounced user interactions
        Note left of TOOLBAR: â”œâ”€â”€ Minimal re-renders
        Note left of TOOLBAR: â”œâ”€â”€ Efficient state management
        Note left of TOOLBAR: â”œâ”€â”€ CSS containment
        Note left of TOOLBAR: â””â”€â”€ Bundle size optimization

        Note right of TOOLBAR: ÐœÐžÐÐ˜Ð¢ÐžÐ Ð˜ÐÐ“
        Note right of TOOLBAR: â”œâ”€â”€ Performance metrics
        Note right of TOOLBAR: â”œâ”€â”€ Update success rate
        Note right of TOOLBAR: â”œâ”€â”€ Error tracking
        Note right of TOOLBAR: â”œâ”€â”€ User engagement
        Note right of TOOLBAR: â””â”€â”€ Network efficiency

        alt Performance monitoring
            TOOLBAR->>TOOLBAR: performance.mark('start')
            TOOLBAR->>UPDATER: Check for updates
            TOOLBAR->>TOOLBAR: performance.mark('end')
            TOOLBAR->>TOOLBAR: performance.measure('update-check')
        end
    end

    %% === Ð‘Ð•Ð—ÐžÐŸÐÐ¡ÐÐžÐ¡Ð¢Ð¬ ===
    rect rgb(255, 245, 245)
        Note over TOOLBAR: ðŸ”’ Ð‘Ð•Ð—ÐžÐŸÐÐ¡ÐÐžÐ¡Ð¢Ð¬ Ð˜ Ð’ÐÐ›Ð˜Ð”ÐÐ¦Ð˜Ð¯
        
        Note left of TOOLBAR: Ð‘Ð•Ð—ÐžÐŸÐÐ¡ÐÐžÐ¡Ð¢Ð¬ ÐžÐ‘ÐÐžÐ’Ð›Ð•ÐÐ˜Ð™
        Note left of TOOLBAR: â”œâ”€â”€ Checksum validation (SHA-256)
        Note left of TOOLBAR: â”œâ”€â”€ Source verification
        Note left of TOOLBAR: â”œâ”€â”€ HTTPS only downloads
        Note left of TOOLBAR: â”œâ”€â”€ Sandboxed execution
        Note left of TOOLBAR: â””â”€â”€ Rollback Ð¿Ñ€Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ°Ñ…

        Note right of TOOLBAR: Ð—ÐÐ©Ð˜Ð¢Ð ÐžÐ¢ ÐÐ¢ÐÐš
        Note right of TOOLBAR: â”œâ”€â”€ CSP (Content Security Policy)
        Note right of TOOLBAR: â”œâ”€â”€ XSS protection
        Note right of TOOLBAR: â”œâ”€â”€ Code injection prevention
        Note right of TOOLBAR: â”œâ”€â”€ Secure WebSocket (WSS)
        Note right of TOOLBAR: â””â”€â”€ Rate limiting

        alt Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ
            UPDATER->>R2: Download update + checksum
            UPDATER->>UPDATER: SHA-256 verification
            alt Valid checksum
                UPDATER->>TOOLBAR: ÐŸÑ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ
            else Invalid checksum
                UPDATER->>TOOLBAR: ÐžÑˆÐ¸Ð±ÐºÐ° + rollback
                UPDATER->>ADMIN: Report security issue
            end
        end
    end