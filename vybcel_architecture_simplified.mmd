sequenceDiagram
    participant U as ðŸ‘¤ User
    participant B as ðŸŒ Web App
    participant V as ðŸ’» Editor
    participant TB as ðŸ› ï¸ Toolbar
    participant WS as ðŸ”„ WebSocket
    participant R2 as â˜ï¸ R2 Storage
    participant GH as ðŸ™ GitHub
    participant N as ðŸ”¥ Netlify

    Note over U,N: ðŸš€ VYBCEL ARCHITECTURE - Auto-Update Toolbar + GitHub App + Serverless

    %% === TOOLBAR AUTO-UPDATE SYSTEM ===
    rect rgb(255, 245, 255)
        Note over TB,R2: ðŸ› ï¸ TOOLBAR AUTO-UPDATE SYSTEM
        
        TB->>TB: Check for updates every 5 minutes
        TB->>B: GET /api/toolbar/check
        B->>R2: Check metadata files
        R2-->>B: Return update info
        B-->>TB: hasUpdate, latestVersion
        
        alt Update available
            TB->>TB: Download and apply update
            TB->>TB: Show "Toolbar updated to v0.2.1"
        else No updates
            TB->>TB: Continue with current version
        end
        
        Note over TB,R2: Hot reload without page refresh
        Note over TB,R2: Channels: stable/beta/dev
        Note over TB,R2: Checksum validation + fallback
    end

    %% === PROJECT CREATION ===
    rect rgb(240, 248, 255)
        Note over U,N: 1ï¸âƒ£ PROJECT CREATION
        
        U->>B: Create New Project
        B->>WS: Create repository
        WS->>GH: Create private repo
        GH-->>WS: Return repo details
        WS->>WS: Generate template files
        WS->>GH: Upload template to repo
        WS-->>B: Project ready
        B-->>U: Download link available
    end

    %% === LOCAL DEVELOPMENT ===
    rect rgb(250, 255, 250)
        Note over U,TB: 2ï¸âƒ£ LOCAL DEVELOPMENT
        
        U->>V: Open project in editor
        U->>U: Run pnpm start
        
        TB->>WS: Connect toolbar
        WS->>TB: Send project status
        TB->>TB: Show pending changes counter
        
        loop File editing
            U->>V: Edit file and save
            V->>WS: File change detected
            WS->>TB: Update pending changes
            TB->>TB: Update counter "3 unsaved changes"
        end
    end

    %% === SAVE/DISCARD ACTIONS ===
    rect rgb(245, 255, 245)
        Note over TB,GH: 3ï¸âƒ£ SAVE/DISCARD ACTIONS
        
        alt Save All Changes
            U->>TB: Click Save All
            TB->>WS: emit save_all_changes
            WS->>GH: Create commit
            GH-->>WS: Commit successful
            WS->>N: Auto-deploy triggered
            WS->>TB: Show "Changes saved!"
        else Discard All Changes
            U->>TB: Click Discard All
            TB->>WS: emit discard_all_changes
            WS->>V: git reset --hard HEAD
            WS->>TB: Show "Changes discarded"
        end
    end

    %% === INSTANT UPDATES ===
    rect rgb(255, 250, 240)
        Note over WS,TB: 4ï¸âƒ£ INSTANT TOOLBAR UPDATES
        
        Note over WS: CLI Deploy Tool
        WS->>R2: Upload new toolbar version
        WS->>WS: io.emit('toolbar_update_available')
        WS->>TB: Push update notification
        TB->>TB: Download and apply instantly
        TB->>TB: Show "Critical update applied"
        
        Note over WS,TB: WebSocket push for instant updates
        Note over WS,TB: Admin interface for version management
    end

    %% === KEY FEATURES ===
    rect rgb(230, 255, 230)
        Note over U,N: ðŸŽ¯ KEY FEATURES
        
        Note over TB: Built-in toolbar in every project
        Note over TB: Auto-updates without npm restart
        Note over TB: Hot Module Replacement
        Note over R2: Version storage with checksums
        Note over WS: Real-time WebSocket sync
        Note over GH: GitHub App - no user login needed
        Note over N: Auto-deploy on every commit
        
        Note over U,N: Complete development workflow with instant patches
    end 