"use strict";var Za=Object.create;var zt=Object.defineProperty;var ec=Object.getOwnPropertyDescriptor;var tc=Object.getOwnPropertyNames;var rc=Object.getPrototypeOf,sc=Object.prototype.hasOwnProperty;var pt=(r,e)=>()=>(r&&(e=r(r=0)),e);var v=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),Hr=(r,e)=>{for(var t in e)zt(r,t,{get:e[t],enumerable:!0})},un=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of tc(e))!sc.call(r,n)&&n!==t&&zt(r,n,{get:()=>e[n],enumerable:!(s=ec(e,n))||s.enumerable});return r};var w=(r,e,t)=>(t=r!=null?Za(rc(r)):{},un(e||!r||!r.__esModule?zt(t,"default",{value:r,enumerable:!0}):t,r)),nc=r=>un(zt({},"__esModule",{value:!0}),r);var zr=v((du,dn)=>{var Ve=1e3,$e=Ve*60,Ge=$e*60,Pe=Ge*24,ic=Pe*7,oc=Pe*365.25;dn.exports=function(r,e){e=e||{};var t=typeof r;if(t==="string"&&r.length>0)return ac(r);if(t==="number"&&isFinite(r))return e.long?lc(r):cc(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function ac(r){if(r=String(r),!(r.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(e){var t=parseFloat(e[1]),s=(e[2]||"ms").toLowerCase();switch(s){case"years":case"year":case"yrs":case"yr":case"y":return t*oc;case"weeks":case"week":case"w":return t*ic;case"days":case"day":case"d":return t*Pe;case"hours":case"hour":case"hrs":case"hr":case"h":return t*Ge;case"minutes":case"minute":case"mins":case"min":case"m":return t*$e;case"seconds":case"second":case"secs":case"sec":case"s":return t*Ve;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function cc(r){var e=Math.abs(r);return e>=Pe?Math.round(r/Pe)+"d":e>=Ge?Math.round(r/Ge)+"h":e>=$e?Math.round(r/$e)+"m":e>=Ve?Math.round(r/Ve)+"s":r+"ms"}function lc(r){var e=Math.abs(r);return e>=Pe?Yt(r,e,Pe,"day"):e>=Ge?Yt(r,e,Ge,"hour"):e>=$e?Yt(r,e,$e,"minute"):e>=Ve?Yt(r,e,Ve,"second"):r+" ms"}function Yt(r,e,t,s){var n=e>=t*1.5;return Math.round(r/t)+" "+s+(n?"s":"")}});var Yr=v((pu,pn)=>{function hc(r){t.debug=t,t.default=t,t.coerce=h,t.disable=o,t.enable=n,t.enabled=a,t.humanize=zr(),t.destroy=l,Object.keys(r).forEach(c=>{t[c]=r[c]}),t.names=[],t.skips=[],t.formatters={};function e(c){let f=0;for(let u=0;u<c.length;u++)f=(f<<5)-f+c.charCodeAt(u),f|=0;return t.colors[Math.abs(f)%t.colors.length]}t.selectColor=e;function t(c){let f,u=null,p,_;function d(...g){if(!d.enabled)return;let x=d,C=Number(new Date),m=C-(f||C);x.diff=m,x.prev=f,x.curr=C,f=C,g[0]=t.coerce(g[0]),typeof g[0]!="string"&&g.unshift("%O");let y=0;g[0]=g[0].replace(/%([a-zA-Z%])/g,(k,R)=>{if(k==="%%")return"%";y++;let M=t.formatters[R];if(typeof M=="function"){let $=g[y];k=M.call(x,$),g.splice(y,1),y--}return k}),t.formatArgs.call(x,g),(x.log||t.log).apply(x,g)}return d.namespace=c,d.useColors=t.useColors(),d.color=t.selectColor(c),d.extend=s,d.destroy=t.destroy,Object.defineProperty(d,"enabled",{enumerable:!0,configurable:!1,get:()=>u!==null?u:(p!==t.namespaces&&(p=t.namespaces,_=t.enabled(c)),_),set:g=>{u=g}}),typeof t.init=="function"&&t.init(d),d}function s(c,f){let u=t(this.namespace+(typeof f>"u"?":":f)+c);return u.log=this.log,u}function n(c){t.save(c),t.namespaces=c,t.names=[],t.skips=[];let f=(typeof c=="string"?c:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(let u of f)u[0]==="-"?t.skips.push(u.slice(1)):t.names.push(u)}function i(c,f){let u=0,p=0,_=-1,d=0;for(;u<c.length;)if(p<f.length&&(f[p]===c[u]||f[p]==="*"))f[p]==="*"?(_=p,d=u,p++):(u++,p++);else if(_!==-1)p=_+1,d++,u=d;else return!1;for(;p<f.length&&f[p]==="*";)p++;return p===f.length}function o(){let c=[...t.names,...t.skips.map(f=>"-"+f)].join(",");return t.enable(""),c}function a(c){for(let f of t.skips)if(i(c,f))return!1;for(let f of t.names)if(i(c,f))return!0;return!1}function h(c){return c instanceof Error?c.stack||c.message:c}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}pn.exports=hc});var mn=v((V,Jt)=>{V.formatArgs=uc;V.save=dc;V.load=pc;V.useColors=fc;V.storage=mc();V.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();V.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function fc(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let r;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(r=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(r[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function uc(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+Jt.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,s=0;r[0].replace(/%[a-zA-Z%]/g,n=>{n!=="%%"&&(t++,n==="%c"&&(s=t))}),r.splice(s,0,e)}V.log=console.debug||console.log||(()=>{});function dc(r){try{r?V.storage.setItem("debug",r):V.storage.removeItem("debug")}catch{}}function pc(){let r;try{r=V.storage.getItem("debug")||V.storage.getItem("DEBUG")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}function mc(){try{return localStorage}catch{}}Jt.exports=Yr()(V);var{formatters:gc}=Jt.exports;gc.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var _n=v((mu,gn)=>{"use strict";gn.exports=(r,e=process.argv)=>{let t=r.startsWith("-")?"":r.length===1?"-":"--",s=e.indexOf(t+r),n=e.indexOf("--");return s!==-1&&(n===-1||s<n)}});var Kr=v((gu,Sn)=>{"use strict";var _c=require("os"),yn=require("tty"),J=_n(),{env:A}=process,Kt;J("no-color")||J("no-colors")||J("color=false")||J("color=never")?Kt=0:(J("color")||J("colors")||J("color=true")||J("color=always"))&&(Kt=1);function yc(){if("FORCE_COLOR"in A)return A.FORCE_COLOR==="true"?1:A.FORCE_COLOR==="false"?0:A.FORCE_COLOR.length===0?1:Math.min(Number.parseInt(A.FORCE_COLOR,10),3)}function Sc(r){return r===0?!1:{level:r,hasBasic:!0,has256:r>=2,has16m:r>=3}}function vc(r,{streamIsTTY:e,sniffFlags:t=!0}={}){let s=yc();s!==void 0&&(Kt=s);let n=t?Kt:s;if(n===0)return 0;if(t){if(J("color=16m")||J("color=full")||J("color=truecolor"))return 3;if(J("color=256"))return 2}if(r&&!e&&n===void 0)return 0;let i=n||0;if(A.TERM==="dumb")return i;if(process.platform==="win32"){let o=_c.release().split(".");return Number(o[0])>=10&&Number(o[2])>=10586?Number(o[2])>=14931?3:2:1}if("CI"in A)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE","DRONE"].some(o=>o in A)||A.CI_NAME==="codeship"?1:i;if("TEAMCITY_VERSION"in A)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(A.TEAMCITY_VERSION)?1:0;if(A.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in A){let o=Number.parseInt((A.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(A.TERM_PROGRAM){case"iTerm.app":return o>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(A.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(A.TERM)||"COLORTERM"in A?1:i}function Jr(r,e={}){let t=vc(r,{streamIsTTY:r&&r.isTTY,...e});return Sc(t)}Sn.exports={supportsColor:Jr,stdout:Jr({isTTY:yn.isatty(1)}),stderr:Jr({isTTY:yn.isatty(2)})}});var wn=v((I,Qt)=>{var wc=require("tty"),Xt=require("util");I.init=Oc;I.log=bc;I.formatArgs=xc;I.save=kc;I.load=Tc;I.useColors=Ec;I.destroy=Xt.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");I.colors=[6,2,3,4,5,1];try{let r=Kr();r&&(r.stderr||r).level>=2&&(I.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}I.inspectOpts=Object.keys(process.env).filter(r=>/^debug_/i.test(r)).reduce((r,e)=>{let t=e.substring(6).toLowerCase().replace(/_([a-z])/g,(n,i)=>i.toUpperCase()),s=process.env[e];return/^(yes|on|true|enabled)$/i.test(s)?s=!0:/^(no|off|false|disabled)$/i.test(s)?s=!1:s==="null"?s=null:s=Number(s),r[t]=s,r},{});function Ec(){return"colors"in I.inspectOpts?!!I.inspectOpts.colors:wc.isatty(process.stderr.fd)}function xc(r){let{namespace:e,useColors:t}=this;if(t){let s=this.color,n="\x1B[3"+(s<8?s:"8;5;"+s),i=`  ${n};1m${e} \x1B[0m`;r[0]=i+r[0].split(`
`).join(`
`+i),r.push(n+"m+"+Qt.exports.humanize(this.diff)+"\x1B[0m")}else r[0]=Cc()+e+" "+r[0]}function Cc(){return I.inspectOpts.hideDate?"":new Date().toISOString()+" "}function bc(...r){return process.stderr.write(Xt.formatWithOptions(I.inspectOpts,...r)+`
`)}function kc(r){r?process.env.DEBUG=r:delete process.env.DEBUG}function Tc(){return process.env.DEBUG}function Oc(r){r.inspectOpts={};let e=Object.keys(I.inspectOpts);for(let t=0;t<e.length;t++)r.inspectOpts[e[t]]=I.inspectOpts[e[t]]}Qt.exports=Yr()(I);var{formatters:vn}=Qt.exports;vn.o=function(r){return this.inspectOpts.colors=this.useColors,Xt.inspect(r,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};vn.O=function(r){return this.inspectOpts.colors=this.useColors,Xt.inspect(r,this.inspectOpts)}});var En=v((_u,Xr)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?Xr.exports=mn():Xr.exports=wn()});var he=v((yu,bn)=>{"use strict";var xn=["nodebuffer","arraybuffer","fragments"],Cn=typeof Blob<"u";Cn&&xn.push("blob");bn.exports={BINARY_TYPES:xn,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:Cn,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var mt=v((Su,Zt)=>{"use strict";var{EMPTY_BUFFER:Pc}=he(),Qr=Buffer[Symbol.species];function Nc(r,e){if(r.length===0)return Pc;if(r.length===1)return r[0];let t=Buffer.allocUnsafe(e),s=0;for(let n=0;n<r.length;n++){let i=r[n];t.set(i,s),s+=i.length}return s<e?new Qr(t.buffer,t.byteOffset,s):t}function kn(r,e,t,s,n){for(let i=0;i<n;i++)t[s+i]=r[i]^e[i&3]}function Tn(r,e){for(let t=0;t<r.length;t++)r[t]^=e[t&3]}function Rc(r){return r.length===r.buffer.byteLength?r.buffer:r.buffer.slice(r.byteOffset,r.byteOffset+r.length)}function Zr(r){if(Zr.readOnly=!0,Buffer.isBuffer(r))return r;let e;return r instanceof ArrayBuffer?e=new Qr(r):ArrayBuffer.isView(r)?e=new Qr(r.buffer,r.byteOffset,r.byteLength):(e=Buffer.from(r),Zr.readOnly=!1),e}Zt.exports={concat:Nc,mask:kn,toArrayBuffer:Rc,toBuffer:Zr,unmask:Tn};if(!process.env.WS_NO_BUFFER_UTIL)try{let r=require("bufferutil");Zt.exports.mask=function(e,t,s,n,i){i<48?kn(e,t,s,n,i):r.mask(e,t,s,n,i)},Zt.exports.unmask=function(e,t){e.length<32?Tn(e,t):r.unmask(e,t)}}catch{}});var Nn=v((vu,Pn)=>{"use strict";var On=Symbol("kDone"),es=Symbol("kRun"),ts=class{constructor(e){this[On]=()=>{this.pending--,this[es]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[es]()}[es](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[On])}}};Pn.exports=ts});var _t=v((wu,In)=>{"use strict";var gt=require("zlib"),Rn=mt(),Lc=Nn(),{kStatusCode:Ln}=he(),Ac=Buffer[Symbol.species],Ic=Buffer.from([0,0,255,255]),tr=Symbol("permessage-deflate"),fe=Symbol("total-length"),He=Symbol("callback"),Ee=Symbol("buffers"),ze=Symbol("error"),er,rs=class{constructor(e,t,s){if(this._maxPayload=s|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!er){let n=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;er=new Lc(n)}}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[He];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let t=this._options,s=e.find(n=>!(t.serverNoContextTakeover===!1&&n.server_no_context_takeover||n.server_max_window_bits&&(t.serverMaxWindowBits===!1||typeof t.serverMaxWindowBits=="number"&&t.serverMaxWindowBits>n.server_max_window_bits)||typeof t.clientMaxWindowBits=="number"&&!n.client_max_window_bits));if(!s)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(s.server_no_context_takeover=!0),t.clientNoContextTakeover&&(s.client_no_context_takeover=!0),typeof t.serverMaxWindowBits=="number"&&(s.server_max_window_bits=t.serverMaxWindowBits),typeof t.clientMaxWindowBits=="number"?s.client_max_window_bits=t.clientMaxWindowBits:(s.client_max_window_bits===!0||t.clientMaxWindowBits===!1)&&delete s.client_max_window_bits,s}acceptAsClient(e){let t=e[0];if(this._options.clientNoContextTakeover===!1&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!t.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(t.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return t}normalizeParams(e){return e.forEach(t=>{Object.keys(t).forEach(s=>{let n=t[s];if(n.length>1)throw new Error(`Parameter "${s}" must have only a single value`);if(n=n[0],s==="client_max_window_bits"){if(n!==!0){let i=+n;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError(`Invalid value for parameter "${s}": ${n}`);n=i}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${s}": ${n}`)}else if(s==="server_max_window_bits"){let i=+n;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError(`Invalid value for parameter "${s}": ${n}`);n=i}else if(s==="client_no_context_takeover"||s==="server_no_context_takeover"){if(n!==!0)throw new TypeError(`Invalid value for parameter "${s}": ${n}`)}else throw new Error(`Unknown parameter "${s}"`);t[s]=n})}),e}decompress(e,t,s){er.add(n=>{this._decompress(e,t,(i,o)=>{n(),s(i,o)})})}compress(e,t,s){er.add(n=>{this._compress(e,t,(i,o)=>{n(),s(i,o)})})}_decompress(e,t,s){let n=this._isServer?"client":"server";if(!this._inflate){let i=`${n}_max_window_bits`,o=typeof this.params[i]!="number"?gt.Z_DEFAULT_WINDOWBITS:this.params[i];this._inflate=gt.createInflateRaw({...this._options.zlibInflateOptions,windowBits:o}),this._inflate[tr]=this,this._inflate[fe]=0,this._inflate[Ee]=[],this._inflate.on("error",Fc),this._inflate.on("data",An)}this._inflate[He]=s,this._inflate.write(e),t&&this._inflate.write(Ic),this._inflate.flush(()=>{let i=this._inflate[ze];if(i){this._inflate.close(),this._inflate=null,s(i);return}let o=Rn.concat(this._inflate[Ee],this._inflate[fe]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[fe]=0,this._inflate[Ee]=[],t&&this.params[`${n}_no_context_takeover`]&&this._inflate.reset()),s(null,o)})}_compress(e,t,s){let n=this._isServer?"server":"client";if(!this._deflate){let i=`${n}_max_window_bits`,o=typeof this.params[i]!="number"?gt.Z_DEFAULT_WINDOWBITS:this.params[i];this._deflate=gt.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:o}),this._deflate[fe]=0,this._deflate[Ee]=[],this._deflate.on("data",Bc)}this._deflate[He]=s,this._deflate.write(e),this._deflate.flush(gt.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let i=Rn.concat(this._deflate[Ee],this._deflate[fe]);t&&(i=new Ac(i.buffer,i.byteOffset,i.length-4)),this._deflate[He]=null,this._deflate[fe]=0,this._deflate[Ee]=[],t&&this.params[`${n}_no_context_takeover`]&&this._deflate.reset(),s(null,i)})}};In.exports=rs;function Bc(r){this[Ee].push(r),this[fe]+=r.length}function An(r){if(this[fe]+=r.length,this[tr]._maxPayload<1||this[fe]<=this[tr]._maxPayload){this[Ee].push(r);return}this[ze]=new RangeError("Max payload size exceeded"),this[ze].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[ze][Ln]=1009,this.removeListener("data",An),this.reset()}function Fc(r){if(this[tr]._inflate=null,this[ze]){this[He](this[ze]);return}r[Ln]=1007,this[He](r)}});var Ye=v((Eu,rr)=>{"use strict";var{isUtf8:Bn}=require("buffer"),{hasBlob:Dc}=he(),Uc=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function Mc(r){return r>=1e3&&r<=1014&&r!==1004&&r!==1005&&r!==1006||r>=3e3&&r<=4999}function ss(r){let e=r.length,t=0;for(;t<e;)if((r[t]&128)===0)t++;else if((r[t]&224)===192){if(t+1===e||(r[t+1]&192)!==128||(r[t]&254)===192)return!1;t+=2}else if((r[t]&240)===224){if(t+2>=e||(r[t+1]&192)!==128||(r[t+2]&192)!==128||r[t]===224&&(r[t+1]&224)===128||r[t]===237&&(r[t+1]&224)===160)return!1;t+=3}else if((r[t]&248)===240){if(t+3>=e||(r[t+1]&192)!==128||(r[t+2]&192)!==128||(r[t+3]&192)!==128||r[t]===240&&(r[t+1]&240)===128||r[t]===244&&r[t+1]>143||r[t]>244)return!1;t+=4}else return!1;return!0}function qc(r){return Dc&&typeof r=="object"&&typeof r.arrayBuffer=="function"&&typeof r.type=="string"&&typeof r.stream=="function"&&(r[Symbol.toStringTag]==="Blob"||r[Symbol.toStringTag]==="File")}rr.exports={isBlob:qc,isValidStatusCode:Mc,isValidUTF8:ss,tokenChars:Uc};if(Bn)rr.exports.isValidUTF8=function(r){return r.length<24?ss(r):Bn(r)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let r=require("utf-8-validate");rr.exports.isValidUTF8=function(e){return e.length<32?ss(e):r(e)}}catch{}});var cs=v((xu,jn)=>{"use strict";var{Writable:Wc}=require("stream"),Fn=_t(),{BINARY_TYPES:jc,EMPTY_BUFFER:Dn,kStatusCode:Vc,kWebSocket:$c}=he(),{concat:ns,toArrayBuffer:Gc,unmask:Hc}=mt(),{isValidStatusCode:zc,isValidUTF8:Un}=Ye(),sr=Buffer[Symbol.species],K=0,Mn=1,qn=2,Wn=3,is=4,os=5,nr=6,as=class extends Wc{constructor(e={}){super(),this._allowSynchronousEvents=e.allowSynchronousEvents!==void 0?e.allowSynchronousEvents:!0,this._binaryType=e.binaryType||jc[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=e.maxPayload|0,this._skipUTF8Validation=!!e.skipUTF8Validation,this[$c]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=K}_write(e,t,s){if(this._opcode===8&&this._state==K)return s();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(s)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let s=this._buffers[0];return this._buffers[0]=new sr(s.buffer,s.byteOffset+e,s.length-e),new sr(s.buffer,s.byteOffset,e)}let t=Buffer.allocUnsafe(e);do{let s=this._buffers[0],n=t.length-e;e>=s.length?t.set(this._buffers.shift(),n):(t.set(new Uint8Array(s.buffer,s.byteOffset,e),n),this._buffers[0]=new sr(s.buffer,s.byteOffset+e,s.length-e)),e-=s.length}while(e>0);return t}startLoop(e){this._loop=!0;do switch(this._state){case K:this.getInfo(e);break;case Mn:this.getPayloadLength16(e);break;case qn:this.getPayloadLength64(e);break;case Wn:this.getMask();break;case is:this.getData(e);break;case os:case nr:this._loop=!1;return}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2){this._loop=!1;return}let t=this.consume(2);if((t[0]&48)!==0){let n=this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");e(n);return}let s=(t[0]&64)===64;if(s&&!this._extensions[Fn.extensionName]){let n=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(n);return}if(this._fin=(t[0]&128)===128,this._opcode=t[0]&15,this._payloadLength=t[1]&127,this._opcode===0){if(s){let n=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(n);return}if(!this._fragmented){let n=this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");e(n);return}this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented){let n=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(n);return}this._compressed=s}else if(this._opcode>7&&this._opcode<11){if(!this._fin){let n=this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");e(n);return}if(s){let n=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(n);return}if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1){let n=this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");e(n);return}}else{let n=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(n);return}if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(t[1]&128)===128,this._isServer){if(!this._masked){let n=this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK");e(n);return}}else if(this._masked){let n=this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");e(n);return}this._payloadLength===126?this._state=Mn:this._payloadLength===127?this._state=qn:this.haveLength(e)}getPayloadLength16(e){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e)}getPayloadLength64(e){if(this._bufferedBytes<8){this._loop=!1;return}let t=this.consume(8),s=t.readUInt32BE(0);if(s>Math.pow(2,21)-1){let n=this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH");e(n);return}this._payloadLength=s*Math.pow(2,32)+t.readUInt32BE(4),this.haveLength(e)}haveLength(e){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)){let t=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");e(t);return}this._masked?this._state=Wn:this._state=is}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=is}getData(e){let t=Dn;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}t=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!==0&&Hc(t,this._mask)}if(this._opcode>7){this.controlMessage(t,e);return}if(this._compressed){this._state=os,this.decompress(t,e);return}t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage(e)}decompress(e,t){this._extensions[Fn.extensionName].decompress(e,this._fin,(n,i)=>{if(n)return t(n);if(i.length){if(this._messageLength+=i.length,this._messageLength>this._maxPayload&&this._maxPayload>0){let o=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");t(o);return}this._fragments.push(i)}this.dataMessage(t),this._state===K&&this.startLoop(t)})}dataMessage(e){if(!this._fin){this._state=K;return}let t=this._messageLength,s=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let n;this._binaryType==="nodebuffer"?n=ns(s,t):this._binaryType==="arraybuffer"?n=Gc(ns(s,t)):this._binaryType==="blob"?n=new Blob(s):n=s,this._allowSynchronousEvents?(this.emit("message",n,!0),this._state=K):(this._state=nr,setImmediate(()=>{this.emit("message",n,!0),this._state=K,this.startLoop(e)}))}else{let n=ns(s,t);if(!this._skipUTF8Validation&&!Un(n)){let i=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");e(i);return}this._state===os||this._allowSynchronousEvents?(this.emit("message",n,!1),this._state=K):(this._state=nr,setImmediate(()=>{this.emit("message",n,!1),this._state=K,this.startLoop(e)}))}}controlMessage(e,t){if(this._opcode===8){if(e.length===0)this._loop=!1,this.emit("conclude",1005,Dn),this.end();else{let s=e.readUInt16BE(0);if(!zc(s)){let i=this.createError(RangeError,`invalid status code ${s}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");t(i);return}let n=new sr(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!Un(n)){let i=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");t(i);return}this._loop=!1,this.emit("conclude",s,n),this.end()}this._state=K;return}this._allowSynchronousEvents?(this.emit(this._opcode===9?"ping":"pong",e),this._state=K):(this._state=nr,setImmediate(()=>{this.emit(this._opcode===9?"ping":"pong",e),this._state=K,this.startLoop(t)}))}createError(e,t,s,n,i){this._loop=!1,this._errored=!0;let o=new e(s?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(o,this.createError),o.code=i,o[Vc]=n,o}};jn.exports=as});var fs=v((bu,Gn)=>{"use strict";var{Duplex:Cu}=require("stream"),{randomFillSync:Yc}=require("crypto"),Vn=_t(),{EMPTY_BUFFER:Jc,kWebSocket:Kc,NOOP:Xc}=he(),{isBlob:Je,isValidStatusCode:Qc}=Ye(),{mask:$n,toBuffer:Ne}=mt(),X=Symbol("kByteLength"),Zc=Buffer.alloc(4),ir=8*1024,Re,Ke=ir,ee=0,el=1,tl=2,ls=class r{constructor(e,t,s){this._extensions=t||{},s&&(this._generateMask=s,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=ee,this.onerror=Xc,this[Kc]=void 0}static frame(e,t){let s,n=!1,i=2,o=!1;t.mask&&(s=t.maskBuffer||Zc,t.generateMask?t.generateMask(s):(Ke===ir&&(Re===void 0&&(Re=Buffer.alloc(ir)),Yc(Re,0,ir),Ke=0),s[0]=Re[Ke++],s[1]=Re[Ke++],s[2]=Re[Ke++],s[3]=Re[Ke++]),o=(s[0]|s[1]|s[2]|s[3])===0,i=6);let a;typeof e=="string"?(!t.mask||o)&&t[X]!==void 0?a=t[X]:(e=Buffer.from(e),a=e.length):(a=e.length,n=t.mask&&t.readOnly&&!o);let h=a;a>=65536?(i+=8,h=127):a>125&&(i+=2,h=126);let l=Buffer.allocUnsafe(n?a+i:i);return l[0]=t.fin?t.opcode|128:t.opcode,t.rsv1&&(l[0]|=64),l[1]=h,h===126?l.writeUInt16BE(a,2):h===127&&(l[2]=l[3]=0,l.writeUIntBE(a,4,6)),t.mask?(l[1]|=128,l[i-4]=s[0],l[i-3]=s[1],l[i-2]=s[2],l[i-1]=s[3],o?[l,e]:n?($n(e,s,l,i,a),[l]):($n(e,s,e,0,a),[l,e])):[l,e]}close(e,t,s,n){let i;if(e===void 0)i=Jc;else{if(typeof e!="number"||!Qc(e))throw new TypeError("First argument must be a valid error code number");if(t===void 0||!t.length)i=Buffer.allocUnsafe(2),i.writeUInt16BE(e,0);else{let a=Buffer.byteLength(t);if(a>123)throw new RangeError("The message must not be greater than 123 bytes");i=Buffer.allocUnsafe(2+a),i.writeUInt16BE(e,0),typeof t=="string"?i.write(t,2):i.set(t,2)}}let o={[X]:i.length,fin:!0,generateMask:this._generateMask,mask:s,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._state!==ee?this.enqueue([this.dispatch,i,!1,o,n]):this.sendFrame(r.frame(i,o),n)}ping(e,t,s){let n,i;if(typeof e=="string"?(n=Buffer.byteLength(e),i=!1):Je(e)?(n=e.size,i=!1):(e=Ne(e),n=e.length,i=Ne.readOnly),n>125)throw new RangeError("The data size must not be greater than 125 bytes");let o={[X]:n,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:9,readOnly:i,rsv1:!1};Je(e)?this._state!==ee?this.enqueue([this.getBlobData,e,!1,o,s]):this.getBlobData(e,!1,o,s):this._state!==ee?this.enqueue([this.dispatch,e,!1,o,s]):this.sendFrame(r.frame(e,o),s)}pong(e,t,s){let n,i;if(typeof e=="string"?(n=Buffer.byteLength(e),i=!1):Je(e)?(n=e.size,i=!1):(e=Ne(e),n=e.length,i=Ne.readOnly),n>125)throw new RangeError("The data size must not be greater than 125 bytes");let o={[X]:n,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:10,readOnly:i,rsv1:!1};Je(e)?this._state!==ee?this.enqueue([this.getBlobData,e,!1,o,s]):this.getBlobData(e,!1,o,s):this._state!==ee?this.enqueue([this.dispatch,e,!1,o,s]):this.sendFrame(r.frame(e,o),s)}send(e,t,s){let n=this._extensions[Vn.extensionName],i=t.binary?2:1,o=t.compress,a,h;typeof e=="string"?(a=Buffer.byteLength(e),h=!1):Je(e)?(a=e.size,h=!1):(e=Ne(e),a=e.length,h=Ne.readOnly),this._firstFragment?(this._firstFragment=!1,o&&n&&n.params[n._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(o=a>=n._threshold),this._compress=o):(o=!1,i=0),t.fin&&(this._firstFragment=!0);let l={[X]:a,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:i,readOnly:h,rsv1:o};Je(e)?this._state!==ee?this.enqueue([this.getBlobData,e,this._compress,l,s]):this.getBlobData(e,this._compress,l,s):this._state!==ee?this.enqueue([this.dispatch,e,this._compress,l,s]):this.dispatch(e,this._compress,l,s)}getBlobData(e,t,s,n){this._bufferedBytes+=s[X],this._state=tl,e.arrayBuffer().then(i=>{if(this._socket.destroyed){let a=new Error("The socket was closed while the blob was being read");process.nextTick(hs,this,a,n);return}this._bufferedBytes-=s[X];let o=Ne(i);t?this.dispatch(o,t,s,n):(this._state=ee,this.sendFrame(r.frame(o,s),n),this.dequeue())}).catch(i=>{process.nextTick(rl,this,i,n)})}dispatch(e,t,s,n){if(!t){this.sendFrame(r.frame(e,s),n);return}let i=this._extensions[Vn.extensionName];this._bufferedBytes+=s[X],this._state=el,i.compress(e,s.fin,(o,a)=>{if(this._socket.destroyed){let h=new Error("The socket was closed while data was being compressed");hs(this,h,n);return}this._bufferedBytes-=s[X],this._state=ee,s.readOnly=!1,this.sendFrame(r.frame(a,s),n),this.dequeue()})}dequeue(){for(;this._state===ee&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[3][X],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][X],this._queue.push(e)}sendFrame(e,t){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}};Gn.exports=ls;function hs(r,e,t){typeof t=="function"&&t(e);for(let s=0;s<r._queue.length;s++){let n=r._queue[s],i=n[n.length-1];typeof i=="function"&&i(e)}}function rl(r,e,t){hs(r,e,t),r.onerror(e)}});var ei=v((ku,Zn)=>{"use strict";var{kForOnEventAttribute:yt,kListener:us}=he(),Hn=Symbol("kCode"),zn=Symbol("kData"),Yn=Symbol("kError"),Jn=Symbol("kMessage"),Kn=Symbol("kReason"),Xe=Symbol("kTarget"),Xn=Symbol("kType"),Qn=Symbol("kWasClean"),ue=class{constructor(e){this[Xe]=null,this[Xn]=e}get target(){return this[Xe]}get type(){return this[Xn]}};Object.defineProperty(ue.prototype,"target",{enumerable:!0});Object.defineProperty(ue.prototype,"type",{enumerable:!0});var Le=class extends ue{constructor(e,t={}){super(e),this[Hn]=t.code===void 0?0:t.code,this[Kn]=t.reason===void 0?"":t.reason,this[Qn]=t.wasClean===void 0?!1:t.wasClean}get code(){return this[Hn]}get reason(){return this[Kn]}get wasClean(){return this[Qn]}};Object.defineProperty(Le.prototype,"code",{enumerable:!0});Object.defineProperty(Le.prototype,"reason",{enumerable:!0});Object.defineProperty(Le.prototype,"wasClean",{enumerable:!0});var Qe=class extends ue{constructor(e,t={}){super(e),this[Yn]=t.error===void 0?null:t.error,this[Jn]=t.message===void 0?"":t.message}get error(){return this[Yn]}get message(){return this[Jn]}};Object.defineProperty(Qe.prototype,"error",{enumerable:!0});Object.defineProperty(Qe.prototype,"message",{enumerable:!0});var St=class extends ue{constructor(e,t={}){super(e),this[zn]=t.data===void 0?null:t.data}get data(){return this[zn]}};Object.defineProperty(St.prototype,"data",{enumerable:!0});var sl={addEventListener(r,e,t={}){for(let n of this.listeners(r))if(!t[yt]&&n[us]===e&&!n[yt])return;let s;if(r==="message")s=function(i,o){let a=new St("message",{data:o?i:i.toString()});a[Xe]=this,or(e,this,a)};else if(r==="close")s=function(i,o){let a=new Le("close",{code:i,reason:o.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});a[Xe]=this,or(e,this,a)};else if(r==="error")s=function(i){let o=new Qe("error",{error:i,message:i.message});o[Xe]=this,or(e,this,o)};else if(r==="open")s=function(){let i=new ue("open");i[Xe]=this,or(e,this,i)};else return;s[yt]=!!t[yt],s[us]=e,t.once?this.once(r,s):this.on(r,s)},removeEventListener(r,e){for(let t of this.listeners(r))if(t[us]===e&&!t[yt]){this.removeListener(r,t);break}}};Zn.exports={CloseEvent:Le,ErrorEvent:Qe,Event:ue,EventTarget:sl,MessageEvent:St};function or(r,e,t){typeof r=="object"&&r.handleEvent?r.handleEvent.call(r,t):r.call(e,t)}});var ds=v((Tu,ti)=>{"use strict";var{tokenChars:vt}=Ye();function oe(r,e,t){r[e]===void 0?r[e]=[t]:r[e].push(t)}function nl(r){let e=Object.create(null),t=Object.create(null),s=!1,n=!1,i=!1,o,a,h=-1,l=-1,c=-1,f=0;for(;f<r.length;f++)if(l=r.charCodeAt(f),o===void 0)if(c===-1&&vt[l]===1)h===-1&&(h=f);else if(f!==0&&(l===32||l===9))c===-1&&h!==-1&&(c=f);else if(l===59||l===44){if(h===-1)throw new SyntaxError(`Unexpected character at index ${f}`);c===-1&&(c=f);let p=r.slice(h,c);l===44?(oe(e,p,t),t=Object.create(null)):o=p,h=c=-1}else throw new SyntaxError(`Unexpected character at index ${f}`);else if(a===void 0)if(c===-1&&vt[l]===1)h===-1&&(h=f);else if(l===32||l===9)c===-1&&h!==-1&&(c=f);else if(l===59||l===44){if(h===-1)throw new SyntaxError(`Unexpected character at index ${f}`);c===-1&&(c=f),oe(t,r.slice(h,c),!0),l===44&&(oe(e,o,t),t=Object.create(null),o=void 0),h=c=-1}else if(l===61&&h!==-1&&c===-1)a=r.slice(h,f),h=c=-1;else throw new SyntaxError(`Unexpected character at index ${f}`);else if(n){if(vt[l]!==1)throw new SyntaxError(`Unexpected character at index ${f}`);h===-1?h=f:s||(s=!0),n=!1}else if(i)if(vt[l]===1)h===-1&&(h=f);else if(l===34&&h!==-1)i=!1,c=f;else if(l===92)n=!0;else throw new SyntaxError(`Unexpected character at index ${f}`);else if(l===34&&r.charCodeAt(f-1)===61)i=!0;else if(c===-1&&vt[l]===1)h===-1&&(h=f);else if(h!==-1&&(l===32||l===9))c===-1&&(c=f);else if(l===59||l===44){if(h===-1)throw new SyntaxError(`Unexpected character at index ${f}`);c===-1&&(c=f);let p=r.slice(h,c);s&&(p=p.replace(/\\/g,""),s=!1),oe(t,a,p),l===44&&(oe(e,o,t),t=Object.create(null),o=void 0),a=void 0,h=c=-1}else throw new SyntaxError(`Unexpected character at index ${f}`);if(h===-1||i||l===32||l===9)throw new SyntaxError("Unexpected end of input");c===-1&&(c=f);let u=r.slice(h,c);return o===void 0?oe(e,u,t):(a===void 0?oe(t,u,!0):s?oe(t,a,u.replace(/\\/g,"")):oe(t,a,u),oe(e,o,t)),e}function il(r){return Object.keys(r).map(e=>{let t=r[e];return Array.isArray(t)||(t=[t]),t.map(s=>[e].concat(Object.keys(s).map(n=>{let i=s[n];return Array.isArray(i)||(i=[i]),i.map(o=>o===!0?n:`${n}=${o}`).join("; ")})).join("; ")).join(", ")}).join(", ")}ti.exports={format:il,parse:nl}});var hr=v((Nu,di)=>{"use strict";var ol=require("events"),al=require("https"),cl=require("http"),ni=require("net"),ll=require("tls"),{randomBytes:hl,createHash:fl}=require("crypto"),{Duplex:Ou,Readable:Pu}=require("stream"),{URL:ps}=require("url"),xe=_t(),ul=cs(),dl=fs(),{isBlob:pl}=Ye(),{BINARY_TYPES:ri,EMPTY_BUFFER:ar,GUID:ml,kForOnEventAttribute:ms,kListener:gl,kStatusCode:_l,kWebSocket:B,NOOP:ii}=he(),{EventTarget:{addEventListener:yl,removeEventListener:Sl}}=ei(),{format:vl,parse:wl}=ds(),{toBuffer:El}=mt(),xl=30*1e3,oi=Symbol("kAborted"),gs=[8,13],de=["CONNECTING","OPEN","CLOSING","CLOSED"],Cl=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/,O=class r extends ol{constructor(e,t,s){super(),this._binaryType=ri[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=ar,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=r.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,t===void 0?t=[]:Array.isArray(t)||(typeof t=="object"&&t!==null?(s=t,t=[]):t=[t]),ai(this,e,t,s)):(this._autoPong=s.autoPong,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){ri.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,s){let n=new ul({allowSynchronousEvents:s.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:s.maxPayload,skipUTF8Validation:s.skipUTF8Validation}),i=new dl(e,this._extensions,s.generateMask);this._receiver=n,this._sender=i,this._socket=e,n[B]=this,i[B]=this,e[B]=this,n.on("conclude",Tl),n.on("drain",Ol),n.on("error",Pl),n.on("message",Nl),n.on("ping",Rl),n.on("pong",Ll),i.onerror=Al,e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",hi),e.on("data",lr),e.on("end",fi),e.on("error",ui),this._readyState=r.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=r.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[xe.extensionName]&&this._extensions[xe.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=r.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==r.CLOSED){if(this.readyState===r.CONNECTING){G(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===r.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=r.CLOSING,this._sender.close(e,t,!this._isServer,s=>{s||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),li(this)}}pause(){this.readyState===r.CONNECTING||this.readyState===r.CLOSED||(this._paused=!0,this._socket.pause())}ping(e,t,s){if(this.readyState===r.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(s=e,e=t=void 0):typeof t=="function"&&(s=t,t=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==r.OPEN){_s(this,e,s);return}t===void 0&&(t=!this._isServer),this._sender.ping(e||ar,t,s)}pong(e,t,s){if(this.readyState===r.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(s=e,e=t=void 0):typeof t=="function"&&(s=t,t=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==r.OPEN){_s(this,e,s);return}t===void 0&&(t=!this._isServer),this._sender.pong(e||ar,t,s)}resume(){this.readyState===r.CONNECTING||this.readyState===r.CLOSED||(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,s){if(this.readyState===r.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof t=="function"&&(s=t,t={}),typeof e=="number"&&(e=e.toString()),this.readyState!==r.OPEN){_s(this,e,s);return}let n={binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[xe.extensionName]||(n.compress=!1),this._sender.send(e||ar,n,s)}terminate(){if(this.readyState!==r.CLOSED){if(this.readyState===r.CONNECTING){G(this,this._req,"WebSocket was closed before the connection was established");return}this._socket&&(this._readyState=r.CLOSING,this._socket.destroy())}}};Object.defineProperty(O,"CONNECTING",{enumerable:!0,value:de.indexOf("CONNECTING")});Object.defineProperty(O.prototype,"CONNECTING",{enumerable:!0,value:de.indexOf("CONNECTING")});Object.defineProperty(O,"OPEN",{enumerable:!0,value:de.indexOf("OPEN")});Object.defineProperty(O.prototype,"OPEN",{enumerable:!0,value:de.indexOf("OPEN")});Object.defineProperty(O,"CLOSING",{enumerable:!0,value:de.indexOf("CLOSING")});Object.defineProperty(O.prototype,"CLOSING",{enumerable:!0,value:de.indexOf("CLOSING")});Object.defineProperty(O,"CLOSED",{enumerable:!0,value:de.indexOf("CLOSED")});Object.defineProperty(O.prototype,"CLOSED",{enumerable:!0,value:de.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(r=>{Object.defineProperty(O.prototype,r,{enumerable:!0})});["open","error","close","message"].forEach(r=>{Object.defineProperty(O.prototype,`on${r}`,{enumerable:!0,get(){for(let e of this.listeners(r))if(e[ms])return e[gl];return null},set(e){for(let t of this.listeners(r))if(t[ms]){this.removeListener(r,t);break}typeof e=="function"&&this.addEventListener(r,e,{[ms]:!0})}})});O.prototype.addEventListener=yl;O.prototype.removeEventListener=Sl;di.exports=O;function ai(r,e,t,s){let n={allowSynchronousEvents:!0,autoPong:!0,protocolVersion:gs[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...s,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(r._autoPong=n.autoPong,!gs.includes(n.protocolVersion))throw new RangeError(`Unsupported protocol version: ${n.protocolVersion} (supported versions: ${gs.join(", ")})`);let i;if(e instanceof ps)i=e;else try{i=new ps(e)}catch{throw new SyntaxError(`Invalid URL: ${e}`)}i.protocol==="http:"?i.protocol="ws:":i.protocol==="https:"&&(i.protocol="wss:"),r._url=i.href;let o=i.protocol==="wss:",a=i.protocol==="ws+unix:",h;if(i.protocol!=="ws:"&&!o&&!a?h=`The URL's protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"`:a&&!i.pathname?h="The URL's pathname is empty":i.hash&&(h="The URL contains a fragment identifier"),h){let d=new SyntaxError(h);if(r._redirects===0)throw d;cr(r,d);return}let l=o?443:80,c=hl(16).toString("base64"),f=o?al.request:cl.request,u=new Set,p;if(n.createConnection=n.createConnection||(o?kl:bl),n.defaultPort=n.defaultPort||l,n.port=i.port||l,n.host=i.hostname.startsWith("[")?i.hostname.slice(1,-1):i.hostname,n.headers={...n.headers,"Sec-WebSocket-Version":n.protocolVersion,"Sec-WebSocket-Key":c,Connection:"Upgrade",Upgrade:"websocket"},n.path=i.pathname+i.search,n.timeout=n.handshakeTimeout,n.perMessageDeflate&&(p=new xe(n.perMessageDeflate!==!0?n.perMessageDeflate:{},!1,n.maxPayload),n.headers["Sec-WebSocket-Extensions"]=vl({[xe.extensionName]:p.offer()})),t.length){for(let d of t){if(typeof d!="string"||!Cl.test(d)||u.has(d))throw new SyntaxError("An invalid or duplicated subprotocol was specified");u.add(d)}n.headers["Sec-WebSocket-Protocol"]=t.join(",")}if(n.origin&&(n.protocolVersion<13?n.headers["Sec-WebSocket-Origin"]=n.origin:n.headers.Origin=n.origin),(i.username||i.password)&&(n.auth=`${i.username}:${i.password}`),a){let d=n.path.split(":");n.socketPath=d[0],n.path=d[1]}let _;if(n.followRedirects){if(r._redirects===0){r._originalIpc=a,r._originalSecure=o,r._originalHostOrSocketPath=a?n.socketPath:i.host;let d=s&&s.headers;if(s={...s,headers:{}},d)for(let[g,x]of Object.entries(d))s.headers[g.toLowerCase()]=x}else if(r.listenerCount("redirect")===0){let d=a?r._originalIpc?n.socketPath===r._originalHostOrSocketPath:!1:r._originalIpc?!1:i.host===r._originalHostOrSocketPath;(!d||r._originalSecure&&!o)&&(delete n.headers.authorization,delete n.headers.cookie,d||delete n.headers.host,n.auth=void 0)}n.auth&&!s.headers.authorization&&(s.headers.authorization="Basic "+Buffer.from(n.auth).toString("base64")),_=r._req=f(n),r._redirects&&r.emit("redirect",r.url,_)}else _=r._req=f(n);n.timeout&&_.on("timeout",()=>{G(r,_,"Opening handshake has timed out")}),_.on("error",d=>{_===null||_[oi]||(_=r._req=null,cr(r,d))}),_.on("response",d=>{let g=d.headers.location,x=d.statusCode;if(g&&n.followRedirects&&x>=300&&x<400){if(++r._redirects>n.maxRedirects){G(r,_,"Maximum redirects exceeded");return}_.abort();let C;try{C=new ps(g,e)}catch{let y=new SyntaxError(`Invalid URL: ${g}`);cr(r,y);return}ai(r,C,t,s)}else r.emit("unexpected-response",_,d)||G(r,_,`Unexpected server response: ${d.statusCode}`)}),_.on("upgrade",(d,g,x)=>{if(r.emit("upgrade",d),r.readyState!==O.CONNECTING)return;_=r._req=null;let C=d.headers.upgrade;if(C===void 0||C.toLowerCase()!=="websocket"){G(r,g,"Invalid Upgrade header");return}let m=fl("sha1").update(c+ml).digest("base64");if(d.headers["sec-websocket-accept"]!==m){G(r,g,"Invalid Sec-WebSocket-Accept header");return}let y=d.headers["sec-websocket-protocol"],P;if(y!==void 0?u.size?u.has(y)||(P="Server sent an invalid subprotocol"):P="Server sent a subprotocol but none was requested":u.size&&(P="Server sent no subprotocol"),P){G(r,g,P);return}y&&(r._protocol=y);let k=d.headers["sec-websocket-extensions"];if(k!==void 0){if(!p){G(r,g,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let R;try{R=wl(k)}catch{G(r,g,"Invalid Sec-WebSocket-Extensions header");return}let M=Object.keys(R);if(M.length!==1||M[0]!==xe.extensionName){G(r,g,"Server indicated an extension that was not requested");return}try{p.accept(R[xe.extensionName])}catch{G(r,g,"Invalid Sec-WebSocket-Extensions header");return}r._extensions[xe.extensionName]=p}r.setSocket(g,x,{allowSynchronousEvents:n.allowSynchronousEvents,generateMask:n.generateMask,maxPayload:n.maxPayload,skipUTF8Validation:n.skipUTF8Validation})}),n.finishRequest?n.finishRequest(_,r):_.end()}function cr(r,e){r._readyState=O.CLOSING,r._errorEmitted=!0,r.emit("error",e),r.emitClose()}function bl(r){return r.path=r.socketPath,ni.connect(r)}function kl(r){return r.path=void 0,!r.servername&&r.servername!==""&&(r.servername=ni.isIP(r.host)?"":r.host),ll.connect(r)}function G(r,e,t){r._readyState=O.CLOSING;let s=new Error(t);Error.captureStackTrace(s,G),e.setHeader?(e[oi]=!0,e.abort(),e.socket&&!e.socket.destroyed&&e.socket.destroy(),process.nextTick(cr,r,s)):(e.destroy(s),e.once("error",r.emit.bind(r,"error")),e.once("close",r.emitClose.bind(r)))}function _s(r,e,t){if(e){let s=pl(e)?e.size:El(e).length;r._socket?r._sender._bufferedBytes+=s:r._bufferedAmount+=s}if(t){let s=new Error(`WebSocket is not open: readyState ${r.readyState} (${de[r.readyState]})`);process.nextTick(t,s)}}function Tl(r,e){let t=this[B];t._closeFrameReceived=!0,t._closeMessage=e,t._closeCode=r,t._socket[B]!==void 0&&(t._socket.removeListener("data",lr),process.nextTick(ci,t._socket),r===1005?t.close():t.close(r,e))}function Ol(){let r=this[B];r.isPaused||r._socket.resume()}function Pl(r){let e=this[B];e._socket[B]!==void 0&&(e._socket.removeListener("data",lr),process.nextTick(ci,e._socket),e.close(r[_l])),e._errorEmitted||(e._errorEmitted=!0,e.emit("error",r))}function si(){this[B].emitClose()}function Nl(r,e){this[B].emit("message",r,e)}function Rl(r){let e=this[B];e._autoPong&&e.pong(r,!this._isServer,ii),e.emit("ping",r)}function Ll(r){this[B].emit("pong",r)}function ci(r){r.resume()}function Al(r){let e=this[B];e.readyState!==O.CLOSED&&(e.readyState===O.OPEN&&(e._readyState=O.CLOSING,li(e)),this._socket.end(),e._errorEmitted||(e._errorEmitted=!0,e.emit("error",r)))}function li(r){r._closeTimer=setTimeout(r._socket.destroy.bind(r._socket),xl)}function hi(){let r=this[B];this.removeListener("close",hi),this.removeListener("data",lr),this.removeListener("end",fi),r._readyState=O.CLOSING;let e;!this._readableState.endEmitted&&!r._closeFrameReceived&&!r._receiver._writableState.errorEmitted&&(e=r._socket.read())!==null&&r._receiver.write(e),r._receiver.end(),this[B]=void 0,clearTimeout(r._closeTimer),r._receiver._writableState.finished||r._receiver._writableState.errorEmitted?r.emitClose():(r._receiver.on("error",si),r._receiver.on("finish",si))}function lr(r){this[B]._receiver.write(r)||this.pause()}function fi(){let r=this[B];r._readyState=O.CLOSING,r._receiver.end(),this.end()}function ui(){let r=this[B];this.removeListener("error",ui),this.on("error",ii),r&&(r._readyState=O.CLOSING,this.destroy())}});var _i=v((Lu,gi)=>{"use strict";var Ru=hr(),{Duplex:Il}=require("stream");function pi(r){r.emit("close")}function Bl(){!this.destroyed&&this._writableState.finished&&this.destroy()}function mi(r){this.removeListener("error",mi),this.destroy(),this.listenerCount("error")===0&&this.emit("error",r)}function Fl(r,e){let t=!0,s=new Il({...e,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return r.on("message",function(i,o){let a=!o&&s._readableState.objectMode?i.toString():i;s.push(a)||r.pause()}),r.once("error",function(i){s.destroyed||(t=!1,s.destroy(i))}),r.once("close",function(){s.destroyed||s.push(null)}),s._destroy=function(n,i){if(r.readyState===r.CLOSED){i(n),process.nextTick(pi,s);return}let o=!1;r.once("error",function(h){o=!0,i(h)}),r.once("close",function(){o||i(n),process.nextTick(pi,s)}),t&&r.terminate()},s._final=function(n){if(r.readyState===r.CONNECTING){r.once("open",function(){s._final(n)});return}r._socket!==null&&(r._socket._writableState.finished?(n(),s._readableState.endEmitted&&s.destroy()):(r._socket.once("finish",function(){n()}),r.close()))},s._read=function(){r.isPaused&&r.resume()},s._write=function(n,i,o){if(r.readyState===r.CONNECTING){r.once("open",function(){s._write(n,i,o)});return}r.send(n,o)},s.on("end",Bl),s.on("error",mi),s}gi.exports=Fl});var Si=v((Au,yi)=>{"use strict";var{tokenChars:Dl}=Ye();function Ul(r){let e=new Set,t=-1,s=-1,n=0;for(n;n<r.length;n++){let o=r.charCodeAt(n);if(s===-1&&Dl[o]===1)t===-1&&(t=n);else if(n!==0&&(o===32||o===9))s===-1&&t!==-1&&(s=n);else if(o===44){if(t===-1)throw new SyntaxError(`Unexpected character at index ${n}`);s===-1&&(s=n);let a=r.slice(t,s);if(e.has(a))throw new SyntaxError(`The "${a}" subprotocol is duplicated`);e.add(a),t=s=-1}else throw new SyntaxError(`Unexpected character at index ${n}`)}if(t===-1||s!==-1)throw new SyntaxError("Unexpected end of input");let i=r.slice(t,n);if(e.has(i))throw new SyntaxError(`The "${i}" subprotocol is duplicated`);return e.add(i),e}yi.exports={parse:Ul}});var ki=v((Bu,bi)=>{"use strict";var Ml=require("events"),fr=require("http"),{Duplex:Iu}=require("stream"),{createHash:ql}=require("crypto"),vi=ds(),Ae=_t(),Wl=Si(),jl=hr(),{GUID:Vl,kWebSocket:$l}=he(),Gl=/^[+/0-9A-Za-z]{22}==$/,wi=0,Ei=1,Ci=2,ys=class extends Ml{constructor(e,t){if(super(),e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:jl,...e},e.port==null&&!e.server&&!e.noServer||e.port!=null&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(e.port!=null?(this._server=fr.createServer((s,n)=>{let i=fr.STATUS_CODES[426];n.writeHead(426,{"Content-Length":i.length,"Content-Type":"text/plain"}),n.end(i)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server){let s=this.emit.bind(this,"connection");this._removeListeners=Hl(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(n,i,o)=>{this.handleUpgrade(n,i,o,s)}})}e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=wi}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(this._state===Ci){e&&this.once("close",()=>{e(new Error("The server is not running"))}),process.nextTick(wt,this);return}if(e&&this.once("close",e),this._state!==Ei)if(this._state=Ei,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(wt,this):process.nextTick(wt,this);else{let t=this._server;this._removeListeners(),this._removeListeners=this._server=null,t.close(()=>{wt(this)})}}shouldHandle(e){if(this.options.path){let t=e.url.indexOf("?");if((t!==-1?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,s,n){t.on("error",xi);let i=e.headers["sec-websocket-key"],o=e.headers.upgrade,a=+e.headers["sec-websocket-version"];if(e.method!=="GET"){Ie(this,e,t,405,"Invalid HTTP method");return}if(o===void 0||o.toLowerCase()!=="websocket"){Ie(this,e,t,400,"Invalid Upgrade header");return}if(i===void 0||!Gl.test(i)){Ie(this,e,t,400,"Missing or invalid Sec-WebSocket-Key header");return}if(a!==8&&a!==13){Ie(this,e,t,400,"Missing or invalid Sec-WebSocket-Version header");return}if(!this.shouldHandle(e)){Et(t,400);return}let h=e.headers["sec-websocket-protocol"],l=new Set;if(h!==void 0)try{l=Wl.parse(h)}catch{Ie(this,e,t,400,"Invalid Sec-WebSocket-Protocol header");return}let c=e.headers["sec-websocket-extensions"],f={};if(this.options.perMessageDeflate&&c!==void 0){let u=new Ae(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let p=vi.parse(c);p[Ae.extensionName]&&(u.accept(p[Ae.extensionName]),f[Ae.extensionName]=u)}catch{Ie(this,e,t,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let u={origin:e.headers[`${a===8?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(u,(p,_,d,g)=>{if(!p)return Et(t,_||401,d,g);this.completeUpgrade(f,i,l,e,t,s,n)});return}if(!this.options.verifyClient(u))return Et(t,401)}this.completeUpgrade(f,i,l,e,t,s,n)}completeUpgrade(e,t,s,n,i,o,a){if(!i.readable||!i.writable)return i.destroy();if(i[$l])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>wi)return Et(i,503);let l=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${ql("sha1").update(t+Vl).digest("base64")}`],c=new this.options.WebSocket(null,void 0,this.options);if(s.size){let f=this.options.handleProtocols?this.options.handleProtocols(s,n):s.values().next().value;f&&(l.push(`Sec-WebSocket-Protocol: ${f}`),c._protocol=f)}if(e[Ae.extensionName]){let f=e[Ae.extensionName].params,u=vi.format({[Ae.extensionName]:[f]});l.push(`Sec-WebSocket-Extensions: ${u}`),c._extensions=e}this.emit("headers",l,n),i.write(l.concat(`\r
`).join(`\r
`)),i.removeListener("error",xi),c.setSocket(i,o,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(c),c.on("close",()=>{this.clients.delete(c),this._shouldEmitClose&&!this.clients.size&&process.nextTick(wt,this)})),a(c,n)}};bi.exports=ys;function Hl(r,e){for(let t of Object.keys(e))r.on(t,e[t]);return function(){for(let s of Object.keys(e))r.removeListener(s,e[s])}}function wt(r){r._state=Ci,r.emit("close")}function xi(){this.destroy()}function Et(r,e,t,s){t=t||fr.STATUS_CODES[e],s={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(t),...s},r.once("finish",r.destroy),r.end(`HTTP/1.1 ${e} ${fr.STATUS_CODES[e]}\r
`+Object.keys(s).map(n=>`${n}: ${s[n]}`).join(`\r
`)+`\r
\r
`+t)}function Ie(r,e,t,s,n){if(r.listenerCount("wsClientError")){let i=new Error(n);Error.captureStackTrace(i,Ie),r.emit("wsClientError",i,t,e)}else Et(t,s,n)}});var Ss,Ni=pt(()=>{"use strict";Ss="phion-dev-tools"});function Ri(){return xt||(xt=T.languages.createDiagnosticCollection(Ss)),xt}function Kl(){if(!xt)throw new Error("Diagnostic collection not initialized. Call initializeDiagnosticCollection first.");return xt}async function Li(r){let e=T.window.activeTextEditor,t;if(e){t=e.document;try{e=await T.window.showTextDocument(t,{viewColumn:T.ViewColumn.Active,preserveFocus:!1,preview:!1})}catch(n){console.warn("Failed to refocus editor, continuing with existing editor:",n)}}else try{let n=["**/App.tsx","**/main.tsx","**/app/page.tsx","**/src/App.tsx","**/src/main.tsx","**/index.tsx","**/src/index.tsx","**/App.jsx","**/main.jsx","**/src/App.jsx","**/src/main.jsx","**/index.jsx","**/src/index.jsx","**/index.ts","**/src/index.ts","**/index.js","**/src/index.js"],i=null;for(let o of n){let a=await T.workspace.findFiles(o,"**/node_modules/**");if(a.length>0){i=a[0];break}}if(!i){let o=await T.workspace.findFiles("**/*","**/node_modules/**");if(o.length===0){T.window.showErrorMessage("No files found in workspace to open.");return}i=o[0]}t=await T.workspace.openTextDocument(i),e=await T.window.showTextDocument(t,{viewColumn:T.ViewColumn.Active,preserveFocus:!1,preview:!1})}catch{T.window.showErrorMessage("Failed to open existing file for prompt injection.");return}let s=Kl();try{let n=e.selection.isEmpty?t.lineAt(e.selection.active.line).range:e.selection,i=new T.Diagnostic(n,r.prompt,T.DiagnosticSeverity.Error);i.source=Ss,s.set(t.uri,[i]),e.selection=new T.Selection(n.start,n.start),e.revealRange(n,T.TextEditorRevealType.InCenter),await new Promise(o=>setTimeout(o,100)),await r.callback(),T.window.showInformationMessage("Triggered agent for prompt.")}catch(n){T.window.showErrorMessage(`Failed to inject prompt: ${n}`)}finally{t&&s.delete(t.uri)}}var T,xt,vs=pt(()=>{"use strict";T=w(require("vscode"));Ni();xt=null});async function Ii(r){let e=`${r.prompt}${r.files?`

 use the following files: ${r.files.join(`
`)}`:""}${r.images?`

 use the following images: ${r.images.join(`
`)}`:""}`,t=`${Xl}
${e}`;await Li({prompt:t,callback:()=>Ai.commands.executeCommand("composer.fixerrormessage")})}var Ai,Xl,Bi=pt(()=>{"use strict";Ai=w(require("vscode"));vs();Xl="```\n    Ah, sorry, it wasn't an error. The user has submitted a change request. Here is the request, please implement it:\n    ```"});function Di(){return Fi.env.appName.toLowerCase().includes("cursor")?"CURSOR":"UNKNOWN"}var Fi,Ui=pt(()=>{"use strict";Fi=w(require("vscode"))});var Wi={};Hr(Wi,{dispatchAgentCall:()=>qi});async function qi(r){switch(Di()){case"CURSOR":return await Ii(r);case"UNKNOWN":Mi.window.showErrorMessage("Failed to call agent: IDE is not supported")}}var Mi,ws=pt(()=>{"use strict";Mi=w(require("vscode"));Bi();Ui()});var $i=v((Xu,Vi)=>{var Ze=require("fs"),ji=require("url"),Ql=require("child_process").spawn;Vi.exports=Es;Es.XMLHttpRequest=Es;function Es(r){"use strict";r=r||{};var e=this,t=require("http"),s=require("https"),n,i,o={},a=!1,h={"User-Agent":"node-XMLHttpRequest",Accept:"*/*"},l=Object.assign({},h),c=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","content-transfer-encoding","cookie","cookie2","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","via"],f=["TRACE","TRACK","CONNECT"],u=!1,p=!1,_=!1,d={};this.UNSENT=0,this.OPENED=1,this.HEADERS_RECEIVED=2,this.LOADING=3,this.DONE=4,this.readyState=this.UNSENT,this.onreadystatechange=null,this.responseText="",this.responseXML="",this.response=Buffer.alloc(0),this.status=null,this.statusText=null;var g=function(m){return a||m&&c.indexOf(m.toLowerCase())===-1},x=function(m){return m&&f.indexOf(m)===-1};this.open=function(m,y,P,k,R){if(this.abort(),p=!1,_=!1,!x(m))throw new Error("SecurityError: Request method not allowed");o={method:m,url:y.toString(),async:typeof P!="boolean"?!0:P,user:k||null,password:R||null},C(this.OPENED)},this.setDisableHeaderCheck=function(m){a=m},this.setRequestHeader=function(m,y){if(this.readyState!=this.OPENED)throw new Error("INVALID_STATE_ERR: setRequestHeader can only be called when state is OPEN");if(!g(m))return console.warn('Refused to set unsafe header "'+m+'"'),!1;if(u)throw new Error("INVALID_STATE_ERR: send flag is true");return l[m]=y,!0},this.getResponseHeader=function(m){return typeof m=="string"&&this.readyState>this.OPENED&&i.headers[m.toLowerCase()]&&!p?i.headers[m.toLowerCase()]:null},this.getAllResponseHeaders=function(){if(this.readyState<this.HEADERS_RECEIVED||p)return"";var m="";for(var y in i.headers)y!=="set-cookie"&&y!=="set-cookie2"&&(m+=y+": "+i.headers[y]+`\r
`);return m.substr(0,m.length-2)},this.getRequestHeader=function(m){return typeof m=="string"&&l[m]?l[m]:""},this.send=function(m){if(this.readyState!=this.OPENED)throw new Error("INVALID_STATE_ERR: connection must be opened before send() is called");if(u)throw new Error("INVALID_STATE_ERR: send has already been called");var y=!1,P=!1,k=ji.parse(o.url),R;switch(k.protocol){case"https:":y=!0;case"http:":R=k.hostname;break;case"file:":P=!0;break;case void 0:case"":R="localhost";break;default:throw new Error("Protocol not supported.")}if(P){if(o.method!=="GET")throw new Error("XMLHttpRequest: Only GET method is supported");if(o.async)Ze.readFile(unescape(k.pathname),function(q,Oe){q?e.handleError(q,q.errno||-1):(e.status=200,e.responseText=Oe.toString("utf8"),e.response=Oe,C(e.DONE))});else try{this.response=Ze.readFileSync(unescape(k.pathname)),this.responseText=this.response.toString("utf8"),this.status=200,C(e.DONE)}catch(q){this.handleError(q,q.errno||-1)}return}var M=k.port||(y?443:80),$=k.pathname+(k.search?k.search:"");if(l.Host=R,y&&M===443||M===80||(l.Host+=":"+k.port),o.user){typeof o.password>"u"&&(o.password="");var ft=new Buffer(o.user+":"+o.password);l.Authorization="Basic "+ft.toString("base64")}if(o.method==="GET"||o.method==="HEAD")m=null;else if(m){l["Content-Length"]=Buffer.isBuffer(m)?m.length:Buffer.byteLength(m);var za=Object.keys(l);za.some(function(q){return q.toLowerCase()==="content-type"})||(l["Content-Type"]="text/plain;charset=UTF-8")}else o.method==="POST"&&(l["Content-Length"]=0);var Ya=r.agent||!1,ie={host:R,port:M,path:$,method:o.method,headers:l,agent:Ya};if(y&&(ie.pfx=r.pfx,ie.key=r.key,ie.passphrase=r.passphrase,ie.cert=r.cert,ie.ca=r.ca,ie.ciphers=r.ciphers,ie.rejectUnauthorized=r.rejectUnauthorized!==!1),p=!1,o.async){var jr=y?s.request:t.request;u=!0,e.dispatchEvent("readystatechange");var Vr=function(q){if(i=q,i.statusCode===302||i.statusCode===303||i.statusCode===307){o.url=i.headers.location;var Oe=ji.parse(o.url);R=Oe.hostname;var we={hostname:Oe.hostname,port:Oe.port,path:Oe.path,method:i.statusCode===303?"GET":o.method,headers:l};y&&(we.pfx=r.pfx,we.key=r.key,we.passphrase=r.passphrase,we.cert=r.cert,we.ca=r.ca,we.ciphers=r.ciphers,we.rejectUnauthorized=r.rejectUnauthorized!==!1),n=jr(we,Vr).on("error",$r),n.end();return}C(e.HEADERS_RECEIVED),e.status=i.statusCode,i.on("data",function(Ht){if(Ht){var Qa=Buffer.from(Ht);e.response=Buffer.concat([e.response,Qa])}u&&C(e.LOADING)}),i.on("end",function(){u&&(u=!1,C(e.DONE),e.responseText=e.response.toString("utf8"))}),i.on("error",function(Ht){e.handleError(Ht)})},$r=function(q){if(n.reusedSocket&&q.code==="ECONNRESET")return jr(ie,Vr).on("error",$r);e.handleError(q)};n=jr(ie,Vr).on("error",$r),r.autoUnref&&n.on("socket",q=>{q.unref()}),m&&n.write(m),n.end(),e.dispatchEvent("loadstart")}else{var ut=".node-xmlhttprequest-content-"+process.pid,dt=".node-xmlhttprequest-sync-"+process.pid;Ze.writeFileSync(dt,"","utf8");for(var Ja="var http = require('http'), https = require('https'), fs = require('fs');var doRequest = http"+(y?"s":"")+".request;var options = "+JSON.stringify(ie)+";var responseText = '';var responseData = Buffer.alloc(0);var req = doRequest(options, function(response) {response.on('data', function(chunk) {  var data = Buffer.from(chunk);  responseText += data.toString('utf8');  responseData = Buffer.concat([responseData, data]);});response.on('end', function() {fs.writeFileSync('"+ut+"', JSON.stringify({err: null, data: {statusCode: response.statusCode, headers: response.headers, text: responseText, data: responseData.toString('base64')}}), 'utf8');fs.unlinkSync('"+dt+"');});response.on('error', function(error) {fs.writeFileSync('"+ut+"', 'NODE-XMLHTTPREQUEST-ERROR:' + JSON.stringify(error), 'utf8');fs.unlinkSync('"+dt+"');});}).on('error', function(error) {fs.writeFileSync('"+ut+"', 'NODE-XMLHTTPREQUEST-ERROR:' + JSON.stringify(error), 'utf8');fs.unlinkSync('"+dt+"');});"+(m?"req.write('"+JSON.stringify(m).slice(1,-1).replace(/'/g,"\\'")+"');":"")+"req.end();",Ka=Ql(process.argv[0],["-e",Ja]),fu;Ze.existsSync(dt););if(e.responseText=Ze.readFileSync(ut,"utf8"),Ka.stdin.end(),Ze.unlinkSync(ut),e.responseText.match(/^NODE-XMLHTTPREQUEST-ERROR:/)){var Xa=JSON.parse(e.responseText.replace(/^NODE-XMLHTTPREQUEST-ERROR:/,""));e.handleError(Xa,503)}else{e.status=e.responseText.replace(/^NODE-XMLHTTPREQUEST-STATUS:([0-9]*),.*/,"$1");var Gr=JSON.parse(e.responseText.replace(/^NODE-XMLHTTPREQUEST-STATUS:[0-9]*,(.*)/,"$1"));i={statusCode:e.status,headers:Gr.data.headers},e.responseText=Gr.data.text,e.response=Buffer.from(Gr.data.data,"base64"),C(e.DONE,!0)}}},this.handleError=function(m,y){this.status=y||0,this.statusText=m,this.responseText=m.stack,p=!0,C(this.DONE)},this.abort=function(){n&&(n.abort(),n=null),l=Object.assign({},h),this.responseText="",this.responseXML="",this.response=Buffer.alloc(0),p=_=!0,this.readyState!==this.UNSENT&&(this.readyState!==this.OPENED||u)&&this.readyState!==this.DONE&&(u=!1,C(this.DONE)),this.readyState=this.UNSENT},this.addEventListener=function(m,y){m in d||(d[m]=[]),d[m].push(y)},this.removeEventListener=function(m,y){m in d&&(d[m]=d[m].filter(function(P){return P!==y}))},this.dispatchEvent=function(m){if(typeof e["on"+m]=="function"&&(this.readyState===this.DONE&&o.async?setTimeout(function(){e["on"+m]()},0):e["on"+m]()),m in d)for(let y=0,P=d[m].length;y<P;y++)this.readyState===this.DONE?setTimeout(function(){d[m][y].call(e)},0):d[m][y].call(e)};var C=function(m){if(!(e.readyState===m||e.readyState===e.UNSENT&&_)&&(e.readyState=m,(o.async||e.readyState<e.OPENED||e.readyState===e.DONE)&&e.dispatchEvent("readystatechange"),e.readyState===e.DONE)){let y;_?y="abort":p?y="error":y="load",e.dispatchEvent(y),e.dispatchEvent("loadend")}}}});var Be=v(Zi=>{Zi.Emitter=W;function W(r){if(r)return Zl(r)}function Zl(r){for(var e in W.prototype)r[e]=W.prototype[e];return r}W.prototype.on=W.prototype.addEventListener=function(r,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+r]=this._callbacks["$"+r]||[]).push(e),this};W.prototype.once=function(r,e){function t(){this.off(r,t),e.apply(this,arguments)}return t.fn=e,this.on(r,t),this};W.prototype.off=W.prototype.removeListener=W.prototype.removeAllListeners=W.prototype.removeEventListener=function(r,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+r];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+r],this;for(var s,n=0;n<t.length;n++)if(s=t[n],s===e||s.fn===e){t.splice(n,1);break}return t.length===0&&delete this._callbacks["$"+r],this};W.prototype.emit=function(r){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+r],s=1;s<arguments.length;s++)e[s-1]=arguments[s];if(t){t=t.slice(0);for(var s=0,n=t.length;s<n;++s)t[s].apply(this,e)}return this};W.prototype.emitReserved=W.prototype.emit;W.prototype.listeners=function(r){return this._callbacks=this._callbacks||{},this._callbacks["$"+r]||[]};W.prototype.hasListeners=function(r){return!!this.listeners(r).length}});var Ts=v((ud,io)=>{function ih(r){t.debug=t,t.default=t,t.coerce=h,t.disable=i,t.enable=n,t.enabled=o,t.humanize=zr(),t.destroy=l,Object.keys(r).forEach(c=>{t[c]=r[c]}),t.names=[],t.skips=[],t.formatters={};function e(c){let f=0;for(let u=0;u<c.length;u++)f=(f<<5)-f+c.charCodeAt(u),f|=0;return t.colors[Math.abs(f)%t.colors.length]}t.selectColor=e;function t(c){let f,u=null,p,_;function d(...g){if(!d.enabled)return;let x=d,C=Number(new Date),m=C-(f||C);x.diff=m,x.prev=f,x.curr=C,f=C,g[0]=t.coerce(g[0]),typeof g[0]!="string"&&g.unshift("%O");let y=0;g[0]=g[0].replace(/%([a-zA-Z%])/g,(k,R)=>{if(k==="%%")return"%";y++;let M=t.formatters[R];if(typeof M=="function"){let $=g[y];k=M.call(x,$),g.splice(y,1),y--}return k}),t.formatArgs.call(x,g),(x.log||t.log).apply(x,g)}return d.namespace=c,d.useColors=t.useColors(),d.color=t.selectColor(c),d.extend=s,d.destroy=t.destroy,Object.defineProperty(d,"enabled",{enumerable:!0,configurable:!1,get:()=>u!==null?u:(p!==t.namespaces&&(p=t.namespaces,_=t.enabled(c)),_),set:g=>{u=g}}),typeof t.init=="function"&&t.init(d),d}function s(c,f){let u=t(this.namespace+(typeof f>"u"?":":f)+c);return u.log=this.log,u}function n(c){t.save(c),t.namespaces=c,t.names=[],t.skips=[];let f,u=(typeof c=="string"?c:"").split(/[\s,]+/),p=u.length;for(f=0;f<p;f++)u[f]&&(c=u[f].replace(/\*/g,".*?"),c[0]==="-"?t.skips.push(new RegExp("^"+c.slice(1)+"$")):t.names.push(new RegExp("^"+c+"$")))}function i(){let c=[...t.names.map(a),...t.skips.map(a).map(f=>"-"+f)].join(",");return t.enable(""),c}function o(c){if(c[c.length-1]==="*")return!0;let f,u;for(f=0,u=t.skips.length;f<u;f++)if(t.skips[f].test(c))return!1;for(f=0,u=t.names.length;f<u;f++)if(t.names[f].test(c))return!0;return!1}function a(c){return c.toString().substring(2,c.toString().length-2).replace(/\.\*\?$/,"*")}function h(c){return c instanceof Error?c.stack||c.message:c}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}io.exports=ih});var oo=v((H,gr)=>{H.formatArgs=ah;H.save=ch;H.load=lh;H.useColors=oh;H.storage=hh();H.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();H.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function oh(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let r;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(r=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(r[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function ah(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+gr.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,s=0;r[0].replace(/%[a-zA-Z%]/g,n=>{n!=="%%"&&(t++,n==="%c"&&(s=t))}),r.splice(s,0,e)}H.log=console.debug||console.log||(()=>{});function ch(r){try{r?H.storage.setItem("debug",r):H.storage.removeItem("debug")}catch{}}function lh(){let r;try{r=H.storage.getItem("debug")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}function hh(){try{return localStorage}catch{}}gr.exports=Ts()(H);var{formatters:fh}=gr.exports;fh.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var co=v((F,yr)=>{var uh=require("tty"),_r=require("util");F.init=Sh;F.log=gh;F.formatArgs=ph;F.save=_h;F.load=yh;F.useColors=dh;F.destroy=_r.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");F.colors=[6,2,3,4,5,1];try{let r=Kr();r&&(r.stderr||r).level>=2&&(F.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}F.inspectOpts=Object.keys(process.env).filter(r=>/^debug_/i.test(r)).reduce((r,e)=>{let t=e.substring(6).toLowerCase().replace(/_([a-z])/g,(n,i)=>i.toUpperCase()),s=process.env[e];return/^(yes|on|true|enabled)$/i.test(s)?s=!0:/^(no|off|false|disabled)$/i.test(s)?s=!1:s==="null"?s=null:s=Number(s),r[t]=s,r},{});function dh(){return"colors"in F.inspectOpts?!!F.inspectOpts.colors:uh.isatty(process.stderr.fd)}function ph(r){let{namespace:e,useColors:t}=this;if(t){let s=this.color,n="\x1B[3"+(s<8?s:"8;5;"+s),i=`  ${n};1m${e} \x1B[0m`;r[0]=i+r[0].split(`
`).join(`
`+i),r.push(n+"m+"+yr.exports.humanize(this.diff)+"\x1B[0m")}else r[0]=mh()+e+" "+r[0]}function mh(){return F.inspectOpts.hideDate?"":new Date().toISOString()+" "}function gh(...r){return process.stderr.write(_r.formatWithOptions(F.inspectOpts,...r)+`
`)}function _h(r){r?process.env.DEBUG=r:delete process.env.DEBUG}function yh(){return process.env.DEBUG}function Sh(r){r.inspectOpts={};let e=Object.keys(F.inspectOpts);for(let t=0;t<e.length;t++)r.inspectOpts[e[t]]=F.inspectOpts[e[t]]}yr.exports=Ts()(F);var{formatters:ao}=yr.exports;ao.o=function(r){return this.inspectOpts.colors=this.useColors,_r.inspect(r,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};ao.O=function(r){return this.inspectOpts.colors=this.useColors,_r.inspect(r,this.inspectOpts)}});var Q=v((dd,Os)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?Os.exports=oo():Os.exports=co()});var wo=v((Rd,vo)=>{"use strict";var{Duplex:Ch}=require("stream");function yo(r){r.emit("close")}function bh(){!this.destroyed&&this._writableState.finished&&this.destroy()}function So(r){this.removeListener("error",So),this.destroy(),this.listenerCount("error")===0&&this.emit("error",r)}function kh(r,e){let t=!0,s=new Ch({...e,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return r.on("message",function(i,o){let a=!o&&s._readableState.objectMode?i.toString():i;s.push(a)||r.pause()}),r.once("error",function(i){s.destroyed||(t=!1,s.destroy(i))}),r.once("close",function(){s.destroyed||s.push(null)}),s._destroy=function(n,i){if(r.readyState===r.CLOSED){i(n),process.nextTick(yo,s);return}let o=!1;r.once("error",function(h){o=!0,i(h)}),r.once("close",function(){o||i(n),process.nextTick(yo,s)}),t&&r.terminate()},s._final=function(n){if(r.readyState===r.CONNECTING){r.once("open",function(){s._final(n)});return}r._socket!==null&&(r._socket._writableState.finished?(n(),s._readableState.endEmitted&&s.destroy()):(r._socket.once("finish",function(){n()}),r.close()))},s._read=function(){r.isPaused&&r.resume()},s._write=function(n,i,o){if(r.readyState===r.CONNECTING){r.once("open",function(){s._write(n,i,o)});return}r.send(n,o)},s.on("end",bh),s.on("error",So),s}vo.exports=kh});var Ce=v((Ld,Eo)=>{"use strict";Eo.exports={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var Pt=v((Ad,wr)=>{"use strict";var{EMPTY_BUFFER:Th}=Ce(),Rs=Buffer[Symbol.species];function Oh(r,e){if(r.length===0)return Th;if(r.length===1)return r[0];let t=Buffer.allocUnsafe(e),s=0;for(let n=0;n<r.length;n++){let i=r[n];t.set(i,s),s+=i.length}return s<e?new Rs(t.buffer,t.byteOffset,s):t}function xo(r,e,t,s,n){for(let i=0;i<n;i++)t[s+i]=r[i]^e[i&3]}function Co(r,e){for(let t=0;t<r.length;t++)r[t]^=e[t&3]}function Ph(r){return r.length===r.buffer.byteLength?r.buffer:r.buffer.slice(r.byteOffset,r.byteOffset+r.length)}function Ls(r){if(Ls.readOnly=!0,Buffer.isBuffer(r))return r;let e;return r instanceof ArrayBuffer?e=new Rs(r):ArrayBuffer.isView(r)?e=new Rs(r.buffer,r.byteOffset,r.byteLength):(e=Buffer.from(r),Ls.readOnly=!1),e}wr.exports={concat:Oh,mask:xo,toArrayBuffer:Ph,toBuffer:Ls,unmask:Co};if(!process.env.WS_NO_BUFFER_UTIL)try{let r=require("bufferutil");wr.exports.mask=function(e,t,s,n,i){i<48?xo(e,t,s,n,i):r.mask(e,t,s,n,i)},wr.exports.unmask=function(e,t){e.length<32?Co(e,t):r.unmask(e,t)}}catch{}});var To=v((Id,ko)=>{"use strict";var bo=Symbol("kDone"),As=Symbol("kRun"),Is=class{constructor(e){this[bo]=()=>{this.pending--,this[As]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[As]()}[As](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[bo])}}};ko.exports=Is});var Lt=v((Bd,Ro)=>{"use strict";var Nt=require("zlib"),Oo=Pt(),Nh=To(),{kStatusCode:Po}=Ce(),Rh=Buffer[Symbol.species],Lh=Buffer.from([0,0,255,255]),Cr=Symbol("permessage-deflate"),ye=Symbol("total-length"),Rt=Symbol("callback"),be=Symbol("buffers"),xr=Symbol("error"),Er,Bs=class{constructor(e,t,s){if(this._maxPayload=s|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!Er){let n=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;Er=new Nh(n)}}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[Rt];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let t=this._options,s=e.find(n=>!(t.serverNoContextTakeover===!1&&n.server_no_context_takeover||n.server_max_window_bits&&(t.serverMaxWindowBits===!1||typeof t.serverMaxWindowBits=="number"&&t.serverMaxWindowBits>n.server_max_window_bits)||typeof t.clientMaxWindowBits=="number"&&!n.client_max_window_bits));if(!s)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(s.server_no_context_takeover=!0),t.clientNoContextTakeover&&(s.client_no_context_takeover=!0),typeof t.serverMaxWindowBits=="number"&&(s.server_max_window_bits=t.serverMaxWindowBits),typeof t.clientMaxWindowBits=="number"?s.client_max_window_bits=t.clientMaxWindowBits:(s.client_max_window_bits===!0||t.clientMaxWindowBits===!1)&&delete s.client_max_window_bits,s}acceptAsClient(e){let t=e[0];if(this._options.clientNoContextTakeover===!1&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!t.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(t.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return t}normalizeParams(e){return e.forEach(t=>{Object.keys(t).forEach(s=>{let n=t[s];if(n.length>1)throw new Error(`Parameter "${s}" must have only a single value`);if(n=n[0],s==="client_max_window_bits"){if(n!==!0){let i=+n;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError(`Invalid value for parameter "${s}": ${n}`);n=i}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${s}": ${n}`)}else if(s==="server_max_window_bits"){let i=+n;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError(`Invalid value for parameter "${s}": ${n}`);n=i}else if(s==="client_no_context_takeover"||s==="server_no_context_takeover"){if(n!==!0)throw new TypeError(`Invalid value for parameter "${s}": ${n}`)}else throw new Error(`Unknown parameter "${s}"`);t[s]=n})}),e}decompress(e,t,s){Er.add(n=>{this._decompress(e,t,(i,o)=>{n(),s(i,o)})})}compress(e,t,s){Er.add(n=>{this._compress(e,t,(i,o)=>{n(),s(i,o)})})}_decompress(e,t,s){let n=this._isServer?"client":"server";if(!this._inflate){let i=`${n}_max_window_bits`,o=typeof this.params[i]!="number"?Nt.Z_DEFAULT_WINDOWBITS:this.params[i];this._inflate=Nt.createInflateRaw({...this._options.zlibInflateOptions,windowBits:o}),this._inflate[Cr]=this,this._inflate[ye]=0,this._inflate[be]=[],this._inflate.on("error",Ih),this._inflate.on("data",No)}this._inflate[Rt]=s,this._inflate.write(e),t&&this._inflate.write(Lh),this._inflate.flush(()=>{let i=this._inflate[xr];if(i){this._inflate.close(),this._inflate=null,s(i);return}let o=Oo.concat(this._inflate[be],this._inflate[ye]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[ye]=0,this._inflate[be]=[],t&&this.params[`${n}_no_context_takeover`]&&this._inflate.reset()),s(null,o)})}_compress(e,t,s){let n=this._isServer?"server":"client";if(!this._deflate){let i=`${n}_max_window_bits`,o=typeof this.params[i]!="number"?Nt.Z_DEFAULT_WINDOWBITS:this.params[i];this._deflate=Nt.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:o}),this._deflate[ye]=0,this._deflate[be]=[],this._deflate.on("data",Ah)}this._deflate[Rt]=s,this._deflate.write(e),this._deflate.flush(Nt.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let i=Oo.concat(this._deflate[be],this._deflate[ye]);t&&(i=new Rh(i.buffer,i.byteOffset,i.length-4)),this._deflate[Rt]=null,this._deflate[ye]=0,this._deflate[be]=[],t&&this.params[`${n}_no_context_takeover`]&&this._deflate.reset(),s(null,i)})}};Ro.exports=Bs;function Ah(r){this[be].push(r),this[ye]+=r.length}function No(r){if(this[ye]+=r.length,this[Cr]._maxPayload<1||this[ye]<=this[Cr]._maxPayload){this[be].push(r);return}this[xr]=new RangeError("Max payload size exceeded"),this[xr].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[xr][Po]=1009,this.removeListener("data",No),this.reset()}function Ih(r){this[Cr]._inflate=null,r[Po]=1007,this[Rt](r)}});var At=v((Fd,br)=>{"use strict";var{isUtf8:Lo}=require("buffer"),Bh=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function Fh(r){return r>=1e3&&r<=1014&&r!==1004&&r!==1005&&r!==1006||r>=3e3&&r<=4999}function Fs(r){let e=r.length,t=0;for(;t<e;)if((r[t]&128)===0)t++;else if((r[t]&224)===192){if(t+1===e||(r[t+1]&192)!==128||(r[t]&254)===192)return!1;t+=2}else if((r[t]&240)===224){if(t+2>=e||(r[t+1]&192)!==128||(r[t+2]&192)!==128||r[t]===224&&(r[t+1]&224)===128||r[t]===237&&(r[t+1]&224)===160)return!1;t+=3}else if((r[t]&248)===240){if(t+3>=e||(r[t+1]&192)!==128||(r[t+2]&192)!==128||(r[t+3]&192)!==128||r[t]===240&&(r[t+1]&240)===128||r[t]===244&&r[t+1]>143||r[t]>244)return!1;t+=4}else return!1;return!0}br.exports={isValidStatusCode:Fh,isValidUTF8:Fs,tokenChars:Bh};if(Lo)br.exports.isValidUTF8=function(r){return r.length<24?Fs(r):Lo(r)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let r=require("utf-8-validate");br.exports.isValidUTF8=function(e){return e.length<32?Fs(e):r(e)}}catch{}});var Ws=v((Dd,Mo)=>{"use strict";var{Writable:Dh}=require("stream"),Ao=Lt(),{BINARY_TYPES:Uh,EMPTY_BUFFER:Io,kStatusCode:Mh,kWebSocket:qh}=Ce(),{concat:Ds,toArrayBuffer:Wh,unmask:jh}=Pt(),{isValidStatusCode:Vh,isValidUTF8:Bo}=At(),kr=Buffer[Symbol.species],Z=0,Fo=1,Do=2,Uo=3,Us=4,Ms=5,Tr=6,qs=class extends Dh{constructor(e={}){super(),this._allowSynchronousEvents=e.allowSynchronousEvents!==void 0?e.allowSynchronousEvents:!0,this._binaryType=e.binaryType||Uh[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=e.maxPayload|0,this._skipUTF8Validation=!!e.skipUTF8Validation,this[qh]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=Z}_write(e,t,s){if(this._opcode===8&&this._state==Z)return s();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(s)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let s=this._buffers[0];return this._buffers[0]=new kr(s.buffer,s.byteOffset+e,s.length-e),new kr(s.buffer,s.byteOffset,e)}let t=Buffer.allocUnsafe(e);do{let s=this._buffers[0],n=t.length-e;e>=s.length?t.set(this._buffers.shift(),n):(t.set(new Uint8Array(s.buffer,s.byteOffset,e),n),this._buffers[0]=new kr(s.buffer,s.byteOffset+e,s.length-e)),e-=s.length}while(e>0);return t}startLoop(e){this._loop=!0;do switch(this._state){case Z:this.getInfo(e);break;case Fo:this.getPayloadLength16(e);break;case Do:this.getPayloadLength64(e);break;case Uo:this.getMask();break;case Us:this.getData(e);break;case Ms:case Tr:this._loop=!1;return}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2){this._loop=!1;return}let t=this.consume(2);if((t[0]&48)!==0){let n=this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");e(n);return}let s=(t[0]&64)===64;if(s&&!this._extensions[Ao.extensionName]){let n=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(n);return}if(this._fin=(t[0]&128)===128,this._opcode=t[0]&15,this._payloadLength=t[1]&127,this._opcode===0){if(s){let n=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(n);return}if(!this._fragmented){let n=this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");e(n);return}this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented){let n=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(n);return}this._compressed=s}else if(this._opcode>7&&this._opcode<11){if(!this._fin){let n=this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");e(n);return}if(s){let n=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(n);return}if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1){let n=this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");e(n);return}}else{let n=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(n);return}if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(t[1]&128)===128,this._isServer){if(!this._masked){let n=this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK");e(n);return}}else if(this._masked){let n=this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");e(n);return}this._payloadLength===126?this._state=Fo:this._payloadLength===127?this._state=Do:this.haveLength(e)}getPayloadLength16(e){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e)}getPayloadLength64(e){if(this._bufferedBytes<8){this._loop=!1;return}let t=this.consume(8),s=t.readUInt32BE(0);if(s>Math.pow(2,21)-1){let n=this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH");e(n);return}this._payloadLength=s*Math.pow(2,32)+t.readUInt32BE(4),this.haveLength(e)}haveLength(e){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)){let t=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");e(t);return}this._masked?this._state=Uo:this._state=Us}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=Us}getData(e){let t=Io;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}t=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!==0&&jh(t,this._mask)}if(this._opcode>7){this.controlMessage(t,e);return}if(this._compressed){this._state=Ms,this.decompress(t,e);return}t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage(e)}decompress(e,t){this._extensions[Ao.extensionName].decompress(e,this._fin,(n,i)=>{if(n)return t(n);if(i.length){if(this._messageLength+=i.length,this._messageLength>this._maxPayload&&this._maxPayload>0){let o=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");t(o);return}this._fragments.push(i)}this.dataMessage(t),this._state===Z&&this.startLoop(t)})}dataMessage(e){if(!this._fin){this._state=Z;return}let t=this._messageLength,s=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let n;this._binaryType==="nodebuffer"?n=Ds(s,t):this._binaryType==="arraybuffer"?n=Wh(Ds(s,t)):n=s,this._allowSynchronousEvents?(this.emit("message",n,!0),this._state=Z):(this._state=Tr,setImmediate(()=>{this.emit("message",n,!0),this._state=Z,this.startLoop(e)}))}else{let n=Ds(s,t);if(!this._skipUTF8Validation&&!Bo(n)){let i=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");e(i);return}this._state===Ms||this._allowSynchronousEvents?(this.emit("message",n,!1),this._state=Z):(this._state=Tr,setImmediate(()=>{this.emit("message",n,!1),this._state=Z,this.startLoop(e)}))}}controlMessage(e,t){if(this._opcode===8){if(e.length===0)this._loop=!1,this.emit("conclude",1005,Io),this.end();else{let s=e.readUInt16BE(0);if(!Vh(s)){let i=this.createError(RangeError,`invalid status code ${s}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");t(i);return}let n=new kr(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!Bo(n)){let i=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");t(i);return}this._loop=!1,this.emit("conclude",s,n),this.end()}this._state=Z;return}this._allowSynchronousEvents?(this.emit(this._opcode===9?"ping":"pong",e),this._state=Z):(this._state=Tr,setImmediate(()=>{this.emit(this._opcode===9?"ping":"pong",e),this._state=Z,this.startLoop(t)}))}createError(e,t,s,n,i){this._loop=!1,this._errored=!0;let o=new e(s?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(o,this.createError),o.code=i,o[Mh]=n,o}};Mo.exports=qs});var Vs=v((Md,jo)=>{"use strict";var{Duplex:Ud}=require("stream"),{randomFillSync:$h}=require("crypto"),qo=Lt(),{EMPTY_BUFFER:Gh}=Ce(),{isValidStatusCode:Hh}=At(),{mask:Wo,toBuffer:tt}=Pt(),se=Symbol("kByteLength"),zh=Buffer.alloc(4),Or=8*1024,Fe,rt=Or,js=class r{constructor(e,t,s){this._extensions=t||{},s&&(this._generateMask=s,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,t){let s,n=!1,i=2,o=!1;t.mask&&(s=t.maskBuffer||zh,t.generateMask?t.generateMask(s):(rt===Or&&(Fe===void 0&&(Fe=Buffer.alloc(Or)),$h(Fe,0,Or),rt=0),s[0]=Fe[rt++],s[1]=Fe[rt++],s[2]=Fe[rt++],s[3]=Fe[rt++]),o=(s[0]|s[1]|s[2]|s[3])===0,i=6);let a;typeof e=="string"?(!t.mask||o)&&t[se]!==void 0?a=t[se]:(e=Buffer.from(e),a=e.length):(a=e.length,n=t.mask&&t.readOnly&&!o);let h=a;a>=65536?(i+=8,h=127):a>125&&(i+=2,h=126);let l=Buffer.allocUnsafe(n?a+i:i);return l[0]=t.fin?t.opcode|128:t.opcode,t.rsv1&&(l[0]|=64),l[1]=h,h===126?l.writeUInt16BE(a,2):h===127&&(l[2]=l[3]=0,l.writeUIntBE(a,4,6)),t.mask?(l[1]|=128,l[i-4]=s[0],l[i-3]=s[1],l[i-2]=s[2],l[i-1]=s[3],o?[l,e]:n?(Wo(e,s,l,i,a),[l]):(Wo(e,s,e,0,a),[l,e])):[l,e]}close(e,t,s,n){let i;if(e===void 0)i=Gh;else{if(typeof e!="number"||!Hh(e))throw new TypeError("First argument must be a valid error code number");if(t===void 0||!t.length)i=Buffer.allocUnsafe(2),i.writeUInt16BE(e,0);else{let a=Buffer.byteLength(t);if(a>123)throw new RangeError("The message must not be greater than 123 bytes");i=Buffer.allocUnsafe(2+a),i.writeUInt16BE(e,0),typeof t=="string"?i.write(t,2):i.set(t,2)}}let o={[se]:i.length,fin:!0,generateMask:this._generateMask,mask:s,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._deflating?this.enqueue([this.dispatch,i,!1,o,n]):this.sendFrame(r.frame(i,o),n)}ping(e,t,s){let n,i;if(typeof e=="string"?(n=Buffer.byteLength(e),i=!1):(e=tt(e),n=e.length,i=tt.readOnly),n>125)throw new RangeError("The data size must not be greater than 125 bytes");let o={[se]:n,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:9,readOnly:i,rsv1:!1};this._deflating?this.enqueue([this.dispatch,e,!1,o,s]):this.sendFrame(r.frame(e,o),s)}pong(e,t,s){let n,i;if(typeof e=="string"?(n=Buffer.byteLength(e),i=!1):(e=tt(e),n=e.length,i=tt.readOnly),n>125)throw new RangeError("The data size must not be greater than 125 bytes");let o={[se]:n,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:10,readOnly:i,rsv1:!1};this._deflating?this.enqueue([this.dispatch,e,!1,o,s]):this.sendFrame(r.frame(e,o),s)}send(e,t,s){let n=this._extensions[qo.extensionName],i=t.binary?2:1,o=t.compress,a,h;if(typeof e=="string"?(a=Buffer.byteLength(e),h=!1):(e=tt(e),a=e.length,h=tt.readOnly),this._firstFragment?(this._firstFragment=!1,o&&n&&n.params[n._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(o=a>=n._threshold),this._compress=o):(o=!1,i=0),t.fin&&(this._firstFragment=!0),n){let l={[se]:a,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:i,readOnly:h,rsv1:o};this._deflating?this.enqueue([this.dispatch,e,this._compress,l,s]):this.dispatch(e,this._compress,l,s)}else this.sendFrame(r.frame(e,{[se]:a,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:i,readOnly:h,rsv1:!1}),s)}dispatch(e,t,s,n){if(!t){this.sendFrame(r.frame(e,s),n);return}let i=this._extensions[qo.extensionName];this._bufferedBytes+=s[se],this._deflating=!0,i.compress(e,s.fin,(o,a)=>{if(this._socket.destroyed){let h=new Error("The socket was closed while data was being compressed");typeof n=="function"&&n(h);for(let l=0;l<this._queue.length;l++){let c=this._queue[l],f=c[c.length-1];typeof f=="function"&&f(h)}return}this._bufferedBytes-=s[se],this._deflating=!1,s.readOnly=!1,this.sendFrame(r.frame(a,s),n),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[3][se],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][se],this._queue.push(e)}sendFrame(e,t){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}};jo.exports=js});var Xo=v((qd,Ko)=>{"use strict";var{kForOnEventAttribute:It,kListener:$s}=Ce(),Vo=Symbol("kCode"),$o=Symbol("kData"),Go=Symbol("kError"),Ho=Symbol("kMessage"),zo=Symbol("kReason"),st=Symbol("kTarget"),Yo=Symbol("kType"),Jo=Symbol("kWasClean"),Se=class{constructor(e){this[st]=null,this[Yo]=e}get target(){return this[st]}get type(){return this[Yo]}};Object.defineProperty(Se.prototype,"target",{enumerable:!0});Object.defineProperty(Se.prototype,"type",{enumerable:!0});var De=class extends Se{constructor(e,t={}){super(e),this[Vo]=t.code===void 0?0:t.code,this[zo]=t.reason===void 0?"":t.reason,this[Jo]=t.wasClean===void 0?!1:t.wasClean}get code(){return this[Vo]}get reason(){return this[zo]}get wasClean(){return this[Jo]}};Object.defineProperty(De.prototype,"code",{enumerable:!0});Object.defineProperty(De.prototype,"reason",{enumerable:!0});Object.defineProperty(De.prototype,"wasClean",{enumerable:!0});var nt=class extends Se{constructor(e,t={}){super(e),this[Go]=t.error===void 0?null:t.error,this[Ho]=t.message===void 0?"":t.message}get error(){return this[Go]}get message(){return this[Ho]}};Object.defineProperty(nt.prototype,"error",{enumerable:!0});Object.defineProperty(nt.prototype,"message",{enumerable:!0});var Bt=class extends Se{constructor(e,t={}){super(e),this[$o]=t.data===void 0?null:t.data}get data(){return this[$o]}};Object.defineProperty(Bt.prototype,"data",{enumerable:!0});var Yh={addEventListener(r,e,t={}){for(let n of this.listeners(r))if(!t[It]&&n[$s]===e&&!n[It])return;let s;if(r==="message")s=function(i,o){let a=new Bt("message",{data:o?i:i.toString()});a[st]=this,Pr(e,this,a)};else if(r==="close")s=function(i,o){let a=new De("close",{code:i,reason:o.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});a[st]=this,Pr(e,this,a)};else if(r==="error")s=function(i){let o=new nt("error",{error:i,message:i.message});o[st]=this,Pr(e,this,o)};else if(r==="open")s=function(){let i=new Se("open");i[st]=this,Pr(e,this,i)};else return;s[It]=!!t[It],s[$s]=e,t.once?this.once(r,s):this.on(r,s)},removeEventListener(r,e){for(let t of this.listeners(r))if(t[$s]===e&&!t[It]){this.removeListener(r,t);break}}};Ko.exports={CloseEvent:De,ErrorEvent:nt,Event:Se,EventTarget:Yh,MessageEvent:Bt};function Pr(r,e,t){typeof r=="object"&&r.handleEvent?r.handleEvent.call(r,t):r.call(e,t)}});var Gs=v((Wd,Qo)=>{"use strict";var{tokenChars:Ft}=At();function ae(r,e,t){r[e]===void 0?r[e]=[t]:r[e].push(t)}function Jh(r){let e=Object.create(null),t=Object.create(null),s=!1,n=!1,i=!1,o,a,h=-1,l=-1,c=-1,f=0;for(;f<r.length;f++)if(l=r.charCodeAt(f),o===void 0)if(c===-1&&Ft[l]===1)h===-1&&(h=f);else if(f!==0&&(l===32||l===9))c===-1&&h!==-1&&(c=f);else if(l===59||l===44){if(h===-1)throw new SyntaxError(`Unexpected character at index ${f}`);c===-1&&(c=f);let p=r.slice(h,c);l===44?(ae(e,p,t),t=Object.create(null)):o=p,h=c=-1}else throw new SyntaxError(`Unexpected character at index ${f}`);else if(a===void 0)if(c===-1&&Ft[l]===1)h===-1&&(h=f);else if(l===32||l===9)c===-1&&h!==-1&&(c=f);else if(l===59||l===44){if(h===-1)throw new SyntaxError(`Unexpected character at index ${f}`);c===-1&&(c=f),ae(t,r.slice(h,c),!0),l===44&&(ae(e,o,t),t=Object.create(null),o=void 0),h=c=-1}else if(l===61&&h!==-1&&c===-1)a=r.slice(h,f),h=c=-1;else throw new SyntaxError(`Unexpected character at index ${f}`);else if(n){if(Ft[l]!==1)throw new SyntaxError(`Unexpected character at index ${f}`);h===-1?h=f:s||(s=!0),n=!1}else if(i)if(Ft[l]===1)h===-1&&(h=f);else if(l===34&&h!==-1)i=!1,c=f;else if(l===92)n=!0;else throw new SyntaxError(`Unexpected character at index ${f}`);else if(l===34&&r.charCodeAt(f-1)===61)i=!0;else if(c===-1&&Ft[l]===1)h===-1&&(h=f);else if(h!==-1&&(l===32||l===9))c===-1&&(c=f);else if(l===59||l===44){if(h===-1)throw new SyntaxError(`Unexpected character at index ${f}`);c===-1&&(c=f);let p=r.slice(h,c);s&&(p=p.replace(/\\/g,""),s=!1),ae(t,a,p),l===44&&(ae(e,o,t),t=Object.create(null),o=void 0),a=void 0,h=c=-1}else throw new SyntaxError(`Unexpected character at index ${f}`);if(h===-1||i||l===32||l===9)throw new SyntaxError("Unexpected end of input");c===-1&&(c=f);let u=r.slice(h,c);return o===void 0?ae(e,u,t):(a===void 0?ae(t,u,!0):s?ae(t,a,u.replace(/\\/g,"")):ae(t,a,u),ae(e,o,t)),e}function Kh(r){return Object.keys(r).map(e=>{let t=r[e];return Array.isArray(t)||(t=[t]),t.map(s=>[e].concat(Object.keys(s).map(n=>{let i=s[n];return Array.isArray(i)||(i=[i]),i.map(o=>o===!0?n:`${n}=${o}`).join("; ")})).join("; ")).join(", ")}).join(", ")}Qo.exports={format:Kh,parse:Jh}});var Ks=v(($d,la)=>{"use strict";var Xh=require("events"),Qh=require("https"),Zh=require("http"),ta=require("net"),ef=require("tls"),{randomBytes:tf,createHash:rf}=require("crypto"),{Duplex:jd,Readable:Vd}=require("stream"),{URL:Hs}=require("url"),ke=Lt(),sf=Ws(),nf=Vs(),{BINARY_TYPES:Zo,EMPTY_BUFFER:Nr,GUID:of,kForOnEventAttribute:zs,kListener:af,kStatusCode:cf,kWebSocket:U,NOOP:ra}=Ce(),{EventTarget:{addEventListener:lf,removeEventListener:hf}}=Xo(),{format:ff,parse:uf}=Gs(),{toBuffer:df}=Pt(),pf=30*1e3,sa=Symbol("kAborted"),Ys=[8,13],ve=["CONNECTING","OPEN","CLOSING","CLOSED"],mf=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/,N=class r extends Xh{constructor(e,t,s){super(),this._binaryType=Zo[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=Nr,this._closeTimer=null,this._extensions={},this._paused=!1,this._protocol="",this._readyState=r.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,t===void 0?t=[]:Array.isArray(t)||(typeof t=="object"&&t!==null?(s=t,t=[]):t=[t]),na(this,e,t,s)):(this._autoPong=s.autoPong,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){Zo.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,s){let n=new sf({allowSynchronousEvents:s.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:s.maxPayload,skipUTF8Validation:s.skipUTF8Validation});this._sender=new nf(e,this._extensions,s.generateMask),this._receiver=n,this._socket=e,n[U]=this,e[U]=this,n.on("conclude",yf),n.on("drain",Sf),n.on("error",vf),n.on("message",wf),n.on("ping",Ef),n.on("pong",xf),e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",oa),e.on("data",Lr),e.on("end",aa),e.on("error",ca),this._readyState=r.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=r.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[ke.extensionName]&&this._extensions[ke.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=r.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==r.CLOSED){if(this.readyState===r.CONNECTING){z(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===r.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=r.CLOSING,this._sender.close(e,t,!this._isServer,s=>{s||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),pf)}}pause(){this.readyState===r.CONNECTING||this.readyState===r.CLOSED||(this._paused=!0,this._socket.pause())}ping(e,t,s){if(this.readyState===r.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(s=e,e=t=void 0):typeof t=="function"&&(s=t,t=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==r.OPEN){Js(this,e,s);return}t===void 0&&(t=!this._isServer),this._sender.ping(e||Nr,t,s)}pong(e,t,s){if(this.readyState===r.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(s=e,e=t=void 0):typeof t=="function"&&(s=t,t=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==r.OPEN){Js(this,e,s);return}t===void 0&&(t=!this._isServer),this._sender.pong(e||Nr,t,s)}resume(){this.readyState===r.CONNECTING||this.readyState===r.CLOSED||(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,s){if(this.readyState===r.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof t=="function"&&(s=t,t={}),typeof e=="number"&&(e=e.toString()),this.readyState!==r.OPEN){Js(this,e,s);return}let n={binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[ke.extensionName]||(n.compress=!1),this._sender.send(e||Nr,n,s)}terminate(){if(this.readyState!==r.CLOSED){if(this.readyState===r.CONNECTING){z(this,this._req,"WebSocket was closed before the connection was established");return}this._socket&&(this._readyState=r.CLOSING,this._socket.destroy())}}};Object.defineProperty(N,"CONNECTING",{enumerable:!0,value:ve.indexOf("CONNECTING")});Object.defineProperty(N.prototype,"CONNECTING",{enumerable:!0,value:ve.indexOf("CONNECTING")});Object.defineProperty(N,"OPEN",{enumerable:!0,value:ve.indexOf("OPEN")});Object.defineProperty(N.prototype,"OPEN",{enumerable:!0,value:ve.indexOf("OPEN")});Object.defineProperty(N,"CLOSING",{enumerable:!0,value:ve.indexOf("CLOSING")});Object.defineProperty(N.prototype,"CLOSING",{enumerable:!0,value:ve.indexOf("CLOSING")});Object.defineProperty(N,"CLOSED",{enumerable:!0,value:ve.indexOf("CLOSED")});Object.defineProperty(N.prototype,"CLOSED",{enumerable:!0,value:ve.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(r=>{Object.defineProperty(N.prototype,r,{enumerable:!0})});["open","error","close","message"].forEach(r=>{Object.defineProperty(N.prototype,`on${r}`,{enumerable:!0,get(){for(let e of this.listeners(r))if(e[zs])return e[af];return null},set(e){for(let t of this.listeners(r))if(t[zs]){this.removeListener(r,t);break}typeof e=="function"&&this.addEventListener(r,e,{[zs]:!0})}})});N.prototype.addEventListener=lf;N.prototype.removeEventListener=hf;la.exports=N;function na(r,e,t,s){let n={allowSynchronousEvents:!0,autoPong:!0,protocolVersion:Ys[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...s,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(r._autoPong=n.autoPong,!Ys.includes(n.protocolVersion))throw new RangeError(`Unsupported protocol version: ${n.protocolVersion} (supported versions: ${Ys.join(", ")})`);let i;if(e instanceof Hs)i=e;else try{i=new Hs(e)}catch{throw new SyntaxError(`Invalid URL: ${e}`)}i.protocol==="http:"?i.protocol="ws:":i.protocol==="https:"&&(i.protocol="wss:"),r._url=i.href;let o=i.protocol==="wss:",a=i.protocol==="ws+unix:",h;if(i.protocol!=="ws:"&&!o&&!a?h=`The URL's protocol must be one of "ws:", "wss:", "http:", "https", or "ws+unix:"`:a&&!i.pathname?h="The URL's pathname is empty":i.hash&&(h="The URL contains a fragment identifier"),h){let d=new SyntaxError(h);if(r._redirects===0)throw d;Rr(r,d);return}let l=o?443:80,c=tf(16).toString("base64"),f=o?Qh.request:Zh.request,u=new Set,p;if(n.createConnection=n.createConnection||(o?_f:gf),n.defaultPort=n.defaultPort||l,n.port=i.port||l,n.host=i.hostname.startsWith("[")?i.hostname.slice(1,-1):i.hostname,n.headers={...n.headers,"Sec-WebSocket-Version":n.protocolVersion,"Sec-WebSocket-Key":c,Connection:"Upgrade",Upgrade:"websocket"},n.path=i.pathname+i.search,n.timeout=n.handshakeTimeout,n.perMessageDeflate&&(p=new ke(n.perMessageDeflate!==!0?n.perMessageDeflate:{},!1,n.maxPayload),n.headers["Sec-WebSocket-Extensions"]=ff({[ke.extensionName]:p.offer()})),t.length){for(let d of t){if(typeof d!="string"||!mf.test(d)||u.has(d))throw new SyntaxError("An invalid or duplicated subprotocol was specified");u.add(d)}n.headers["Sec-WebSocket-Protocol"]=t.join(",")}if(n.origin&&(n.protocolVersion<13?n.headers["Sec-WebSocket-Origin"]=n.origin:n.headers.Origin=n.origin),(i.username||i.password)&&(n.auth=`${i.username}:${i.password}`),a){let d=n.path.split(":");n.socketPath=d[0],n.path=d[1]}let _;if(n.followRedirects){if(r._redirects===0){r._originalIpc=a,r._originalSecure=o,r._originalHostOrSocketPath=a?n.socketPath:i.host;let d=s&&s.headers;if(s={...s,headers:{}},d)for(let[g,x]of Object.entries(d))s.headers[g.toLowerCase()]=x}else if(r.listenerCount("redirect")===0){let d=a?r._originalIpc?n.socketPath===r._originalHostOrSocketPath:!1:r._originalIpc?!1:i.host===r._originalHostOrSocketPath;(!d||r._originalSecure&&!o)&&(delete n.headers.authorization,delete n.headers.cookie,d||delete n.headers.host,n.auth=void 0)}n.auth&&!s.headers.authorization&&(s.headers.authorization="Basic "+Buffer.from(n.auth).toString("base64")),_=r._req=f(n),r._redirects&&r.emit("redirect",r.url,_)}else _=r._req=f(n);n.timeout&&_.on("timeout",()=>{z(r,_,"Opening handshake has timed out")}),_.on("error",d=>{_===null||_[sa]||(_=r._req=null,Rr(r,d))}),_.on("response",d=>{let g=d.headers.location,x=d.statusCode;if(g&&n.followRedirects&&x>=300&&x<400){if(++r._redirects>n.maxRedirects){z(r,_,"Maximum redirects exceeded");return}_.abort();let C;try{C=new Hs(g,e)}catch{let y=new SyntaxError(`Invalid URL: ${g}`);Rr(r,y);return}na(r,C,t,s)}else r.emit("unexpected-response",_,d)||z(r,_,`Unexpected server response: ${d.statusCode}`)}),_.on("upgrade",(d,g,x)=>{if(r.emit("upgrade",d),r.readyState!==N.CONNECTING)return;_=r._req=null;let C=d.headers.upgrade;if(C===void 0||C.toLowerCase()!=="websocket"){z(r,g,"Invalid Upgrade header");return}let m=rf("sha1").update(c+of).digest("base64");if(d.headers["sec-websocket-accept"]!==m){z(r,g,"Invalid Sec-WebSocket-Accept header");return}let y=d.headers["sec-websocket-protocol"],P;if(y!==void 0?u.size?u.has(y)||(P="Server sent an invalid subprotocol"):P="Server sent a subprotocol but none was requested":u.size&&(P="Server sent no subprotocol"),P){z(r,g,P);return}y&&(r._protocol=y);let k=d.headers["sec-websocket-extensions"];if(k!==void 0){if(!p){z(r,g,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let R;try{R=uf(k)}catch{z(r,g,"Invalid Sec-WebSocket-Extensions header");return}let M=Object.keys(R);if(M.length!==1||M[0]!==ke.extensionName){z(r,g,"Server indicated an extension that was not requested");return}try{p.accept(R[ke.extensionName])}catch{z(r,g,"Invalid Sec-WebSocket-Extensions header");return}r._extensions[ke.extensionName]=p}r.setSocket(g,x,{allowSynchronousEvents:n.allowSynchronousEvents,generateMask:n.generateMask,maxPayload:n.maxPayload,skipUTF8Validation:n.skipUTF8Validation})}),n.finishRequest?n.finishRequest(_,r):_.end()}function Rr(r,e){r._readyState=N.CLOSING,r.emit("error",e),r.emitClose()}function gf(r){return r.path=r.socketPath,ta.connect(r)}function _f(r){return r.path=void 0,!r.servername&&r.servername!==""&&(r.servername=ta.isIP(r.host)?"":r.host),ef.connect(r)}function z(r,e,t){r._readyState=N.CLOSING;let s=new Error(t);Error.captureStackTrace(s,z),e.setHeader?(e[sa]=!0,e.abort(),e.socket&&!e.socket.destroyed&&e.socket.destroy(),process.nextTick(Rr,r,s)):(e.destroy(s),e.once("error",r.emit.bind(r,"error")),e.once("close",r.emitClose.bind(r)))}function Js(r,e,t){if(e){let s=df(e).length;r._socket?r._sender._bufferedBytes+=s:r._bufferedAmount+=s}if(t){let s=new Error(`WebSocket is not open: readyState ${r.readyState} (${ve[r.readyState]})`);process.nextTick(t,s)}}function yf(r,e){let t=this[U];t._closeFrameReceived=!0,t._closeMessage=e,t._closeCode=r,t._socket[U]!==void 0&&(t._socket.removeListener("data",Lr),process.nextTick(ia,t._socket),r===1005?t.close():t.close(r,e))}function Sf(){let r=this[U];r.isPaused||r._socket.resume()}function vf(r){let e=this[U];e._socket[U]!==void 0&&(e._socket.removeListener("data",Lr),process.nextTick(ia,e._socket),e.close(r[cf])),e.emit("error",r)}function ea(){this[U].emitClose()}function wf(r,e){this[U].emit("message",r,e)}function Ef(r){let e=this[U];e._autoPong&&e.pong(r,!this._isServer,ra),e.emit("ping",r)}function xf(r){this[U].emit("pong",r)}function ia(r){r.resume()}function oa(){let r=this[U];this.removeListener("close",oa),this.removeListener("data",Lr),this.removeListener("end",aa),r._readyState=N.CLOSING;let e;!this._readableState.endEmitted&&!r._closeFrameReceived&&!r._receiver._writableState.errorEmitted&&(e=r._socket.read())!==null&&r._receiver.write(e),r._receiver.end(),this[U]=void 0,clearTimeout(r._closeTimer),r._receiver._writableState.finished||r._receiver._writableState.errorEmitted?r.emitClose():(r._receiver.on("error",ea),r._receiver.on("finish",ea))}function Lr(r){this[U]._receiver.write(r)||this.pause()}function aa(){let r=this[U];r._readyState=N.CLOSING,r._receiver.end(),this.end()}function ca(){let r=this[U];this.removeListener("error",ca),this.on("error",ra),r&&(r._readyState=N.CLOSING,this.destroy())}});var fa=v((Gd,ha)=>{"use strict";var{tokenChars:Cf}=At();function bf(r){let e=new Set,t=-1,s=-1,n=0;for(n;n<r.length;n++){let o=r.charCodeAt(n);if(s===-1&&Cf[o]===1)t===-1&&(t=n);else if(n!==0&&(o===32||o===9))s===-1&&t!==-1&&(s=n);else if(o===44){if(t===-1)throw new SyntaxError(`Unexpected character at index ${n}`);s===-1&&(s=n);let a=r.slice(t,s);if(e.has(a))throw new SyntaxError(`The "${a}" subprotocol is duplicated`);e.add(a),t=s=-1}else throw new SyntaxError(`Unexpected character at index ${n}`)}if(t===-1||s!==-1)throw new SyntaxError("Unexpected end of input");let i=r.slice(t,n);if(e.has(i))throw new SyntaxError(`The "${i}" subprotocol is duplicated`);return e.add(i),e}ha.exports={parse:bf}});var ya=v((zd,_a)=>{"use strict";var kf=require("events"),Ar=require("http"),{Duplex:Hd}=require("stream"),{createHash:Tf}=require("crypto"),ua=Gs(),Ue=Lt(),Of=fa(),Pf=Ks(),{GUID:Nf,kWebSocket:Rf}=Ce(),Lf=/^[+/0-9A-Za-z]{22}==$/,da=0,pa=1,ga=2,Xs=class extends kf{constructor(e,t){if(super(),e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:Pf,...e},e.port==null&&!e.server&&!e.noServer||e.port!=null&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(e.port!=null?(this._server=Ar.createServer((s,n)=>{let i=Ar.STATUS_CODES[426];n.writeHead(426,{"Content-Length":i.length,"Content-Type":"text/plain"}),n.end(i)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server){let s=this.emit.bind(this,"connection");this._removeListeners=Af(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(n,i,o)=>{this.handleUpgrade(n,i,o,s)}})}e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=da}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(this._state===ga){e&&this.once("close",()=>{e(new Error("The server is not running"))}),process.nextTick(Dt,this);return}if(e&&this.once("close",e),this._state!==pa)if(this._state=pa,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(Dt,this):process.nextTick(Dt,this);else{let t=this._server;this._removeListeners(),this._removeListeners=this._server=null,t.close(()=>{Dt(this)})}}shouldHandle(e){if(this.options.path){let t=e.url.indexOf("?");if((t!==-1?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,s,n){t.on("error",ma);let i=e.headers["sec-websocket-key"],o=e.headers.upgrade,a=+e.headers["sec-websocket-version"];if(e.method!=="GET"){Me(this,e,t,405,"Invalid HTTP method");return}if(o===void 0||o.toLowerCase()!=="websocket"){Me(this,e,t,400,"Invalid Upgrade header");return}if(i===void 0||!Lf.test(i)){Me(this,e,t,400,"Missing or invalid Sec-WebSocket-Key header");return}if(a!==8&&a!==13){Me(this,e,t,400,"Missing or invalid Sec-WebSocket-Version header");return}if(!this.shouldHandle(e)){Ut(t,400);return}let h=e.headers["sec-websocket-protocol"],l=new Set;if(h!==void 0)try{l=Of.parse(h)}catch{Me(this,e,t,400,"Invalid Sec-WebSocket-Protocol header");return}let c=e.headers["sec-websocket-extensions"],f={};if(this.options.perMessageDeflate&&c!==void 0){let u=new Ue(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let p=ua.parse(c);p[Ue.extensionName]&&(u.accept(p[Ue.extensionName]),f[Ue.extensionName]=u)}catch{Me(this,e,t,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let u={origin:e.headers[`${a===8?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(u,(p,_,d,g)=>{if(!p)return Ut(t,_||401,d,g);this.completeUpgrade(f,i,l,e,t,s,n)});return}if(!this.options.verifyClient(u))return Ut(t,401)}this.completeUpgrade(f,i,l,e,t,s,n)}completeUpgrade(e,t,s,n,i,o,a){if(!i.readable||!i.writable)return i.destroy();if(i[Rf])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>da)return Ut(i,503);let l=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${Tf("sha1").update(t+Nf).digest("base64")}`],c=new this.options.WebSocket(null,void 0,this.options);if(s.size){let f=this.options.handleProtocols?this.options.handleProtocols(s,n):s.values().next().value;f&&(l.push(`Sec-WebSocket-Protocol: ${f}`),c._protocol=f)}if(e[Ue.extensionName]){let f=e[Ue.extensionName].params,u=ua.format({[Ue.extensionName]:[f]});l.push(`Sec-WebSocket-Extensions: ${u}`),c._extensions=e}this.emit("headers",l,n),i.write(l.concat(`\r
`).join(`\r
`)),i.removeListener("error",ma),c.setSocket(i,o,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(c),c.on("close",()=>{this.clients.delete(c),this._shouldEmitClose&&!this.clients.size&&process.nextTick(Dt,this)})),a(c,n)}};_a.exports=Xs;function Af(r,e){for(let t of Object.keys(e))r.on(t,e[t]);return function(){for(let s of Object.keys(e))r.removeListener(s,e[s])}}function Dt(r){r._state=ga,r.emit("close")}function ma(){this.destroy()}function Ut(r,e,t,s){t=t||Ar.STATUS_CODES[e],s={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(t),...s},r.once("finish",r.destroy),r.end(`HTTP/1.1 ${e} ${Ar.STATUS_CODES[e]}\r
`+Object.keys(s).map(n=>`${n}: ${s[n]}`).join(`\r
`)+`\r
\r
`+t)}function Me(r,e,t,s,n){if(r.listenerCount("wsClientError")){let i=new Error(n);Error.captureStackTrace(i,Me),r.emit("wsClientError",i,t,e)}else Ut(t,s,n)}});var hu={};Hr(hu,{activate:()=>cu,deactivate:()=>lu});module.exports=nc(hu);var ne=w(require("fs")),fn=w(require("http")),je=w(require("path")),S=w(require("vscode"));var Pi=w(En());var zl=w(_i(),1),Yl=w(cs(),1),Jl=w(fs(),1),Ti=w(hr(),1),Oi=w(ki(),1);var Wu=(0,Pi.default)("pw:mcp:relay");ws();vs();var Ns=w($i(),1);var te=Object.create(null);te.open="0";te.close="1";te.ping="2";te.pong="3";te.message="4";te.upgrade="5";te.noop="6";var Ct=Object.create(null);Object.keys(te).forEach(r=>{Ct[te[r]]=r});var bt={type:"error",data:"parser error"};var kt=({type:r,data:e},t,s)=>e instanceof ArrayBuffer||ArrayBuffer.isView(e)?s(t?e:"b"+Gi(e,!0).toString("base64")):s(te[r]+(e||"")),Gi=(r,e)=>Buffer.isBuffer(r)||r instanceof Uint8Array&&!e?r:r instanceof ArrayBuffer?Buffer.from(r):Buffer.from(r.buffer,r.byteOffset,r.byteLength),xs;function Hi(r,e){if(r.data instanceof ArrayBuffer||ArrayBuffer.isView(r.data))return e(Gi(r.data,!1));kt(r,!0,t=>{xs||(xs=new TextEncoder),e(xs.encode(t))})}var Tt=(r,e)=>{if(typeof r!="string")return{type:"message",data:zi(r,e)};let t=r.charAt(0);if(t==="b"){let s=Buffer.from(r.substring(1),"base64");return{type:"message",data:zi(s,e)}}return Ct[t]?r.length>1?{type:Ct[t],data:r.substring(1)}:{type:Ct[t]}:bt},zi=(r,e)=>{switch(e){case"arraybuffer":return r instanceof ArrayBuffer?r:Buffer.isBuffer(r)?r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength):r.buffer;case"nodebuffer":default:return Buffer.isBuffer(r)?r:Buffer.from(r)}};var Yi="",Ji=(r,e)=>{let t=r.length,s=new Array(t),n=0;r.forEach((i,o)=>{kt(i,!1,a=>{s[o]=a,++n===t&&e(s.join(Yi))})})},Ki=(r,e)=>{let t=r.split(Yi),s=[];for(let n=0;n<t.length;n++){let i=Tt(t[n],e);if(s.push(i),i.type==="error")break}return s};function Xi(){return new TransformStream({transform(r,e){Hi(r,t=>{let s=t.length,n;if(s<126)n=new Uint8Array(1),new DataView(n.buffer).setUint8(0,s);else if(s<65536){n=new Uint8Array(3);let i=new DataView(n.buffer);i.setUint8(0,126),i.setUint16(1,s)}else{n=new Uint8Array(9);let i=new DataView(n.buffer);i.setUint8(0,127),i.setBigUint64(1,BigInt(s))}r.data&&typeof r.data!="string"&&(n[0]|=128),e.enqueue(n),e.enqueue(t)})}})}var Cs;function ur(r){return r.reduce((e,t)=>e+t.length,0)}function dr(r,e){if(r[0].length===e)return r.shift();let t=new Uint8Array(e),s=0;for(let n=0;n<e;n++)t[n]=r[0][s++],s===r[0].length&&(r.shift(),s=0);return r.length&&s<r[0].length&&(r[0]=r[0].slice(s)),t}function Qi(r,e){Cs||(Cs=new TextDecoder);let t=[],s=0,n=-1,i=!1;return new TransformStream({transform(o,a){for(t.push(o);;){if(s===0){if(ur(t)<1)break;let h=dr(t,1);i=(h[0]&128)===128,n=h[0]&127,n<126?s=3:n===126?s=1:s=2}else if(s===1){if(ur(t)<2)break;let h=dr(t,2);n=new DataView(h.buffer,h.byteOffset,h.length).getUint16(0),s=3}else if(s===2){if(ur(t)<8)break;let h=dr(t,8),l=new DataView(h.buffer,h.byteOffset,h.length),c=l.getUint32(0);if(c>Math.pow(2,21)-1){a.enqueue(bt);break}n=c*Math.pow(2,32)+l.getUint32(4),s=3}else{if(ur(t)<n)break;let h=dr(t,n);a.enqueue(Tt(i?h:Cs.decode(h),e)),s=0}if(n===0||n>r){a.enqueue(bt);break}}}})}var bs=4;var lo=w(Be(),1);var pe=process.nextTick,j=global,eo="nodebuffer";function to(){return new ks}function eh(r){let e=r.split("; "),t=e[0].indexOf("=");if(t===-1)return;let s=e[0].substring(0,t).trim();if(!s.length)return;let n=e[0].substring(t+1).trim();n.charCodeAt(0)===34&&(n=n.slice(1,-1));let i={name:s,value:n};for(let o=1;o<e.length;o++){let a=e[o].split("=");if(a.length!==2)continue;let h=a[0].trim(),l=a[1].trim();switch(h){case"Expires":i.expires=new Date(l);break;case"Max-Age":let c=new Date;c.setUTCSeconds(c.getUTCSeconds()+parseInt(l,10)),i.expires=c;break;default:}}return i}var ks=class{constructor(){this._cookies=new Map}parseCookies(e){e&&e.forEach(t=>{let s=eh(t);s&&this._cookies.set(s.name,s)})}get cookies(){let e=Date.now();return this._cookies.forEach((t,s)=>{var n;((n=t.expires)===null||n===void 0?void 0:n.getTime())<e&&this._cookies.delete(s)}),this._cookies.entries()}addCookies(e){let t=[];for(let[s,n]of this.cookies)t.push(`${s}=${n.value}`);t.length&&(e.setDisableHeaderCheck(!0),e.setRequestHeader("cookie",t.join("; ")))}appendCookies(e){for(let[t,s]of this.cookies)e.append("cookie",`${t}=${s.value}`)}};function pr(r,...e){return e.reduce((t,s)=>(r.hasOwnProperty(s)&&(t[s]=r[s]),t),{})}var th=j.setTimeout,rh=j.clearTimeout;function me(r,e){e.useNativeTimers?(r.setTimeoutFn=th.bind(j),r.clearTimeoutFn=rh.bind(j)):(r.setTimeoutFn=j.setTimeout.bind(j),r.clearTimeoutFn=j.clearTimeout.bind(j))}var sh=1.33;function ro(r){return typeof r=="string"?nh(r):Math.ceil((r.byteLength||r.size)*sh)}function nh(r){let e=0,t=0;for(let s=0,n=r.length;s<n;s++)e=r.charCodeAt(s),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(s++,t+=4);return t}function mr(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function so(r){let e="";for(let t in r)r.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(r[t]));return e}function no(r){let e={},t=r.split("&");for(let s=0,n=t.length;s<n;s++){let i=t[s].split("=");e[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return e}var ho=w(Q(),1),vh=(0,ho.default)("engine.io-client:transport"),Sr=class extends Error{constructor(e,t,s){super(e),this.description=t,this.context=s,this.type="TransportError"}},ge=class extends lo.Emitter{constructor(e){super(),this.writable=!1,me(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,s){return super.emitReserved("error",new Sr(e,t,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"?this.write(e):vh("transport is not open, discarding packets")}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){let t=Tt(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){let e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){let t=so(e);return t.length?"?"+t:""}};var fo=w(Q(),1),re=(0,fo.default)("engine.io-client:polling"),Ot=class extends ge{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";let t=()=>{re("paused"),this.readyState="paused",e()};if(this._polling||!this.writable){let s=0;this._polling&&(re("we are currently polling - waiting to pause"),s++,this.once("pollComplete",function(){re("pre-pause polling complete"),--s||t()})),this.writable||(re("we are currently writing - waiting to pause"),s++,this.once("drain",function(){re("pre-pause writing complete"),--s||t()}))}else t()}_poll(){re("polling"),this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){re("polling got data %s",e);let t=s=>{if(this.readyState==="opening"&&s.type==="open"&&this.onOpen(),s.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(s)};Ki(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"?this._poll():re('ignoring poll - transport state "%s"',this.readyState))}doClose(){let e=()=>{re("writing close packet"),this.write([{type:"close"}])};this.readyState==="open"?(re("transport open - closing"),e()):(re("transport not open - deferring close"),this.once("open",e))}write(e){this.writable=!1,Ji(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=mr()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}};var go=w(Be(),1);var uo=!1;try{uo=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}var po=uo;var _o=w(Q(),1),Ps=(0,_o.default)("engine.io-client:polling");function wh(){}var vr=class extends Ot{constructor(e){if(super(e),typeof location<"u"){let t=location.protocol==="https:",s=location.port;s||(s=t?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||s!==e.port}}doWrite(e,t){let s=this.request({method:"POST",data:e});s.on("success",t),s.on("error",(n,i)=>{this.onError("xhr post error",n,i)})}doPoll(){Ps("xhr poll");let e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,s)=>{this.onError("xhr poll error",t,s)}),this.pollXhr=e}},_e=class r extends go.Emitter{constructor(e,t,s){super(),this.createRequest=e,me(this,s),this._opts=s,this._method=s.method||"GET",this._uri=t,this._data=s.data!==void 0?s.data:null,this._create()}_create(){var e;let t=pr(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;let s=this._xhr=this.createRequest(t);try{Ps("xhr open %s: %s",this._method,this._uri),s.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){s.setDisableHeaderCheck&&s.setDisableHeaderCheck(!0);for(let n in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(n)&&s.setRequestHeader(n,this._opts.extraHeaders[n])}}catch{}if(this._method==="POST")try{s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{s.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(s),"withCredentials"in s&&(s.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(s.timeout=this._opts.requestTimeout),s.onreadystatechange=()=>{var n;s.readyState===3&&((n=this._opts.cookieJar)===null||n===void 0||n.parseCookies(s.getResponseHeader("set-cookie"))),s.readyState===4&&(s.status===200||s.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof s.status=="number"?s.status:0)},0))},Ps("xhr data %s",this._data),s.send(this._data)}catch(n){this.setTimeoutFn(()=>{this._onError(n)},0);return}typeof document<"u"&&(this._index=r.requestsCount++,r.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=wh,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete r.requests[this._index],this._xhr=null}}_onLoad(){let e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}};_e.requestsCount=0;_e.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",mo);else if(typeof addEventListener=="function"){let r="onpagehide"in j?"pagehide":"unload";addEventListener(r,mo,!1)}}function mo(){for(let r in _e.requests)_e.requests.hasOwnProperty(r)&&_e.requests[r].abort()}var Td=function(){let r=Eh({xdomain:!1});return r&&r.responseType!==null}();function Eh(r){let e=r.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||po))return new XMLHttpRequest}catch{}if(!e)try{return new j[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}var xh=Ns.default||Ns,et=class extends vr{request(e={}){var t;return Object.assign(e,{xd:this.xd,cookieJar:(t=this.socket)===null||t===void 0?void 0:t._cookieJar},this.opts),new _e(s=>new xh(s),this.uri(),e)}};var If=w(wo(),1),Bf=w(Ws(),1),Ff=w(Vs(),1),Qs=w(Ks(),1),Df=w(ya(),1);var Sa=w(Q(),1),Mf=(0,Sa.default)("engine.io-client:websocket"),qf=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative",Ir=class extends ge{get name(){return"websocket"}doOpen(){let e=this.uri(),t=this.opts.protocols,s=qf?{}:pr(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,s)}catch(n){return this.emitReserved("error",n)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){let s=e[t],n=t===e.length-1;kt(s,this.supportsBinary,i=>{try{this.doWrite(s,i)}catch{Mf("websocket closed before onclose event")}n&&pe(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){let e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=mr()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}},Qd=j.WebSocket||j.MozWebSocket;var it=class extends Ir{createSocket(e,t,s){var n;if(!((n=this.socket)===null||n===void 0)&&n._cookieJar){s.headers=s.headers||{},s.headers.cookie=typeof s.headers.cookie=="string"?[s.headers.cookie]:s.headers.cookie||[];for(let[i,o]of this.socket._cookieJar.cookies)s.headers.cookie.push(`${i}=${o.value}`)}return new Qs.default(e,t,s)}doWrite(e,t){let s={};e.options&&(s.compress=e.options.compress),this.opts.perMessageDeflate&&(typeof t=="string"?Buffer.byteLength(t):t.length)<this.opts.perMessageDeflate.threshold&&(s.compress=!1),this.ws.send(t,s)}};var va=w(Q(),1),Mt=(0,va.default)("engine.io-client:webtransport"),ot=class extends ge{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{Mt("transport closed gracefully"),this.onClose()}).catch(e=>{Mt("transport closed due to %s",e),this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{let t=Qi(Number.MAX_SAFE_INTEGER,this.socket.binaryType),s=e.readable.pipeThrough(t).getReader(),n=Xi();n.readable.pipeTo(e.writable),this._writer=n.writable.getWriter();let i=()=>{s.read().then(({done:a,value:h})=>{if(a){Mt("session is closed");return}Mt("received chunk: %o",h),this.onPacket(h),i()}).catch(a=>{Mt("an error occurred while reading: %s",a)})};i();let o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this._writer.write(o).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){let s=e[t],n=t===e.length-1;this._writer.write(s).then(()=>{n&&pe(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}};var Zs={websocket:it,webtransport:ot,polling:et};var Wf=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,jf=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function at(r){if(r.length>8e3)throw"URI too long";let e=r,t=r.indexOf("["),s=r.indexOf("]");t!=-1&&s!=-1&&(r=r.substring(0,t)+r.substring(t,s).replace(/:/g,";")+r.substring(s,r.length));let n=Wf.exec(r||""),i={},o=14;for(;o--;)i[jf[o]]=n[o]||"";return t!=-1&&s!=-1&&(i.source=e,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i.pathNames=Vf(i,i.path),i.queryKey=$f(i,i.query),i}function Vf(r,e){let t=/\/{2,9}/g,s=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&s.splice(0,1),e.slice(-1)=="/"&&s.splice(s.length-1,1),s}function $f(r,e){let t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(s,n,i){n&&(t[n]=i)}),t}var wa=w(Be(),1);var Ea=w(Q(),1),b=(0,Ea.default)("engine.io-client:socket"),en=typeof addEventListener=="function"&&typeof removeEventListener=="function",qt=[];en&&addEventListener("offline",()=>{b("closing %d connection(s) because the network was lost",qt.length),qt.forEach(r=>r())},!1);var qe=class r extends wa.Emitter{constructor(e,t){if(super(),this.binaryType=eo,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(t=e,e=null),e){let s=at(e);t.hostname=s.host,t.secure=s.protocol==="https"||s.protocol==="wss",t.port=s.port,s.query&&(t.query=s.query)}else t.host&&(t.hostname=at(t.host).host);me(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(s=>{let n=s.prototype.name;this.transports.push(n),this._transportsByName[n]=s}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=no(this.opts.query)),en&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(b("adding listener for the 'offline' event"),this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},qt.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=to()),this._open()}createTransport(e){b('creating transport "%s"',e);let t=Object.assign({},this.opts.query);t.EIO=bs,t.transport=e,this.id&&(t.sid=this.id);let s=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return b("options: %j",s),new this._transportsByName[e](s)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}let e=this.opts.rememberUpgrade&&r.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";let t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){b("setting transport %s",e.name),this.transport&&(b("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",t=>this._onClose("transport close",t))}onOpen(){b("socket open"),this.readyState="open",r.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(b('socket receive: type "%s", data "%s"',e.type,e.data),this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":let t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}else b('packet received with socket readyState "%s"',this.readyState)}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);let e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){let e=this._getWritablePackets();b("flushing %d packets in socket",e.length),this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let s=0;s<this.writeBuffer.length;s++){let n=this.writeBuffer[s].data;if(n&&(t+=ro(n)),s>0&&t>this._maxPayload)return b("only send %d out of %d packets",s,this.writeBuffer.length),this.writeBuffer.slice(0,s);t+=2}return b("payload size is %d (max: %d)",t,this._maxPayload),this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;let e=Date.now()>this._pingTimeoutTime;return e&&(b("throttled timer detected, scheduling connection close"),this._pingTimeoutTime=0,pe(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,s){return this._sendPacket("message",e,t,s),this}send(e,t,s){return this._sendPacket("message",e,t,s),this}_sendPacket(e,t,s,n){if(typeof t=="function"&&(n=t,t=void 0),typeof s=="function"&&(n=s,s=null),this.readyState==="closing"||this.readyState==="closed")return;s=s||{},s.compress=s.compress!==!1;let i={type:e,data:t,options:s};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),n&&this.once("flush",n),this.flush()}close(){let e=()=>{this._onClose("forced close"),b("socket closing - telling transport to close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},s=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?s():e()}):this.upgrading?s():e()),this}_onError(e){if(b("socket error %j",e),r.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return b("trying next transport"),this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(b('socket close with reason: "%s"',e),this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),en&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){let s=qt.indexOf(this._offlineEventListener);s!==-1&&(b("removing listener for the 'offline' event"),qt.splice(s,1))}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}};qe.protocol=bs;var Br=class extends qe{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade){b("starting upgrade probes");for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}}_probe(e){b('probing transport "%s"',e);let t=this.createTransport(e),s=!1;qe.priorWebsocketSuccess=!1;let n=()=>{s||(b('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",f=>{if(!s)if(f.type==="pong"&&f.data==="probe"){if(b('probe transport "%s" pong',e),this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;qe.priorWebsocketSuccess=t.name==="websocket",b('pausing current transport "%s"',this.transport.name),this.transport.pause(()=>{s||this.readyState!=="closed"&&(b("changing transport and sending upgrade packet"),c(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{b('probe transport "%s" failed',e);let u=new Error("probe error");u.transport=t.name,this.emitReserved("upgradeError",u)}}))};function i(){s||(s=!0,c(),t.close(),t=null)}let o=f=>{let u=new Error("probe error: "+f);u.transport=t.name,i(),b('probe transport "%s" failed because of error: %s',e,f),this.emitReserved("upgradeError",u)};function a(){o("transport closed")}function h(){o("socket closed")}function l(f){t&&f.name!==t.name&&(b('"%s" works - aborting "%s"',f.name,t.name),i())}let c=()=>{t.removeListener("open",n),t.removeListener("error",o),t.removeListener("close",a),this.off("close",h),this.off("upgrading",l)};t.once("open",n),t.once("error",o),t.once("close",a),this.once("close",h),this.once("upgrading",l),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{s||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){let t=[];for(let s=0;s<e.length;s++)~this.transports.indexOf(e[s])&&t.push(e[s]);return t}},ct=class extends Br{constructor(e,t={}){let s=typeof e=="object"?e:t;(!s.transports||s.transports&&typeof s.transports[0]=="string")&&(s.transports=(s.transports||["polling","websocket","webtransport"]).map(n=>Zs[n]).filter(n=>!!n)),super(e,s)}};var wp=ct.protocol;var Ca=w(Q(),1),xa=(0,Ca.default)("socket.io-client:url");function ba(r,e="",t){let s=r;t=t||typeof location<"u"&&location,r==null&&(r=t.protocol+"//"+t.host),typeof r=="string"&&(r.charAt(0)==="/"&&(r.charAt(1)==="/"?r=t.protocol+r:r=t.host+r),/^(https?|wss?):\/\//.test(r)||(xa("protocol-less url %s",r),typeof t<"u"?r=t.protocol+"//"+r:r="https://"+r),xa("parse %s",r),s=at(r)),s.port||(/^(http|ws)$/.test(s.protocol)?s.port="80":/^(http|ws)s$/.test(s.protocol)&&(s.port="443")),s.path=s.path||"/";let i=s.host.indexOf(":")!==-1?"["+s.host+"]":s.host;return s.id=s.protocol+"://"+i+":"+s.port+e,s.href=s.protocol+"://"+i+(t&&t.port===s.port?"":":"+s.port),s}var cn={};Hr(cn,{Decoder:()=>on,Encoder:()=>nn,PacketType:()=>E,protocol:()=>La});var Na=w(Be(),1);var Yf=typeof ArrayBuffer=="function",Jf=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r.buffer instanceof ArrayBuffer,ka=Object.prototype.toString,Kf=typeof Blob=="function"||typeof Blob<"u"&&ka.call(Blob)==="[object BlobConstructor]",Xf=typeof File=="function"||typeof File<"u"&&ka.call(File)==="[object FileConstructor]";function jt(r){return Yf&&(r instanceof ArrayBuffer||Jf(r))||Kf&&r instanceof Blob||Xf&&r instanceof File}function Wt(r,e){if(!r||typeof r!="object")return!1;if(Array.isArray(r)){for(let t=0,s=r.length;t<s;t++)if(Wt(r[t]))return!0;return!1}if(jt(r))return!0;if(r.toJSON&&typeof r.toJSON=="function"&&arguments.length===1)return Wt(r.toJSON(),!0);for(let t in r)if(Object.prototype.hasOwnProperty.call(r,t)&&Wt(r[t]))return!0;return!1}function Ta(r){let e=[],t=r.data,s=r;return s.data=tn(t,e),s.attachments=e.length,{packet:s,buffers:e}}function tn(r,e){if(!r)return r;if(jt(r)){let t={_placeholder:!0,num:e.length};return e.push(r),t}else if(Array.isArray(r)){let t=new Array(r.length);for(let s=0;s<r.length;s++)t[s]=tn(r[s],e);return t}else if(typeof r=="object"&&!(r instanceof Date)){let t={};for(let s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=tn(r[s],e));return t}return r}function Oa(r,e){return r.data=rn(r.data,e),delete r.attachments,r}function rn(r,e){if(!r)return r;if(r&&r._placeholder===!0){if(typeof r.num=="number"&&r.num>=0&&r.num<e.length)return e[r.num];throw new Error("illegal attachments")}else if(Array.isArray(r))for(let t=0;t<r.length;t++)r[t]=rn(r[t],e);else if(typeof r=="object")for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&(r[t]=rn(r[t],e));return r}var Ra=w(Q(),1),sn=(0,Ra.default)("socket.io-parser"),Qf=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],La=5,E;(function(r){r[r.CONNECT=0]="CONNECT",r[r.DISCONNECT=1]="DISCONNECT",r[r.EVENT=2]="EVENT",r[r.ACK=3]="ACK",r[r.CONNECT_ERROR=4]="CONNECT_ERROR",r[r.BINARY_EVENT=5]="BINARY_EVENT",r[r.BINARY_ACK=6]="BINARY_ACK"})(E||(E={}));var nn=class{constructor(e){this.replacer=e}encode(e){return sn("encoding packet %j",e),(e.type===E.EVENT||e.type===E.ACK)&&Wt(e)?this.encodeAsBinary({type:e.type===E.EVENT?E.BINARY_EVENT:E.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===E.BINARY_EVENT||e.type===E.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),sn("encoded %j as %s",e,t),t}encodeAsBinary(e){let t=Ta(e),s=this.encodeAsString(t.packet),n=t.buffers;return n.unshift(s),n}};function Pa(r){return Object.prototype.toString.call(r)==="[object Object]"}var on=class r extends Na.Emitter{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);let s=t.type===E.BINARY_EVENT;s||t.type===E.BINARY_ACK?(t.type=s?E.EVENT:E.ACK,this.reconstructor=new an(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(jt(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0,s={type:Number(e.charAt(0))};if(E[s.type]===void 0)throw new Error("unknown packet type "+s.type);if(s.type===E.BINARY_EVENT||s.type===E.BINARY_ACK){let i=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);let o=e.substring(i,t);if(o!=Number(o)||e.charAt(t)!=="-")throw new Error("Illegal attachments");s.attachments=Number(o)}if(e.charAt(t+1)==="/"){let i=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););s.nsp=e.substring(i,t)}else s.nsp="/";let n=e.charAt(t+1);if(n!==""&&Number(n)==n){let i=t+1;for(;++t;){let o=e.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===e.length)break}s.id=Number(e.substring(i,t+1))}if(e.charAt(++t)){let i=this.tryParse(e.substr(t));if(r.isPayloadValid(s.type,i))s.data=i;else throw new Error("invalid payload")}return sn("decoded %s as %j",e,s),s}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case E.CONNECT:return Pa(t);case E.DISCONNECT:return t===void 0;case E.CONNECT_ERROR:return typeof t=="string"||Pa(t);case E.EVENT:case E.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&Qf.indexOf(t[0])===-1);case E.ACK:case E.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}},an=class{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){let t=Oa(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}};function Y(r,e,t){return r.on(e,t),function(){r.off(e,t)}}var Aa=w(Be(),1),Ia=w(Q(),1),L=(0,Ia.default)("socket.io-client:socket"),Zf=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),lt=class extends Aa.Emitter{constructor(e,t,s){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,s&&s.auth&&(this.auth=s.auth),this._opts=Object.assign({},s),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;let e=this.io;this.subs=[Y(e,"open",this.onopen.bind(this)),Y(e,"packet",this.onpacket.bind(this)),Y(e,"error",this.onerror.bind(this)),Y(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var s,n,i;if(Zf.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;let o={type:E.EVENT,data:t};if(o.options={},o.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){let c=this.ids++;L("emitting packet with ack id %d",c);let f=t.pop();this._registerAckCallback(c,f),o.id=c}let a=(n=(s=this.io.engine)===null||s===void 0?void 0:s.transport)===null||n===void 0?void 0:n.writable,h=this.connected&&!(!((i=this.io.engine)===null||i===void 0)&&i._hasPingExpired());return this.flags.volatile&&!a?L("discard packet as the transport is not currently writable"):h?(this.notifyOutgoingListeners(o),this.packet(o)):this.sendBuffer.push(o),this.flags={},this}_registerAckCallback(e,t){var s;let n=(s=this.flags.timeout)!==null&&s!==void 0?s:this._opts.ackTimeout;if(n===void 0){this.acks[e]=t;return}let i=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===e&&(L("removing packet with ack id %d from the buffer",e),this.sendBuffer.splice(a,1));L("event with ack id %d has timed out after %d ms",e,n),t.call(this,new Error("operation has timed out"))},n),o=(...a)=>{this.io.clearTimeoutFn(i),t.apply(this,a)};o.withError=!0,this.acks[e]=o}emitWithAck(e,...t){return new Promise((s,n)=>{let i=(o,a)=>o?n(o):s(a);i.withError=!0,t.push(i),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());let s={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((n,...i)=>s!==this._queue[0]?void 0:(n!==null?s.tryCount>this._opts.retries&&(L("packet [%d] is discarded after %d tries",s.id,s.tryCount),this._queue.shift(),t&&t(n)):(L("packet [%d] was successfully sent",s.id),this._queue.shift(),t&&t(null,...i)),s.pending=!1,this._drainQueue())),this._queue.push(s),this._drainQueue()}_drainQueue(e=!1){if(L("draining queue"),!this.connected||this._queue.length===0)return;let t=this._queue[0];if(t.pending&&!e){L("packet [%d] has already been sent and is waiting for an ack",t.id);return}t.pending=!0,t.tryCount++,L("sending packet [%d] (try n\xB0%d)",t.id,t.tryCount),this.flags=t.flags,this.emit.apply(this,t.args)}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){L("transport is open - connecting"),typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:E.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){L("close (%s)",e),this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(s=>String(s.id)===e)){let s=this.acks[e];delete this.acks[e],s.withError&&s.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case E.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case E.EVENT:case E.BINARY_EVENT:this.onevent(e);break;case E.ACK:case E.BINARY_ACK:this.onack(e);break;case E.DISCONNECT:this.ondisconnect();break;case E.CONNECT_ERROR:this.destroy();let s=new Error(e.data.message);s.data=e.data.data,this.emitReserved("connect_error",s);break}}onevent(e){let t=e.data||[];L("emitting event %j",t),e.id!=null&&(L("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){let t=this._anyListeners.slice();for(let s of t)s.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){let t=this,s=!1;return function(...n){s||(s=!0,L("sending ack %j",n),t.packet({type:E.ACK,id:e,data:n}))}}onack(e){let t=this.acks[e.id];if(typeof t!="function"){L("bad ack %s",e.id);return}delete this.acks[e.id],L("calling ack %s with %j",e.id,e.data),t.withError&&e.data.unshift(null),t.apply(this,e.data)}onconnect(e,t){L("socket connected with id %s",e),this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){L("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&(L("performing disconnect (%s)",this.nsp),this.packet({type:E.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){let t=this._anyListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){let t=this._anyOutgoingListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){let t=this._anyOutgoingListeners.slice();for(let s of t)s.apply(this,e.data)}}};function We(r){r=r||{},this.ms=r.min||100,this.max=r.max||1e4,this.factor=r.factor||2,this.jitter=r.jitter>0&&r.jitter<=1?r.jitter:0,this.attempts=0}We.prototype.duration=function(){var r=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*r);r=(Math.floor(e*10)&1)==0?r-t:r+t}return Math.min(r,this.max)|0};We.prototype.reset=function(){this.attempts=0};We.prototype.setMin=function(r){this.ms=r};We.prototype.setMax=function(r){this.max=r};We.prototype.setJitter=function(r){this.jitter=r};var Ba=w(Be(),1),Fa=w(Q(),1),D=(0,Fa.default)("socket.io-client:manager"),ht=class extends Ba.Emitter{constructor(e,t){var s;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,me(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((s=t.randomizationFactor)!==null&&s!==void 0?s:.5),this.backoff=new We({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;let n=t.parser||cn;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(D("readyState %s",this._readyState),~this._readyState.indexOf("open"))return this;D("opening %s",this.uri),this.engine=new ct(this.uri,this.opts);let t=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;let n=Y(t,"open",function(){s.onopen(),e&&e()}),i=a=>{D("error"),this.cleanup(),this._readyState="closed",this.emitReserved("error",a),e?e(a):this.maybeReconnectOnOpen()},o=Y(t,"error",i);if(this._timeout!==!1){let a=this._timeout;D("connect attempt will timeout after %d",a);let h=this.setTimeoutFn(()=>{D("connect attempt timed out after %d",a),n(),i(new Error("timeout")),t.close()},a);this.opts.autoUnref&&h.unref(),this.subs.push(()=>{this.clearTimeoutFn(h)})}return this.subs.push(n),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){D("open"),this.cleanup(),this._readyState="open",this.emitReserved("open");let e=this.engine;this.subs.push(Y(e,"ping",this.onping.bind(this)),Y(e,"data",this.ondata.bind(this)),Y(e,"error",this.onerror.bind(this)),Y(e,"close",this.onclose.bind(this)),Y(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){pe(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){D("error",e),this.emitReserved("error",e)}socket(e,t){let s=this.nsps[e];return s?this._autoConnect&&!s.active&&s.connect():(s=new lt(this,e,t),this.nsps[e]=s),s}_destroy(e){let t=Object.keys(this.nsps);for(let s of t)if(this.nsps[s].active){D("socket %s is still active, skipping close",s);return}this._close()}_packet(e){D("writing packet %j",e);let t=this.encoder.encode(e);for(let s=0;s<t.length;s++)this.engine.write(t[s],e.options)}cleanup(){D("cleanup"),this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){D("disconnect"),this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var s;D("closed due to %s",e),this.cleanup(),(s=this.engine)===null||s===void 0||s.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;let e=this;if(this.backoff.attempts>=this._reconnectionAttempts)D("reconnect failed"),this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{let t=this.backoff.duration();D("will wait %dms before reconnect attempt",t),this._reconnecting=!0;let s=this.setTimeoutFn(()=>{e.skipReconnect||(D("attempting reconnect"),this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(n=>{n?(D("reconnect attempt error"),e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",n)):(D("reconnect success"),e.onreconnect())}))},t);this.opts.autoUnref&&s.unref(),this.subs.push(()=>{this.clearTimeoutFn(s)})}}onreconnect(){let e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}};var Ua=w(Q(),1),Da=(0,Ua.default)("socket.io-client"),Vt={};function $t(r,e){typeof r=="object"&&(e=r,r=void 0),e=e||{};let t=ba(r,e.path||"/socket.io"),s=t.source,n=t.id,i=t.path,o=Vt[n]&&i in Vt[n].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||o,h;return a?(Da("ignoring socket cache for %s",s),h=new ht(s,e)):(Vt[n]||(Da("new io instance for %s",s),Vt[n]=new ht(s,e)),h=Vt[n]),t.query&&!e.query&&(e.query=t.queryKey),h.socket(t.path,e)}Object.assign($t,{Manager:ht,Socket:lt,io:$t,connect:$t});var Fr=w(require("vscode")),Dr=class{constructor(e="ws://localhost:8080"){this.socket=null;this.projectId=null;this.isConnected=!1;this.websocketUrl=e,this.outputChannel=Fr.window.createOutputChannel("Phion Runtime Errors")}async connect(e){return this.isConnected&&this.projectId===e?(console.log(`[Phion VSCode] Already connected to project ${e}`),!0):(console.log(`[Phion VSCode] Attempting to connect to WebSocket server for project ${e}`),console.log(`[Phion VSCode] WebSocket URL: ${this.websocketUrl}`),this.projectId=e,new Promise(t=>{this.socket=$t(this.websocketUrl,{transports:["websocket","polling"],timeout:1e4,reconnection:!0,reconnectionAttempts:3,reconnectionDelay:2e3,auth:{projectId:this.projectId}}),console.log("[Phion VSCode] Socket.IO client created, waiting for connection..."),this.socket.on("connect",()=>{console.log("[Phion VSCode] \u2705 Connected to WebSocket server, sending authentication..."),this.authenticate()}),this.socket.on("authenticated",s=>{console.log("[Phion VSCode] \u{1F510} Authentication response received:",s),s.success?(console.log("[Phion VSCode] \u2705 Authenticated successfully"),this.isConnected=!0,this.setupEventListeners(),t(!0)):(console.error("[Phion VSCode] \u274C Authentication failed"),this.isConnected=!1,t(!1))}),this.socket.on("connect_error",s=>{console.error("[Phion VSCode] \u274C Connection error:",s),this.isConnected=!1,t(!1)}),this.socket.on("disconnect",s=>{console.log(`[Phion VSCode] \u274C Disconnected from WebSocket server: ${s}`),this.isConnected=!1})}))}authenticate(){this.socket&&this.projectId&&(console.log(`[Phion VSCode] \u{1F510} Sending authentication for project ${this.projectId} as vscode-extension`),this.socket.emit("authenticate",{projectId:this.projectId,clientType:"vscode-extension"}))}setupEventListeners(){this.socket&&(this.socket.onAny((e,...t)=>{console.log(`[Phion VSCode] \u{1F4E8} Received WebSocket event: ${e}`,t)}),this.socket.on("toolbar_runtime_error",e=>{console.log("[Phion VSCode] \u{1F41B} Runtime error event received (serialized):",e),this.handleRuntimeError(e)}),this.socket.on("file_change_staged",e=>{console.log("[Phion VSCode] \u{1F4DD} File change staged:",e)}),this.socket.on("commit_created",e=>{console.log("[Phion VSCode] \u{1F4CB} Commit created:",e)}),this.socket.on("deploy_status_update",e=>{console.log("[Phion VSCode] \u{1F680} Deploy status update:",e)}),this.socket.on("save_success",e=>{console.log("[Phion VSCode] \u{1F4BE} Save success:",e)}),this.socket.on("discard_success",e=>{console.log("[Phion VSCode] \u{1F5D1}\uFE0F Discard success:",e)}),this.socket.on("toolbar_status",e=>{console.log("[Phion VSCode] \u{1F4CA} Toolbar status:",e)}),this.socket.on("agent_connected",e=>{console.log("[Phion VSCode] \u{1F916} Agent connected:",e)}),this.socket.on("agent_disconnected",e=>{console.log("[Phion VSCode] \u{1F916} Agent disconnected:",e)}),this.socket.on("error",e=>{console.error("[Phion VSCode] \u274C WebSocket error:",e)}),this.socket.on("connect",()=>{console.log("[Phion VSCode] \u2705 WebSocket connected")}),this.socket.on("disconnect",e=>{console.log(`[Phion VSCode] \u274C WebSocket disconnected: ${e}`)}),this.socket.on("reconnect",e=>{console.log(`[Phion VSCode] \u{1F504} WebSocket reconnected after ${e} attempts`)}),this.socket.on("reconnect_attempt",e=>{console.log(`[Phion VSCode] \u{1F504} WebSocket reconnection attempt ${e}`)}),this.socket.on("reconnect_error",e=>{console.error("[Phion VSCode] \u274C WebSocket reconnection error:",e)}),this.socket.on("reconnect_failed",()=>{console.error("[Phion VSCode] \u274C WebSocket reconnection failed")}),this.socket.on("insert_prompt",e=>{console.log("[Phion VSCode] \u{1F4AC} Insert prompt event received:",e.prompt),this.handleInsertPrompt(e.prompt)}))}handleRuntimeError(e){try{console.log("[Phion VSCode] Runtime error received (serialized):",e);let s=`[${new Date().toLocaleTimeString()}] Runtime Error (Serialized):
${e}

`;this.outputChannel.appendLine(s);let n=e.length>100?e.substring(0,100)+"...":e;Fr.window.showInformationMessage(`Runtime Error: ${n}`,"Show Details","Dismiss").then(i=>{i==="Show Details"&&this.outputChannel.show()})}catch(t){console.error("[Phion VSCode] Error handling runtime error:",t),this.outputChannel.appendLine(`[${new Date().toLocaleTimeString()}] Handler Error: ${e}
`)}}disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null),this.isConnected=!1,this.projectId=null}isConnectedToProject(e){return this.isConnected&&this.projectId===e}showOutputChannel(){this.outputChannel.show()}async handleInsertPrompt(e){try{console.log("[Phion VSCode] Handling insert prompt:",e);let{dispatchAgentCall:t}=await Promise.resolve().then(()=>(ws(),Wi));await t({prompt:e,mode:"agent"}),console.log("[Phion VSCode] \u2705 Prompt dispatched successfully")}catch(t){console.error("[Phion VSCode] \u274C Failed to dispatch prompt:",t),Fr.window.showErrorMessage(`Failed to dispatch prompt: ${t.message}`)}}};var qa=5173,Gt=!1,le=null,Ur=null;var ln=null,hn=!1,Te=null,Mr="phion-browser-opened",ce=null;function Wa(r){let e=r.globalState.get(Mr,0),t=Date.now(),s=30*60*1e3;return t-e>s?(r.globalState.update(Mr,0),!1):e>0}function ja(r){Gt=!0,r.globalState.update(Mr,Date.now())}var Va=!1,$a=!0;function eu(){try{if(ce=Ha(),ce){let r=S.workspace.workspaceFolders;if(!r||r.length===0)return;let e=r[0].uri.fsPath,t=je.join(e,"phion.config.json");if(ne.existsSync(t)){let s=JSON.parse(ne.readFileSync(t,"utf8"));Va=s?.autoStartOnNewProject===!0,$a=s?.autoOptimizeWorkspace!==!1}}}catch{}}function tu(r){let e=S.workspace.workspaceFolders;if(!e||e.length===0)return!0;let t=e[0].uri.fsPath;return r.globalState.get("phionStartedProjects",[]).includes(t)}function ru(r){let e=S.workspace.workspaceFolders;if(!e||e.length===0)return;let t=e[0].uri.fsPath,s=r.globalState.get("phionStartedProjects",[]);s.includes(t)||(s.push(t),r.globalState.update("phionStartedProjects",s))}function Wr(){return new Promise(r=>{let e=fn.request({hostname:"localhost",port:qa,method:"GET",path:"/",timeout:3e3},t=>{r(!0)});e.on("error",()=>{r(!1)}),e.on("timeout",()=>{e.destroy(),r(!1)}),e.end()})}async function su(r){if(Gt||Wa(r))return;await Wr()&&(ja(r),le&&(clearInterval(le),le=null),setTimeout(async()=>{await qr()},2e3))}function Ga(r){console.log("\u{1F50D} Monitoring for Vite server startup..."),le=setInterval(()=>su(r),2e3),setTimeout(()=>{le&&!Gt&&(clearInterval(le),le=null,console.log("\u23F0 Server monitoring timeout - no server detected"))},6e4)}async function Ma(r,e=!1){try{let t=S.workspace.workspaceFolders;if(!t){S.window.showErrorMessage("No workspace folder found. Please open your project folder first.");return}Gt=!1,r.globalState.update(Mr,0);let s=S.window.createTerminal({name:"Project Server",cwd:t[0].uri.fsPath});s.show();let n=je.join(t[0].uri.fsPath,"scripts","check-updates.js");ne.existsSync(n)?(s.sendText("echo '\u{1F50D} Checking for extension updates...'"),s.sendText(`node "${n}"`),await new Promise(a=>{let h=0,l=30,c=setInterval(()=>{h++,h>=l&&(clearInterval(c),a(void 0)),h>=10&&(clearInterval(c),a(void 0))},1e3)}),s.sendText("echo '\u2705 Extension update check completed'")):console.log("\u26A0\uFE0F check-updates.js not found, skipping extension update check"),await Wr()?(s.sendText("echo '\u26A0\uFE0F Server is already running on port 5173, skipping pnpm start'"),S.window.showInformationMessage("Server is already running on port 5173")):s.sendText("pnpm start"),r&&ru(r),Ga(r);let o=e?"\u{1F680} Auto-starting your project...":"\u{1F680} Starting your project...";S.window.showInformationMessage(o)}catch(t){console.error("Failed to start project:",t),S.window.showErrorMessage(`Could not start project: ${t.message}`)}}async function qr(){let r=`http://localhost:${qa}`;try{return await Wr()?(await S.commands.executeCommand("simpleBrowser.show",r),console.log(`\u{1F310} Opened preview: ${r}`),hn=!0,S.commands.executeCommand("setContext","phion.simpleBrowserOpen",!0),$a&&setTimeout(async()=>{try{await S.commands.executeCommand("workbench.action.closeSidebar"),await S.commands.executeCommand("workbench.action.closePanel"),await S.commands.executeCommand("composer.startComposerPrompt"),console.log("\u2728 Workspace optimized for development")}catch{}},1500),S.window.showInformationMessage(`\u{1F680} Website preview opened: ${r}`,"Hide"),!0):(S.window.showWarningMessage("Your website is not running. Run the setup script first."),!1)}catch(e){console.error("Failed to open preview:",e);let t=await S.window.showWarningMessage("Could not open preview. Try again?","Copy URL","Try Again");if(t==="Copy URL")await S.env.clipboard.writeText(r),S.window.showInformationMessage("URL copied to clipboard");else if(t==="Try Again")return await qr();return!1}}async function nu(){if(Ur)try{Ur.httpServer.close(),Ur=null,ln&&(ln.dispose(),ln=null),console.log("\u{1F517} CDP Bridge server stopped")}catch(r){console.error("Error stopping CDP bridge server:",r)}}function Ha(){try{let r=S.workspace.workspaceFolders;if(!r)return console.log("[Phion VSCode] \u{1F4C1} No workspace folders found"),null;let e=r[0].uri.fsPath,t=je.join(e,"phion.config.json");if(console.log(`[Phion VSCode] \u{1F50D} Looking for config at: ${t}`),ne.existsSync(t))try{console.log("[Phion VSCode] \u2705 Found phion.config.json");let s=JSON.parse(ne.readFileSync(t,"utf8"));console.log("[Phion VSCode] \u{1F4CB} Config contents:",s);let n={projectId:s.projectId,wsUrl:s.wsUrl||process.env.PHION_WS_URL||"ws://localhost:8080",debug:s.debug||!1,toolbar:s.toolbar||{enabled:!0,position:"top",autoOpen:!0}};return!n.projectId||n.projectId==="__PROJECT_ID__"?(console.log("[Phion VSCode] \u274C Missing or invalid project ID in config"),null):n}catch(s){return console.error("[Phion VSCode] \u274C Error parsing phion.config.json:",s),null}else return console.log("[Phion VSCode] \u26A0\uFE0F phion.config.json not found"),null}catch(r){return console.error("[Phion VSCode] \u274C Error loading config:",r),null}}async function iu(){if(console.log("[Phion VSCode] \u{1F50D} Starting runtime error monitoring setup..."),ce||(ce=Ha()),!ce){console.log("[Phion VSCode] \u26A0\uFE0F No valid config found, skipping runtime error monitoring");return}console.log(`[Phion VSCode] \u{1F4CB} Found project ID: ${ce.projectId}`);try{Te||(console.log("[Phion VSCode] \u{1F195} Creating new WebSocket client for runtime errors"),console.log(`[Phion VSCode] \u{1F4CB} Using WebSocket URL: ${ce.wsUrl}`),Te=new Dr(ce.wsUrl)),console.log("[Phion VSCode] \u{1F50C} Attempting to connect to WebSocket server...");let r=await Te.connect(ce.projectId);console.log(r?`[Phion VSCode] \u2705 Connected to runtime error monitoring for project: ${ce.projectId}`:"[Phion VSCode] \u274C Failed to connect to runtime error monitoring")}catch(r){console.error("[Phion VSCode] \u274C Error connecting to runtime error monitoring:",r)}}function ou(){Te?Te.showOutputChannel():S.window.showInformationMessage("Runtime error monitoring not available. Make sure the project is running.")}function au(){let r=S.workspace.workspaceFolders;if(!r)return!1;let e=r[0].uri.fsPath,t=je.join(e,"phion.config.json"),s=je.join(e,"package.json");if(ne.existsSync(t))return!0;if(ne.existsSync(s))try{let n=JSON.parse(ne.readFileSync(s,"utf8"));return!!(n.dependencies?.phion||n.devDependencies?.phion)}catch{return!1}return!1}function cu(r){eu(),console.log("\u{1F680} Phion extension activated");let e=S.workspace.workspaceFolders;if(e){let a=je.join(e[0].uri.fsPath,"scripts","check-updates.js");ne.existsSync(a)?(console.log("\u{1F50D} Running check-updates.js on activation..."),S.window.createTerminal({name:"Extension Updates",cwd:e[0].uri.fsPath}).sendText(`node "${a}"`)):console.log("\u26A0\uFE0F check-updates.js not found, skipping extension update check")}let t=Ri();r.subscriptions.push(t),S.window.onDidChangeActiveTextEditor(a=>{let h=a&&a.document.uri.scheme==="simple-browser";hn=h||!1,S.commands.executeCommand("setContext","phion.simpleBrowserOpen",h)}),S.workspace.onDidCloseTextDocument(a=>{if(a.uri.scheme==="simple-browser"){let h=S.window.visibleTextEditors.some(l=>l.document.uri.scheme==="simple-browser");hn=h,S.commands.executeCommand("setContext","phion.simpleBrowserOpen",h)}}),au()&&(setTimeout(()=>{iu()},2e3),Wr().then(a=>{if(a&&!Gt&&!Wa(r)){ja(r),setTimeout(async()=>{await qr()},1e3);return}Va&&!tu(r)?(S.window.showInformationMessage("\u{1F389} New Phion project detected! Auto-starting..."),setTimeout(()=>{Ma(r,!0)},2e3)):setTimeout(()=>{Ga(r)},3e3)}));let s=S.commands.registerCommand("phion.startProject",()=>Ma(r,!1)),n=S.commands.registerCommand("phion.openPreview",qr),i=S.commands.registerCommand("phion.showRuntimeErrors",ou),o=S.commands.registerCommand("phion.toggleAiChat",async()=>{try{await S.commands.executeCommand("composer.startComposerPrompt")}catch{try{await S.commands.executeCommand("composer.closeComposerTab")}catch{S.window.showWarningMessage("Could not toggle AI chat")}}});r.subscriptions.push(s,n,i,o)}function lu(){le&&(clearInterval(le),le=null),Ur&&nu(),Te&&(Te.disconnect(),Te=null),console.log("\u{1F44B} Phion extension deactivated")}0&&(module.exports={activate,deactivate});
/*! Bundled license information:

xmlhttprequest-ssl/lib/XMLHttpRequest.js:
  (**
   * Wrapper for built-in http.js to emulate the browser XMLHttpRequest object.
   *
   * This can be used with JS designed for browsers to improve reuse of code and
   * allow the use of existing libraries.
   *
   * Usage: include("XMLHttpRequest.js") and use XMLHttpRequest per W3C specs.
   *
   * @author Dan DeFelippi <dan@driverdan.com>
   * @contributor David Ellis <d.f.ellis@ieee.org>
   * @license MIT
   *)
*/
